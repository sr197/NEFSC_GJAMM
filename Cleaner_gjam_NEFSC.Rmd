---
title: "cleaner GJAM"
author: "Sarah Roberts"
date: "3/30/2019"
output: html_document
---

```{r packages, include=FALSE}
library(gjam)
library(tidyr)#data manipulation
library(dplyr) #data manipulation
library(naniar) #replace with NA
```

#Load data 
```{r load data}
#okay we need to start from scratch because some of the bratt stuff was wonky (there were no species names after the letter M)
#first I am going to load the original spring and fall data
#then make in a workable format 

#load data 
fall_catch <- read.csv("~/Documents/ClimateOceanPlanning/Datasets/NEFSC_Bottom_Trawl/22560_FSCSTables_Fall/22560_UNION_FSCS_SVCAT.csv")
fall_x <- read.csv("~/Documents/ClimateOceanPlanning/Datasets/NEFSC_Bottom_Trawl/22560_FSCSTables_Fall/22560_UNION_FSCS_SVSTA.csv")

spring_catch <- read.csv("~/Documents/ClimateOceanPlanning/Datasets/NEFSC_Bottom_Trawl/22561_FSCSTables_spring/22561_UNION_FSCS_SVCAT.csv")
spring_x <- read.csv("~/Documents/ClimateOceanPlanning/Datasets/NEFSC_Bottom_Trawl/22561_FSCSTables_spring/22561_UNION_FSCS_SVSTA.csv")

```

```{r data manip}
#manipulated the catch data to be in tidy format 
fall_catch <- fall_catch %>% 
 group_by_at(vars(-expcatchnum)) %>% # group by everything other than the value column. 
 mutate(row_id=1:n()) %>% ungroup() %>% # build group index
 spread(key=scientific_name, value=expcatchnum)  # spread

fall_catch$id <- as.numeric(as.character(fall_catch$id))

fall_catch_select <- fall_catch %>% 
  dplyr::select(-catch_comment) %>% 
  mutate_if(is.factor, as.integer) %>% 
  group_by(id) %>% 
  replace(is.na(.), 0) %>%
 summarise_each(funs(max)) 

fall_catch_select <- fall_catch_select %>% 
  dplyr::select(-status_code, -svspp, -catchsex, -expcatchwt, -row_id)

#joining the tables 
fall_x$id <- as.numeric(as.character(fall_x$id))
fall <- left_join(fall_catch_select, fall_x, by="id")
fall$season <- "fall"

#doing the same for spring 
spring_catch <- spring_catch %>% 
 group_by_at(vars(-expcatchnum)) %>% # group by everything other than the value column. 
 mutate(row_id=1:n()) %>% ungroup() %>% # build group index
 spread(key=scientific_name, value=expcatchnum)  # spread

spring_catch$id <- as.numeric(as.character(spring_catch$id))

spring_catch_select <- spring_catch %>% 
  dplyr::select(-catch_comment) %>% 
  mutate_if(is.factor, as.integer) %>% 
  group_by(id) %>% 
  replace(is.na(.), 0) %>%
 summarise_each(funs(max)) 

spring_catch_select <- spring_catch_select %>% 
  dplyr::select(-status_code, -svspp, -catchsex, -expcatchwt, -row_id)

#joining the tables 
spring_x$id <- as.numeric(as.character(spring_x$id))
spring <- left_join(spring_catch_select, spring_x, by="id")
spring$season <- "spring"

#combining spring and fall 
#first lets select only the overlapping species/columns 
cols <- intersect(colnames(spring), colnames(fall))
total <- rbind(spring[,cols], fall[,cols])

#now need to filter for the data after 1984 (this is when Batt uses it. There was a change in otter doors to allow more pelagics, and more consistent sampling of southern stratum) http://www.ices.dk/sites/pub/CM%20Doccuments/1997/Y/1997_Y33.pdf

total <- total %>% 
  filter(est_year>1984)
total$myid <- 1:22950
#the original id was wacky
total_full <- total
write.csv(total, file="total.csv")

total_latlondate <- total %>% 
  dplyr::select(myid, decdeg_beglat, decdeg_beglon, est_year, est_month)

write.csv(total_latlondate, file="latlondate_total.csv")
```
Now I need to go back and make a few files. The first one is the NAO/AMO file which is located in the longlatdat_total xl file. Use the index function to get the NAO/AMO values by year. 

The next step is to go in and copy the long lat file to arcmap and use that and the benthic habitat poly 2 shapefile along with the IDENTITY tool to get all of the information into one. 



```{r Adding external data}

#adding AMO/NAO and habitat information 
climate_vars <- read.csv("~/Documents/ClimateOceanPlanning/R/NEFSC_GJAMM_GIT/NAO_AMO_dat.csv")
#lets just get out the important variables (if we get them all then it adds a bunch of unneeded)
climate_vars <- climate_vars %>% 
  dplyr::select(-decdeg_beglat, -decdeg_beglon, -est_year, -est_month)
hab_vars <- read.csv("~/Documents/ClimateOceanPlanning/R/NEFSC_GJAMM_GIT/habitat_dat.csv")

hab_vars <- hab_vars %>% 
  dplyr::select(-decdeg_beg, -decdeg_b_1, -est_year, -est_month)

total <- read.csv("total.csv")

#remove id's where NA 
total <- total %>% 
  filter(!is.na(id)) 

total <- total %>% 
  filter(!is.na(beglat))
#write.csv(total, file="total.csv")
#total <- read.csv("total.csv")
#idk why there was a spatial NA but got rid of it in the other files and here #note this is really frustrating and can't figure out that the id columns are the same so I might just do it in excel 
#note this id is missing spatial points 
#201204013400080000.00


#bind them all together 
total <- left_join(total, climate_vars, by="myid")

total <- left_join(total, hab_vars, by="myid")

#getting rid of some overlapping columns 
total <- total[, !duplicated(colnames(total))]

#replacing spaces with _ in column names 
names(total) <- gsub(" ", "_", names(total))

#trimming dates 
total <- total %>% 
  filter(est_year>1984)

#trimming so just the columns we want 

xdata <- total %>% 
 dplyr::select(myid, est_month, est_day, est_year,surftemp, surfsalin, bottemp,
     botsalin, AMO_unsm_year, NAO_year, NAO_JFM, avgdepth,
     LPI, SLOPE, SBF_GRP, SBFDEPTH, SEDIMENT, SBFDESED, BENHAB, decdeg_beglat, decdeg_beglon, gebco_ra_1, gebco_SD_2)

#lets also add a column for sediment type 
xdata$SED_TYPE <- ifelse(xdata$SEDIMENT ==  '0 - 0.03 Silt/Mud', 'Silt/Mud', 
                        ifelse(xdata$SEDIMENT ==  '0.03 - 0.17 Sand', 'Sand',
                               ifelse(xdata$SEDIMENT ==  '0.17 - 0.35 Sand', 'Sand', 
                                      ifelse(xdata$SEDIMENT ==  '0.35 - 0.36 Sand', 'Sand',
                                             ifelse(xdata$SEDIMENT ==  '0.36 - 0.48 Sand', 'Sand',
                                                    ifelse(xdata$SEDIMENT ==  '20.03 - 0.17 Sand',
                                                           'Sand',
                                                    ifelse(xdata$SEDIMENT ==  '0.48+ Coarse Sand to  
                                                           Gravel','Gravel', 
                                                           ifelse(xdata$SEDIMENT ==  '60.48+ Coarse 
                                                                  Sand to Gravel',
                                                                  'Gravel', NA))))))))
xdata$SED_TYPE <- ifelse(xdata$SEDIMENT ==  '0.48+ Coarse Sand to Gravel','Gravel', ifelse(xdata$SEDIMENT ==  '60.48+ Coarse Sand to Gravel', 'Gravel', xdata$SED_TYPE))
#weirdly have to do this in two steps, I think it doesnt like too many if else statements oh well. 

#too many to do like this for ydata so will just select the columns 
ydata <- total[,8:514]


#adding the SD data (this was taken using 5 year and 15 year time periods, taking the SD of a moving window in ArcMap 3x3 and 10x10 to see areas that are similar to surrounding areas and those that are different)
SD_vars <- read.csv("~/Documents/ClimateOceanPlanning/R/NEFSC_GJAMM_GIT/SD.csv")
#longer
SD_vars$SD3x3longsal <- ifelse(SD_vars$est_year < "2000", SD_vars$X3_82_99_l, SD_vars$X3_00_17_l)
SD_vars$SD3x3longbt <- ifelse(SD_vars$est_year < "2000", SD_vars$X3_82_99_b, SD_vars$X3_00_17_b)
SD_vars$SD3x3longsst <- ifelse(SD_vars$est_year < "2000", SD_vars$X3_82_99_s, SD_vars$X3_00_17_s)

SD_vars$SD10x10longsal <- ifelse(SD_vars$est_year < "2000", SD_vars$X10, SD_vars$X10_00_17_l)
SD_vars$SD10x10longbt <- ifelse(SD_vars$est_year < "2000", SD_vars$X10_82_99_b, SD_vars$X10_00_17_b)
SD_vars$SD10x10longsst <- ifelse(SD_vars$est_year < "2000", SD_vars$X10_82_99_s, SD_vars$X10_00_17_s)
#shorter 
SD_vars$SD3x3shortsal <- ifelse(SD_vars$est_year < "1995", SD_vars$X3_92_95_l, 
                               ifelse(SD_vars$est_year < "01" & SD_vars$est_year > "95", SD_vars$X3_96_00_l, 
                                      ifelse(SD_vars$est_year < "07" & SD_vars$est_year > "00", SD_vars$X3_01_06_l, 
                                             ifelse(SD_vars$est_year < "13" & SD_vars$est_year > "06", SD_vars$X3_07_12_l, 
                                                    ifelse(SD_vars$est_year > "12", SD_vars$X3_13_18_l)
  
))))
SD_vars$SD3x3shortbt <- ifelse(SD_vars$est_year < "1995", SD_vars$X3_92_95_b, 
                               ifelse(SD_vars$est_year < "01" & SD_vars$est_year > "95", SD_vars$X3_96_00_b, 
                                      ifelse(SD_vars$est_year < "07" & SD_vars$est_year > "00", SD_vars$X3_01_06_b, 
                                             ifelse(SD_vars$est_year < "13" & SD_vars$est_year > "06", SD_vars$X3_07_12_b, 
                                                    ifelse(SD_vars$est_year > "12", SD_vars$X3_13_18_b)
  
))))
SD_vars$SD3x3shortsst <- ifelse(SD_vars$est_year < "1995", SD_vars$X3_92_95_s, 
                               ifelse(SD_vars$est_year < "01" & SD_vars$est_year > "95", SD_vars$X3_96_00_s, 
                                      ifelse(SD_vars$est_year < "07" & SD_vars$est_year > "00", SD_vars$X3_01_06_s, 
                                             ifelse(SD_vars$est_year < "13" & SD_vars$est_year > "06", SD_vars$X3_07_12_s, 
                                                    ifelse(SD_vars$est_year > "12", SD_vars$X3_13_18_s)
  
))))

SD_vars$SD10x10shortsal <- ifelse(SD_vars$est_year < "1995", SD_vars$X10_92_95_l, 
                               ifelse(SD_vars$est_year < "01" & SD_vars$est_year > "95", SD_vars$X10_96_00_l, 
                                      ifelse(SD_vars$est_year < "07" & SD_vars$est_year > "00", SD_vars$X10_01_06_l, 
                                             ifelse(SD_vars$est_year < "13" & SD_vars$est_year > "06", SD_vars$X10_07_12_l, 
                                                    ifelse(SD_vars$est_year > "12", SD_vars$X10_13_18_l)
  
))))
SD_vars$SD10x10shortbt <- ifelse(SD_vars$est_year < "1995", SD_vars$X10_92_95_b, 
                               ifelse(SD_vars$est_year < "01" & SD_vars$est_year > "95", SD_vars$X10_96_00_b, 
                                      ifelse(SD_vars$est_year < "07" & SD_vars$est_year > "00", SD_vars$X10_01_06_b, 
                                             ifelse(SD_vars$est_year < "13" & SD_vars$est_year > "06", SD_vars$X10_07_12_b, 
                                                    ifelse(SD_vars$est_year > "12", SD_vars$X10_13_18_b)
  
))))
SD_vars$SD10x10shortsst <- ifelse(SD_vars$est_year < "1995", SD_vars$X10_92_95_s, 
                               ifelse(SD_vars$est_year < "01" & SD_vars$est_year > "95", SD_vars$X10_96_00_s, 
                                      ifelse(SD_vars$est_year < "07" & SD_vars$est_year > "00", SD_vars$X10_01_06_s, 
                                             ifelse(SD_vars$est_year < "13" & SD_vars$est_year > "06", SD_vars$X10_07_12_s, 
                                                    ifelse(SD_vars$est_year > "12", SD_vars$X10_13_18_s)
  
))))


xdata <- left_join(xdata, SD_vars, by="myid")

xdata <- xdata %>% 
 dplyr::select(myid, est_month.x, est_day, est_year.y,surftemp, surfsalin, bottemp,
     botsalin, AMO_unsm_year, NAO_year, NAO_JFM, avgdepth,
     LPI, SLOPE, SBF_GRP, SBFDEPTH, SEDIMENT, SBFDESED, BENHAB, decdeg_beglat, decdeg_beglon, gebco_ra_1, gebco_SD_2, SED_TYPE, SD3x3longsal, SD3x3longbt, SD3x3longsst, SD10x10longsal, SD10x10longbt, SD10x10longsst, SD3x3shortsal, SD3x3shortbt, SD3x3shortsst, SD10x10shortsal, SD10x10shortbt, SD10x10shortsst) 


total <- cbind(ydata, xdata)


#lets check to make sure there aren't any NA's

#saving these files in case we mess up somewhere and need them again 
write.csv(total, file="total.csv")
write.csv(xdata, file="xdata.csv")
write.csv(ydata, file="ydata.csv")


```
Fixing NAs and unidentified fish. Also take some time to make sure x variables have info in most of them  
```{r}

total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")

total[total == -9999.000] <- NA
xdata[xdata == -9999.000] <- NA

ydata <- ydata %>% 
  dplyr::select(-X)

xdata <- xdata %>% 
  dplyr::select(-X)

xdata <- xdata %>% 
  dplyr::rename(est_month = est_month.x, est_year = est_year.y)

total <- cbind(ydata, xdata)

write.csv(total, file="total.csv")
write.csv(xdata, file="xdata.csv")
write.csv(ydata, file="ydata.csv")

```



#checkpoint 
do we have adataset by myID with all of the x and y data as well as a dataset with just x data and just y data? 





#selecting species 
So I could go a couple of ways here. I could follow Batt 2017 which selected a number of species, or I could go on my own and select species that are present in a lot of the trawls. I am going to do the latter first.

#running GJAM full models
splitting into chunks 
##first time chunk

```{r first time chunk}
total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")
#so I ran this with all of the SD types and the one that came out as much more important in the frist was the 3x3 short ones so I am going to rerun with just those for both time periods. 

#first time chunk 
total <- subset(total, est_year < 2000)
ydata <- total[,3:509]
ydata[is.na(ydata)] <- 0
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
ycommon_1 <- as.vector(colnames(ycommon))
#need to do this here to see ones that werent caught early and are caught later 
#now all of the unkown fish are outta there



xdata <- total %>% 
 dplyr::select(myid, est_month, est_day, est_year,surftemp, surfsalin, bottemp,
     botsalin, AMO_unsm_year, NAO_year, NAO_JFM, avgdepth,
     LPI, SLOPE, SBF_GRP, SBFDEPTH, SEDIMENT, SBFDESED, BENHAB, decdeg_beglat, decdeg_beglon,
     SED_TYPE, SD3x3shortsal, SD3x3shortbt, SD3x3shortsst, gebco_SD_2)

S <- ncol(ycommon)
ml <- list(ng = 10000, burnin = 2000, typeNames = 'DA')



xdata <- as.data.frame(xdata)
xdata$GRPSED <- as.factor(as.character(xdata$SEDIMENT))
xdata$SED_TYPE <- as.factor(as.character(xdata$SED_TYPE))
xdata$est_year <- as.factor(xdata$est_year)
xdata$AMO_unsm <- as.numeric(as.character(xdata$AMO_unsm_year))
xdata$avgdepth <- as.numeric(xdata$avgdepth)
xdata$surfsalin <- as.numeric(xdata$botsalin)
xdata$bottemp <- as.numeric(xdata$bottemp)
xdata$NAO <- as.numeric(as.character((xdata$NAO_year)))


out <- gjam(~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2 , xdata, ycommon, modelList = ml)


save(out, file='out_full_85_99.Rdata')
load('out_full_85_99.Rdata')
plotPars <- list(SMALLPLOTS = TRUE, GRIDPLOTS=T, PLOTALLY=TRUE, SAVEPLOTS=FALSE)
#gjamPlot(out, plotPars=plotPars)

#get informative stuff and save 
DIC_1 <- out$fit$DIC         # DIC
rmspe_1 <- out$fit$rmspeAll    # root mean squared prediction error for all species
rmspe_spec_1 <- out$fit$rmspeBySpec # RMSPE for each species

VIF_1 <- out$inputs$designTable               # VIF for each predictor
beta_1 <- out$parameters$betaMu                # mean beta for each species and predictor
cred_1 <- out$parameters$betaStandXTable # credible interval for each species and predictor
sens_1 <- out$parameters$sensTable             # sensitivity

#getting out the predictions 
pred_1 <- out$prediction$ypredMu

#lets try and get out only the significant betas 
#need to add a column with the specnames in it because right now its just the row names 
cred_1$names <- rownames(cred_1)

cred_1_sig <- cred_1 %>% 
  filter(sig95 == "*") %>% #only keep sig values
  filter(!grepl('intercept', names))  #remove anything that says intercept in there 

gp <- gjamPlot(output = out, plotPars = plotPars)
cluster1 <- gp$clusterIndex
#There are three versions, data, E, and R that correspond to plots that come out. E = environmental response, R = residual covariance
cluster1_order <- gp$clusterOrder
#The order of species and the cluster groups to which they belong are returned in fit$clusterOrder and fit$clusterIndex.


#trying with more clusters doesn't really work 
load('out_full_85_99.Rdata')
plotPars <- list(SMALLPLOTS = T, GRIDPLOTS=T)
gp <- gjamPlot(output = out, plotPars = plotPars)
gp$clusterIndex
gp$clusterOrder
#The order of species and the cluster groups to which they belong are returned in fit$clusterOrder and fit$clusterIndex.

```

 
##second time chunk
```{r second time chunk}
#second time chunk 
total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")
#so I ran this with all of the SD types and the one that came out as much more important in the frist was the 3x3 short ones so I am going to rerun with just those for both time periods. 

#first time chunk 
total <- subset(total, est_year > 1999)
ydata <- total[,3:509]
ydata[is.na(ydata)] <- 0
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
ycommon_2 <- as.vector(colnames(ycommon))
#need to do this here to see ones that werent caught early and are caught later 
#now all of the unkown fish are outta there



xdata <- total %>% 
 dplyr::select(myid, est_month, est_day, est_year,surftemp, surfsalin, bottemp,
     botsalin, AMO_unsm_year, NAO_year, NAO_JFM, avgdepth,
     LPI, SLOPE, SBF_GRP, SBFDEPTH, SEDIMENT, SBFDESED, BENHAB, decdeg_beglat, decdeg_beglon,
     SED_TYPE, SD3x3shortsal, SD3x3shortbt, SD3x3shortsst, gebco_SD_2)

S <- ncol(ycommon)
ml <- list(ng = 10000, burnin = 2000, typeNames = 'DA')



xdata <- as.data.frame(xdata)
xdata$GRPSED <- as.factor(as.character(xdata$SEDIMENT))
xdata$SED_TYPE <- as.factor(as.character(xdata$SED_TYPE))
xdata$est_year <- as.factor(xdata$est_year)
xdata$AMO_unsm <- as.numeric(as.character(xdata$AMO_unsm_year))
xdata$avgdepth <- as.numeric(xdata$avgdepth)
xdata$surfsalin <- as.numeric(xdata$botsalin)
xdata$bottemp <- as.numeric(xdata$bottemp)
xdata$NAO <- as.numeric(as.character((xdata$NAO_year)))


out <- gjam(~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2 , xdata, ycommon, modelList = ml)


save(out, file='out_full_99_15.Rdata')
load('out_full_99_15.Rdata')
plotPars <- list(SMALLPLOTS = T, GRIDPLOTS=T)
gjamPlot(out, plotPars=plotPars)

#getting informative stuff 
out$parameters$fSe
out$fit$DIC
gp <- gjamPlot(output = out, plotPars = plotPars)
gp$clusterIndex
#There are three versions, data, E, and R that correspond to plots that come out. E = environmental response, R = residual covariance

DIC_2 <- out$fit$DIC         # DIC
rmspe_2 <- out$fit$rmspeAll    # root mean squared prediction error for all species
rmspe_spec_2 <- out$fit$rmspeBySpec # RMSPE for each species

VIF_2 <- out$inputs$designTable               # VIF for each predictor
beta_2 <- out$parameters$betaMu                # mean beta for each species and predictor
cred_2 <- out$parameters$betaStandXTable # credible interval for each species and predictor
sens_2 <- out$parameters$sensTable             # sensitivity

#head(out$prediction$presence)        # predicted occurance for each species


#lets try and get out only the significant betas 
#need to add a column with the specnames in it because right now its just the row names 
cred_2$names <- rownames(cred_2)

cred_2_sig <- cred_2 %>% 
  filter(sig95 == "*") %>% 
  filter(!grepl('intercept', names))  #remove anything that says intercept in there 

gp <- gjamPlot(output = out, plotPars = plotPars)
cluster2 <- gp$clusterIndex
#There are three versions, data, E, and R that correspond to plots that come out. E = environmental response, R = residual covariance


```

##total
```{r total data}
#all data

total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")
#so I ran this with all of the SD types and the one that came out as much more important in the frist was the 3x3 short ones so I am going to rerun with just those for both time periods. 

#total time chunk 
ydata <- total[,3:509]
ydata[is.na(ydata)] <- 0
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
#need to do this here to see ones that werent caught early and are caught later 
#now all of the unkown fish are outta there



xdata <- total %>% 
 dplyr::select(myid, est_month, est_day, est_year,surftemp, surfsalin, bottemp,
     botsalin, AMO_unsm_year, NAO_year, NAO_JFM, avgdepth,
     LPI, SLOPE, SBF_GRP, SBFDEPTH, SEDIMENT, SBFDESED, BENHAB, decdeg_beglat, decdeg_beglon,
     SED_TYPE, SD3x3shortsal, SD3x3shortbt, SD3x3shortsst, gebco_SD_2)

S <- ncol(ycommon)
ml <- list(ng = 10000, burnin = 2000, typeNames = 'DA')



xdata <- as.data.frame(xdata)
xdata$GRPSED <- as.factor(as.character(xdata$SEDIMENT))
xdata$SED_TYPE <- as.factor(as.character(xdata$SED_TYPE))
xdata$est_year <- as.factor(xdata$est_year)
xdata$AMO_unsm <- as.numeric(as.character(xdata$AMO_unsm_year))
xdata$avgdepth <- as.numeric(xdata$avgdepth)
xdata$surfsalin <- as.numeric(xdata$botsalin)
xdata$bottemp <- as.numeric(xdata$bottemp)
xdata$NAO <- as.numeric(as.character((xdata$NAO_year)))


out <- gjam(~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2 , xdata, ycommon, modelList = ml)

save(out, file='out_full_82_15.Rdata')
load('out_full_82_15.Rdata')
plotPars <- list(SMALLPLOTS = T, GRIDPLOTS=T, PLOTALLY = T, SAVEPLOTS=T)
gjamPlot(out, plotPars=plotPars)

DIC_tot <- out$fit$DIC         # DIC
rmspe_tot <- out$fit$rmspeAll    # root mean squared prediction error for all species
rmspe_spec_tot <- as.data.frame(out$fit$rmspeBySpec) # RMSPE for each species
rmspe_spec_tot$spec <- rownames(rmspe_spec_tot)
VIF_tot <- out$inputs$designTable               # VIF for each predictor
beta_tot <- out$parameters$betaMu                # mean beta for each species and predictor
cred_tot <- out$parameters$betaStandXTable # credible interval for each species and predictor
sens_tot <- out$parameters$sensTable             # sensitivity

#head(out$prediction$presence)        # predicted occurance for each species


#lets try and get out only the significant betas 
#need to add a column with the specnames in it because right now its just the row names 
cred_tot$names <- rownames(cred_tot)

cred_tot_sig <- cred_tot %>% 
  filter(sig95 == "*") %>% 
  filter(!grepl('intercept', names))  #remove anything that says intercept in there 


#function to calculate R2 

preds <- out$prediction$ypredMu
actual <- ycommon
rsq_dat <- data.frame(matrix(nrow=193, ncol=6))
rsq_dat$spec <- colnames(ycommon)
names <- colnames(ycommon)
for (i in 1:length(ycommon)) {
  rss <- sum((preds[,i] - actual[,i]) ^ 2)  ## residual sum of squares
  tss <- sum((actual[,i] - mean(actual[,i])) ^ 2)  ## total sum of squares
  rsq_1 <- 1 - (rss/tss)
  
  # 2.1. Average of actual data
avr_y_actual <- mean(actual[,i])

# 2.2. Total sum of squares
ss_total <- sum((actual[,i] - avr_y_actual)^2)

# 2.3. Regression sum of squares
ss_regression <- sum((preds[,i] - avr_y_actual)^2)

# 2.4. Residual sum of squares
ss_residuals <- sum((actual[,i] - preds[,i])^2)
name <- name[i]
# 3. R2 Score
rsq <- 1 - (ss_residuals / ss_total)
#rsq_dat[i,1] <- name
rsq_dat[i,2] <- rsq
rsq_dat[i,3] <- rsq_1 #these should be the same
summary_stats <- postResample(pred = preds[,i], obs = actual[,i])
rsq_dat[i,4] <-  summary_stats[1]
rsq_dat[i,5] <-  summary_stats[2]
rsq_dat[i,6] <-  summary_stats[3]
}
colnames(rsq_dat) <- c("blank", "r2", "r2_2", "rmse", "r2_3", "MAE", "spec")
rsq_dat <- left_join(rsq_dat, rmspe_spec_tot, by="spec")
rsq_dat_total <- rsq_dat
write.csv(rsq_dat_total, file="summary_stats_total_model.csv")
```




#running GJAM partial models 
splitting into chunks 

```{r first time chunk}
total_data <- cbind(ycommon,xdata)


#first time chunk 
total <- subset(total_data, est_year < 2000)
ydata <- total[,1:193]
ydata[is.na(ydata)] <- 0
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
#need to do this here to see ones that werent caught early and are caught later 

xdata <- total %>% 
 select(id, est_month, est_day, est_year,surftemp, surfsalin, bottemp,
     botsalin, AMO_unsm_month, AMO_unsm_year, NAO_month, NAO_year, NAO_JFM, avgdepth,
     LPI, SLOPE, SBF_GRP, SBFDEPTH, SEDIMENT, SBFDESED, BENHAB, decdeg_beglat, decdeg_beglon,
     SED_TYPE)

S <- ncol(ycommon)
ml <- list(ng = 10000, burnin = 2000, typeNames = 'DA')



xdata <- as.data.frame(xdata)
xdata$GRPSED <- as.factor(as.character(xdata$SEDIMENT))
xdata$SED_TYPE <- as.factor(as.character(xdata$SED_TYPE))
xdata$est_year <- as.factor(xdata$est_year)
xdata$AMO_unsm <- as.numeric(as.character(xdata$AMO_unsm_year))
xdata$avgdepth <- as.numeric(xdata$avgdepth)
xdata$surfsalin <- as.numeric(xdata$botsalin)
xdata$bottemp <- as.numeric(xdata$bottemp)
xdata$NAO <- as.numeric(as.character((xdata$NAO_year)))


out <- gjam(~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE, xdata, ycommon, modelList = ml)


save(out, file='out_85_99.Rdata')
load('out_2_85_99.Rdata')
plotPars <- list(SMALLPLOTS = TRUE, GRIDPLOTS=T, PLOTALLY=TRUE, SAVEPLOTS=FALSE)
gjamPlot(out, plotPars=plotPars)

#get informative stuff and save 
DIC_1 <- out$fit$DIC         # DIC
rmspe_1 <- out$fit$rmspeAll    # root mean squared prediction error for all species
rmspe_spec_1 <- out$fit$rmspeBySpec # RMSPE for each species

VIF_1 <- out$inputs$designTable               # VIF for each predictor
beta_1 <- out$parameters$betaMu                # mean beta for each species and predictor
cred_1 <- out$parameters$betaStandXTable # credible interval for each species and predictor
sens_1 <- out$parameters$sensTable             # sensitivity

#getting out the predictions 
pred_1 <- out$prediction$ypredMu

#lets try and get out only the significant betas 
#need to add a column with the specnames in it because right now its just the row names 
cred_1$names <- rownames(cred_1)

cred_1_sig <- cred_1 %>% 
  filter(sig95 == "*") %>% #only keep sig values
  filter(!grepl('intercept', names))  #remove anything that says intercept in there 

gp <- gjamPlot(output = out, plotPars = plotPars)
cluster1 <- gp$clusterIndex
#There are three versions, data, E, and R that correspond to plots that come out. E = environmental response, R = residual covariance
cluster1_order <- gp$clusterOrder
#The order of species and the cluster groups to which they belong are returned in fit$clusterOrder and fit$clusterIndex.


#trying with more clusters doesn't really work 
load('out_82_99.Rdata')
plotPars <- list(SMALLPLOTS = T, GRIDPLOTS=T)
gp <- gjamPlot(output = out, plotPars = plotPars)
gp$clusterIndex
gp$clusterOrder
#The order of species and the cluster groups to which they belong are returned in fit$clusterOrder and fit$clusterIndex.

```

 

```{r second time chunk}
#second time chunk 
total <- subset(total_data, est_year > 1999)
ydata <- total[,1:193]
ydata[is.na(ydata)] <- 0
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
#need to do this here to see ones that werent caught early and are caught later 

xdata <- total %>% 
 select(id, est_month, est_day, est_year,surftemp, surfsalin, bottemp,
     botsalin, AMO_unsm_month, AMO_unsm_year, NAO_month, NAO_year, NAO_JFM, avgdepth,
     LPI, SLOPE, SBF_GRP, SBFDEPTH, SEDIMENT, SBFDESED, BENHAB, decdeg_beglat, decdeg_beglon,
     SED_TYPE)

S <- ncol(ycommon)
ml <- list(ng = 10000, burnin = 2000, typeNames = 'DA')



xdata <- as.data.frame(xdata)
xdata$GRPSED <- as.factor(as.character(xdata$SEDIMENT))
xdata$SED_TYPE <- as.factor(as.character(xdata$SED_TYPE))
xdata$est_year <- as.factor(xdata$est_year)
xdata$AMO_unsm <- as.numeric(as.character(xdata$AMO_unsm_year))
xdata$avgdepth <- as.numeric(xdata$avgdepth)
xdata$surfsalin <- as.numeric(xdata$botsalin)
xdata$bottemp <- as.numeric(xdata$bottemp)
xdata$NAO <- as.numeric(as.character((xdata$NAO_year)))


out <- gjam(~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE, xdata, ycommon, modelList = ml)


save(out, file='out_99_15.Rdata')
load('out_2_99_15.Rdata')
plotPars <- list(SMALLPLOTS = T, GRIDPLOTS=T)
gjamPlot(out, plotPars=plotPars)

#getting informative stuff 
out$parameters$fSe
out$fit$DIC
gp <- gjamPlot(output = out, plotPars = plotPars)
gp$clusterIndex
#There are three versions, data, E, and R that correspond to plots that come out. E = environmental response, R = residual covariance

DIC_2 <- out$fit$DIC         # DIC
rmspe_2 <- out$fit$rmspeAll    # root mean squared prediction error for all species
rmspe_spec_2 <- out$fit$rmspeBySpec # RMSPE for each species

VIF_2 <- out$inputs$designTable               # VIF for each predictor
beta_2 <- out$parameters$betaMu                # mean beta for each species and predictor
cred_2 <- out$parameters$betaStandXTable # credible interval for each species and predictor
sens_2 <- out$parameters$sensTable             # sensitivity

#head(out$prediction$presence)        # predicted occurance for each species


#lets try and get out only the significant betas 
#need to add a column with the specnames in it because right now its just the row names 
cred_2$names <- rownames(cred_2)

cred_2_sig <- cred_2 %>% 
  filter(sig95 == "*") %>% 
  filter(!grepl('intercept', names))  #remove anything that says intercept in there 

gp <- gjamPlot(output = out, plotPars = plotPars)
cluster2 <- gp$clusterIndex
#There are three versions, data, E, and R that correspond to plots that come out. E = environmental response, R = residual covariance


```


```{r total data}
#all data

total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")

ydata[is.na(ydata)] <- 0
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
#need to do this here to see ones that werent caught early and are caught later 

xdata <- xdata %>% 
 select(id, est_month, est_day, est_year,surftemp, surfsalin, bottemp,
     botsalin, AMO_unsm_month, AMO_unsm_year, NAO_month, NAO_year, NAO_JFM, avgdepth,
     LPI, SLOPE, SBF_GRP, SBFDEPTH, SEDIMENT, SBFDESED, BENHAB, decdeg_beglat, decdeg_beglon,
     SED_TYPE)

S <- ncol(ycommon)
ml <- list(ng = 10000, burnin = 2000, typeNames = 'DA')



xdata <- as.data.frame(xdata)
xdata$GRPSED <- as.factor(as.character(xdata$SEDIMENT))
xdata$SED_TYPE <- as.factor(as.character(xdata$SED_TYPE))
xdata$est_year <- as.factor(xdata$est_year)
xdata$AMO_unsm <- as.numeric(as.character(xdata$AMO_unsm_year))
xdata$avgdepth <- as.numeric(xdata$avgdepth)
xdata$surfsalin <- as.numeric(xdata$botsalin)
xdata$bottemp <- as.numeric(xdata$bottemp)
xdata$NAO <- as.numeric(as.character((xdata$NAO_year)))


out <- gjam(~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE, xdata, ycommon, modelList = ml)


save(out, file='out_82_15.Rdata')
load('out_2_82_15.Rdata')
plotPars <- list(GRIDPLOTS=T, SAVEPLOTS=T)
gjamPlot(out, plotPars=plotPars)

DIC_tot <- out$fit$DIC         # DIC
rmspe_tot <- out$fit$rmspeAll    # root mean squared prediction error for all species
rmspe_spec_tot <- out$fit$rmspeBySpec # RMSPE for each species

VIF_tot <- out$inputs$designTable               # VIF for each predictor
beta_tot <- out$parameters$betaMu                # mean beta for each species and predictor
cred_tot <- out$parameters$betaStandXTable # credible interval for each species and predictor
sens_tot <- out$parameters$sensTable             # sensitivity

#head(out$prediction$presence)        # predicted occurance for each species


#lets try and get out only the significant betas 
#need to add a column with the specnames in it because right now its just the row names 
cred_tot$names <- rownames(cred_tot)

cred_tot_sig <- cred_tot %>% 
  filter(sig95 == "*") %>% 
  filter(!grepl('intercept', names))  #remove anything that says intercept in there 
```

```{r total chunk with SD}
#all data

total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")

ydata[is.na(ydata)] <- 0
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
#need to do this here to see ones that werent caught early and are caught later 

xdata <- xdata %>% dplyr::select(id, est_month, est_day, est_year,surftemp, surfsalin, bottemp, botsalin, AMO_unsm_month, AMO_unsm_year, NAO_month, NAO_year, NAO_JFM, avgdepth, LPI, SLOPE, SBF_GRP, SBFDEPTH, SEDIMENT, SBFDESED, BENHAB, decdeg_beglat, decdeg_beglon, SED_TYPE, SD3x3longsal, SD3x3longbt, SD3x3longsst, SD10x10longsal, SD10x10longbt, SD10x10longsst, SD3x3shortsal, SD3x3shortbt, SD3x3shortsst, SD10x10shortsal, SD10x10shortbt, SD10x10shortsst)

S <- ncol(ycommon)
ml <- list(ng = 10000, burnin = 2000, typeNames = 'DA')


xdata <- as.data.frame(xdata)
xdata$GRPSED <- as.factor(as.character(xdata$SEDIMENT))
xdata$SED_TYPE <- as.factor(as.character(xdata$SED_TYPE))
xdata$est_year <- as.factor(xdata$est_year)
xdata$AMO_unsm <- as.numeric(as.character(xdata$AMO_unsm_year))
xdata$avgdepth <- as.numeric(xdata$avgdepth)
xdata$surfsalin <- as.numeric(xdata$botsalin)
xdata$bottemp <- as.numeric(xdata$bottemp)
xdata$NAO <- as.numeric(as.character((xdata$NAO_year)))


out <- gjam(~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst , xdata, ycommon, modelList = ml)


save(out, file='out_82_15_SD.Rdata')
load('out_82_15_SD.Rdata')
plotPars <- list(GRIDPLOTS=T, SAVEPLOTS=F)
gjamPlot(out, plotPars=plotPars)

DIC_tot <- out$fit$DIC         # DIC
rmspe_tot <- out$fit$rmspeAll    # root mean squared prediction error for all species
rmspe_spec_tot <- out$fit$rmspeBySpec # RMSPE for each species

VIF_tot <- out$inputs$designTable               # VIF for each predictor
beta_tot <- out$parameters$betaMu                # mean beta for each species and predictor
cred_tot <- out$parameters$betaStandXTable # credible interval for each species and predictor
sens_tot <- out$parameters$sensTable             # sensitivity

#head(out$prediction$presence)        # predicted occurance for each species


#lets try and get out only the significant betas 
#need to add a column with the specnames in it because right now its just the row names 
cred_tot$names <- rownames(cred_tot)

cred_tot_sig <- cred_tot %>% 
  filter(sig95 == "*") %>% 
  filter(!grepl('intercept', names))  #remove anything that says intercept in there 

#checkpoint 
#make sure you have the gjams working and all of the significant betas saved into a file 
```

```{r first chunk with SD}
total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")
#so I ran this with all of the SD types and the one that came out as much more important in the frist was the 3x3 short ones so I am going to rerun with just those for both time periods. 
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
total_data <- cbind(ycommon,xdata)

#first time chunk 
total <- subset(total_data, est_year < 2000)
ydata <- total[,2:194]
ydata[is.na(ydata)] <- 0
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
#need to do this here to see ones that werent caught early and are caught later 

xdata <- total %>% dplyr::select(id, est_month, est_day, est_year,surftemp, surfsalin, bottemp, botsalin, AMO_unsm_month, AMO_unsm_year, NAO_month, NAO_year, NAO_JFM, avgdepth, LPI, SLOPE, SBF_GRP, SBFDEPTH, SEDIMENT, SBFDESED, BENHAB, decdeg_beglat, decdeg_beglon, SED_TYPE, SD3x3shortsal, SD3x3shortbt, SD3x3shortsst)

S <- ncol(ycommon)
ml <- list(ng = 10000, burnin = 2000, typeNames = 'DA')



xdata <- as.data.frame(xdata)
xdata$GRPSED <- as.factor(as.character(xdata$SEDIMENT))
xdata$SED_TYPE <- as.factor(as.character(xdata$SED_TYPE))
xdata$est_year <- as.factor(xdata$est_year)
xdata$AMO_unsm <- as.numeric(as.character(xdata$AMO_unsm_year))
xdata$avgdepth <- as.numeric(xdata$avgdepth)
xdata$surfsalin <- as.numeric(xdata$botsalin)
xdata$bottemp <- as.numeric(xdata$bottemp)
xdata$NAO <- as.numeric(as.character((xdata$NAO_year)))


out <- gjam(~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE + SD3x3shortsal+ SD3x3shortbt + SD3x3shortsst, xdata, ycommon, modelList = ml)

save(out, file='out_85_99_SD.Rdata')
load('out_2_85_99_SD.Rdata')
plotPars <- list(GRIDPLOTS=T, PLOTALLY=TRUE)
gjamPlot(out, plotPars=plotPars)

#get informative stuff and save 
DIC_1_SD <- out$fit$DIC         # DIC
rmspe_1 <- out$fit$rmspeAll    # root mean squared prediction error for all species
rmspe_spec_1 <- out$fit$rmspeBySpec # RMSPE for each species

VIF_1 <- out$inputs$designTable               # VIF for each predictor
beta_1 <- out$parameters$betaMu                # mean beta for each species and predictor
cred_1 <- out$parameters$betaStandXTable # credible interval for each species and predictor
sens_1 <- out$parameters$sensTable             # sensitivity

#getting out the predictions 
pred_1 <- out$prediction$ypredMu

#lets try and get out only the significant betas 
#need to add a column with the specnames in it because right now its just the row names 
cred_1$names <- rownames(cred_1)

cred_1_sig <- cred_1 %>% 
  filter(sig95 == "*") %>% #only keep sig values
  filter(!grepl('intercept', names))  #remove anything that says intercept in there 

gp <- gjamPlot(output = out, plotPars = plotPars)
cluster1 <- gp$clusterIndex
#There are three versions, data, E, and R that correspond to plots that come out. E = environmental response, R = residual covariance
cluster1_order <- gp$clusterOrder
#The order of species and the cluster groups to which they belong are returned in fit$clusterOrder and fit$clusterIndex.


```

```{r second time chunk with SD }
total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")
#second time chunk 
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
total_data <- cbind(ycommon,xdata)

#first time chunk 
total <- subset(total_data, est_year > 1999)
ydata <- total[,2:194]
ydata[is.na(ydata)] <- 0
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
#need to do this here to see ones that werent caught early and are caught later 

xdata <- total %>% dplyr::select(id, est_month, est_day, est_year,surftemp, surfsalin, bottemp, botsalin, AMO_unsm_month, AMO_unsm_year, NAO_month, NAO_year, NAO_JFM, avgdepth, LPI, SLOPE, SBF_GRP, SBFDEPTH, SEDIMENT, SBFDESED, BENHAB, decdeg_beglat, decdeg_beglon, SED_TYPE, SD3x3shortsal, SD3x3shortbt, SD3x3shortsst)

S <- ncol(ycommon)
ml <- list(ng = 10000, burnin = 2000, typeNames = 'DA')



xdata <- as.data.frame(xdata)
xdata$GRPSED <- as.factor(as.character(xdata$SEDIMENT))
xdata$SED_TYPE <- as.factor(as.character(xdata$SED_TYPE))
xdata$est_year <- as.factor(xdata$est_year)
xdata$AMO_unsm <- as.numeric(as.character(xdata$AMO_unsm_year))
xdata$avgdepth <- as.numeric(xdata$avgdepth)
xdata$surfsalin <- as.numeric(xdata$botsalin)
xdata$bottemp <- as.numeric(xdata$bottemp)
xdata$NAO <- as.numeric(as.character((xdata$NAO_year)))


out <- gjam(~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE + SD3x3shortsal+ SD3x3shortbt + SD3x3shortsst, xdata, ycommon, modelList = ml)


save(out, file='out_99_15_SD.Rdata')
load('out_99_15_SD.Rdata')
plotPars <- list(GRIDPLOTS=T, SMALLPLOTS=T)
gjamPlot(out, plotPars=plotPars)

#getting informative stuff 
out$parameters$fSe
out$fit$DIC
gp <- gjamPlot(output = out, plotPars = plotPars)
gp$clusterIndex
#There are three versions, data, E, and R that correspond to plots that come out. E = environmental response, R = residual covariance

DIC_2 <- out$fit$DIC         # DIC
rmspe_2 <- out$fit$rmspeAll    # root mean squared prediction error for all species
rmspe_spec_2 <- out$fit$rmspeBySpec # RMSPE for each species

VIF_2 <- out$inputs$designTable               # VIF for each predictor
beta_2 <- out$parameters$betaMu                # mean beta for each species and predictor
cred_2 <- out$parameters$betaStandXTable # credible interval for each species and predictor
sens_2 <- out$parameters$sensTable             # sensitivity

#head(out$prediction$presence)        # predicted occurance for each species


#lets try and get out only the significant betas 
#need to add a column with the specnames in it because right now its just the row names 
cred_2$names <- rownames(cred_2)

cred_2_sig <- cred_2 %>% 
  filter(sig95 == "*") %>% 
  filter(!grepl('intercept', names))  #remove anything that says intercept in there 

#gp <- gjamPlot(output = out, plotPars = plotPars)
cluster2 <- gp$clusterIndex
cluster2_order <- gp$clusterOrder
#There are three versions, data, E, and R that correspond to plots that come out. E = environmental response, R = residual covariance


```

The next step is getting out all of the betas for each species/covariate pair.  

#data maniuplation of significant env relationships 
```{r}
#this chunk gets all of the data into a tidy format. 
#now lets fix up some of the columns 
cred_1_sig <- cred_1_sig %>% 
  separate(col=names, sep="([_])", into=c("names", "var"))

cred_2_sig <- cred_2_sig %>% 
  separate(col=names, sep="([_])", into=c("names", "var"))

cred_tot_sig <- cred_tot_sig %>% 
  separate(col=names, sep="([_])", into=c("names", "var"))


#lets smoosh based on species names 


cred_1_sig <- cred_1_sig %>% 
  dplyr:::select(-SE, -CI_025, -CI_975) %>% 
  spread(key = var, value=Estimate) 

cred_2_sig <- cred_2_sig %>% 
  dplyr:::select(-SE, -CI_025, -CI_975) %>% 
  spread(key = var, value=Estimate) 

cred_tot_sig <- cred_tot_sig %>% 
  dplyr:::select(-SE, -CI_025, -CI_975) %>% 
  spread(key = var, value=Estimate) 


#lets write some if else statements so we know what the variables mean (add a column so when we see depth with a negative beta we know that means they prefer shallow waters)
cred_1_sig$temp_1 <- ifelse(cred_1_sig$bottemp > 1, "warm", 
                           ifelse(cred_1_sig$bottemp < 1, "cool", NA))
cred_1_sig$sal_1 <- ifelse(cred_1_sig$botsalin > 1,"saline", 
                           ifelse(cred_1_sig$botsalin < 1, "nonsaline", NA)) 
cred_1_sig$depth_1 <- ifelse(cred_1_sig$avgdepth > 1, "deep", 
                           ifelse(cred_1_sig$avgdepth < 1, "shallow", NA)) 
cred_1_sig$siltmud_1 <- ifelse(cred_1_sig$`SEDTYPESilt/Mud` > 1, "silt/mud", 
                           ifelse(cred_1_sig$`SEDTYPESilt/Mud` < 1, "nosilt/mud", NA)) 
cred_1_sig$sand_1 <- ifelse(cred_1_sig$SEDTYPESand > 1 , "sand", 
                           ifelse(cred_1_sig$SEDTYPESand < 1 , "nosand", NA))
cred_1_sig$AMO_1 <- ifelse(cred_1_sig$AMOunsmyear  > 1, "AMO+", 
                           ifelse(cred_1_sig$AMOunsmyear  < 1, "AMO-", NA)) 
cred_1_sig$NAO_1 <- ifelse(cred_1_sig$NAOyear  > 1, "NAO+", 
                           ifelse(cred_1_sig$NAOyear  < 1, "NAO-", NA)) 
cred_1_sig$SD_bt_1 <- ifelse(cred_1_sig$SD3x3shortbt > 1, "variable_bt", 
                           ifelse(cred_1_sig$SD3x3shortbt < 1, "not_variable_bt", NA))
cred_1_sig$SD_sal_1 <- ifelse(cred_1_sig$SD3x3shortsal > 1, "variable_sal", 
                           ifelse(cred_1_sig$SD3x3shortsal < 1, "not_variable_sal", NA))
cred_1_sig$SD_sst_1 <- ifelse(cred_1_sig$SD3x3shortsst> 1, "variable_sst", 
                           ifelse(cred_1_sig$SD3x3shortsst< 1, "not_variable_sst", NA))
cred_1_sig$SD_gebco_1 <- ifelse(cred_1_sig$gebcoSD2 > 1, "rugged", 
                           ifelse(cred_1_sig$gebcoSD2 < 1, "not_rugged", NA))

cred_2_sig$temp_1 <- ifelse(cred_2_sig$bottemp > 1, "warm", 
                           ifelse(cred_2_sig$bottemp < 1, "cool", NA))
cred_2_sig$sal_1 <- ifelse(cred_2_sig$botsalin > 1,"saline", 
                           ifelse(cred_2_sig$botsalin < 1, "nonsaline", NA)) 
cred_2_sig$depth_1 <- ifelse(cred_2_sig$avgdepth > 1, "deep", 
                           ifelse(cred_2_sig$avgdepth < 1, "shallow", NA)) 
cred_2_sig$siltmud_1 <- ifelse(cred_2_sig$`SEDTYPESilt/Mud` > 1, "silt/mud", 
                           ifelse(cred_2_sig$`SEDTYPESilt/Mud` < 1, "nosilt/mud", NA)) 
cred_2_sig$sand_1 <- ifelse(cred_2_sig$SEDTYPESand > 1 , "sand", 
                           ifelse(cred_2_sig$SEDTYPESand < 1, "nosand", NA))
cred_2_sig$AMO_1 <- ifelse(cred_2_sig$AMOunsmyear  > 1, "AMO+", 
                           ifelse(cred_2_sig$AMOunsmyear  < 1, "AMO-", NA)) 
cred_2_sig$NAO_1 <- ifelse(cred_2_sig$NAOyear  > 1, "NAO+", 
                           ifelse(cred_2_sig$NAOyear  < 1, "NAO-", NA)) 
cred_2_sig$SD_bt_1 <- ifelse(cred_2_sig$SD3x3shortbt > 1, "variable_bt", 
                           ifelse(cred_2_sig$SD3x3shortbt < 1, "not_variable_bt", NA))
cred_2_sig$SD_sal_1 <- ifelse(cred_2_sig$SD3x3shortsal > 1, "variable_sal", 
                           ifelse(cred_2_sig$SD3x3shortsal < 1, "not_variable_sal", NA))
cred_2_sig$SD_sst_1 <- ifelse(cred_2_sig$SD3x3shortsst> 1, "variable_sst", 
                           ifelse(cred_2_sig$SD3x3shortsst< 1, "not_variable_sst", NA))
cred_2_sig$SD_gebco_1 <- ifelse(cred_2_sig$gebcoSD2 > 1, "rugged", 
                           ifelse(cred_2_sig$gebcoSD2< 1, "not_rugged", NA))

cred_tot_sig$temp_1 <- ifelse(cred_tot_sig$bottemp > 1, "warm", 
                           ifelse(cred_tot_sig$bottemp < 1, "cool", NA))
cred_tot_sig$sal_1 <- ifelse(cred_tot_sig$botsalin > 1,"saline", 
                           ifelse(cred_tot_sig$botsalin < 1, "nonsaline", NA)) 
cred_tot_sig$depth_1 <- ifelse(cred_tot_sig$avgdepth > 1, "deep", 
                           ifelse(cred_tot_sig$avgdepth < 1, "shallow", NA)) 
cred_tot_sig$siltmud_1 <- ifelse(cred_tot_sig$`SEDTYPESilt/Mud` > 1, "silt/mud", 
                           ifelse(cred_tot_sig$`SEDTYPESilt/Mud` < 1, "nosilt/mud", NA)) 
cred_tot_sig$sand_1 <- ifelse(cred_tot_sig$SEDTYPESand > 1 , "sand", 
                           ifelse(cred_tot_sig$SEDTYPESand < 1, "nosand", NA))
cred_tot_sig$AMO_1 <- ifelse(cred_tot_sig$AMOunsmyear  > 1, "AMO+", 
                           ifelse(cred_tot_sig$AMOunsmyear  < 1, "AMO-", NA)) 
cred_tot_sig$NAO_1 <- ifelse(cred_tot_sig$NAOyear  > 1, "NAO+", 
                           ifelse(cred_tot_sig$NAOyear  < 1, "NAO-", NA)) 
cred_tot_sig$SD_bt_1 <- ifelse(cred_tot_sig$SD3x3shortbt > 1, "variable_bt", 
                           ifelse(cred_tot_sig$SD3x3shortbt < 1, "not_variable_bt", NA))
cred_tot_sig$SD_sal_1 <- ifelse(cred_tot_sig$SD3x3shortsal > 1, "variable_sal", 
                           ifelse(cred_tot_sig$SD3x3shortsal < 1, "not_variable_sal", NA))
cred_tot_sig$SD_sst_1 <- ifelse(cred_tot_sig$SD3x3shortsst> 1, "variable_sst", 
                           ifelse(cred_tot_sig$SD3x3shortsst< 1, "not_variable_sst", NA))
cred_tot_sig$SD_gebco_1 <- ifelse(cred_tot_sig$gebcoSD2 > 1, "rugged", 
                           ifelse(cred_tot_sig$gebcoSD2< 1, "not_rugged", NA))

write.csv(cred_2_sig, file = "cred_2_sig_full.csv")
write.csv(cred_1_sig, file = "cred_1_sig_full.csv")
write.csv(cred_tot_sig, file="cred_tot_sig_full.csv")
```


```{r matching and shifts}
#find matching cases 
match <- charmatch(cred_1_sig$names, cred_2_sig$names)
cred_1_sig <- cbind(cred_1_sig, match)

#adding columns for descriptions 
cred_1_sig$var <- ifelse(grepl("bottemp", cred_1_sig$names), "temp",
                         ifelse(grepl("botsalin", cred_1_sig$names), "sal", 
                                ifelse(grepl("avgdepth", cred_1_sig$names), "depth",
                                       ifelse(grepl("SEDTYPESilt/Mud", cred_1_sig$names), "silt/mud",
                                               ifelse(grepl("SEDTYPESand", cred_1_sig$names), "sand",
                                                      ifelse(grepl("AMOunsmyear", cred_1_sig$names), "AMO",
                                                             ifelse(grepl("NAOyear", cred_1_sig$names),
                                                                    "NAO", NA)))))))

cred_1_sig$temp <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "temp", "warm", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "temp", "cool", NA))  

cred_1_sig$sal <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "sal", "saline", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "sal", "nonsaline", NA)) 

cred_1_sig$depth <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "depth", "deep", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "depth", "shallow", NA)) 

cred_1_sig$siltmud <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "silt/mud", "silt/mud", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "silt/mud", "nosilt/mud", NA)) 

cred_1_sig$sand <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "sand", "sand", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "sand", "nosand", NA))

cred_1_sig$AMO <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "AMO", "AMO+", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "AMO", "AMO-", NA)) 

cred_1_sig$NAO <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "NAO", "NAO+", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "NAO", "NAO-", NA)) 


#adding columns for descriptions for the second time period
cred_2_sig$var <- ifelse(grepl("bottemp", cred_2_sig$names), "temp",
                         ifelse(grepl("botsalin", cred_2_sig$names), "sal", 
                                ifelse(grepl("avgdepth", cred_2_sig$names), "depth",
                                       ifelse(grepl("SEDTYPESilt/Mud", cred_2_sig$names), "silt/mud",
                                               ifelse(grepl("SEDTYPESand", cred_2_sig$names), "sand",
                                                      ifelse(grepl("AMOunsmyear", cred_2_sig$names), "AMO",
                                                             ifelse(grepl("NAOyear", cred_2_sig$names),
                                                                    "NAO", NA)))))))

cred_2_sig$temp <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "temp", "warm", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "temp", "cool", NA))  

cred_2_sig$sal <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "sal", "saline", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "sal", "nonsaline", NA)) 

cred_2_sig$depth <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "depth", "deep", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "depth", "shallow", NA)) 

cred_2_sig$siltmud <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "silt/mud", "silt/mud", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "silt/mud", "nosilt/mud", NA)) 

cred_2_sig$sand <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "sand", "sand", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "sand", "nosand", NA))

cred_2_sig$AMO <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "AMO", "AMO+", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "AMO", "AMO-", NA)) 

cred_2_sig$NAO <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "NAO", "NAO+", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "NAO", "NAO-", NA)) 




#lets just compare the matching ones 
cred_1_sig_match <- cred_1_sig %>% 
   filter(!is.na(match)) 

cred_2_sig$match <- rownames(cred_2_sig)

new <- merge(cred_1_sig_match, cred_2_sig, by = "match")
write.csv(new, file="only_matching_sig_betas_2.csv")
#went into excel and highlighted the changed ones but also made column called change here is that file 
#change <- read.csv("~/Documents/ClimateOceanPlanning/R/NEFSC_GJAMM_GIT/only_matching_sig_betas_changeshown.csv")

#lets get the non matching ones to help us get at question 2 below 
cred_1_sig_nomatch <- cred_1_sig %>% 
   filter(is.na(match)) 
write.csv(cred_1_sig_nomatch, file="cred_1_sig_nomatch_2.csv")

#other way around also  
match2 <- charmatch(cred_2_sig$names, cred_1_sig$names)
cred_2_sig <- cred_2_sig %>% 
    select(-match) 
cred_2_sig <- cbind(cred_2_sig, match2)

cred_2_sig_nomatch <- cred_2_sig %>% 
   filter(is.na(match2)) 
write.csv(cred_2_sig_nomatch, file="cred_2_sig_nomatch_2.csv")


#total data adding columns 
cred_tot_sig$var <- ifelse(grepl("bottemp", cred_tot_sig$names), "temp",
                         ifelse(grepl("botsalin", cred_tot_sig$names), "sal", 
                                ifelse(grepl("avgdepth", cred_tot_sig$names), "depth",
                                       ifelse(grepl("SEDTYPESilt/Mud", cred_tot_sig$names), "silt/mud",
                                               ifelse(grepl("SEDTYPESand", cred_tot_sig$names), "sand",
                                                      ifelse(grepl("AMOunsmyear", cred_tot_sig$names), "AMO",
                                                             ifelse(grepl("NAOyear", cred_tot_sig$names),
                                                                    "NAO", NA)))))))

cred_tot_sig$temp <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "temp", "warm", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "temp", "cool", NA))  

cred_tot_sig$sal <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "sal", "saline", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "sal", "nonsaline", NA)) 

cred_tot_sig$depth <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "depth", "deep", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "depth", "shallow", NA)) 

cred_tot_sig$siltmud <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "silt/mud", "silt/mud", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "silt/mud", "nosilt/mud", NA)) 

cred_tot_sig$sand <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "sand", "sand", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "sand", "nosand", NA))

cred_tot_sig$AMO <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "AMO", "AMO+", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "AMO", "AMO-", NA)) 

cred_tot_sig$NAO <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "NAO", "NAO+", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "NAO", "NAO-", NA)) 


write.csv(cred_2_sig, file="cred_2_sig_all_2.csv")
write.csv(cred_1_sig, file="cred_1_sig_all_2.csv")
write.csv(cred_tot_sig, file="cred_tot_sig_2.csv")


```

##all
```{r matching and shifts for total}
#find matching cases 
match <- charmatch(cred_1_sig$names, cred_2_sig$names)
cred_1_sig <- cbind(cred_1_sig, match)

#adding columns for descriptions 
cred_1_sig$var <- ifelse(grepl("bottemp", cred_1_sig$names), "temp",
                         ifelse(grepl("botsalin", cred_1_sig$names), "sal", 
                                ifelse(grepl("avgdepth", cred_1_sig$names), "depth",
                                       ifelse(grepl("SEDTYPESilt/Mud", cred_1_sig$names), "silt/mud",
                                               ifelse(grepl("SEDTYPESand", cred_1_sig$names), "sand",
                                                      ifelse(grepl("AMOunsmyear", cred_1_sig$names), "AMO",
                                                             ifelse(grepl("NAOyear", cred_1_sig$names),
                                                                    "NAO", 
                                                                    ifelse(grepl("SD3x3shortsal", cred_1_sig$names), "SD_sal", 
                                                                        ifelse(grepl("SD3x3shortbt", cred_1_sig$names), "SD_bt", 
                                                                         ifelse(grepl("SD3x3shortsst", cred_1_sig$names), "SD_sst", 
                                                                                ifelse(grepl("gebcoSD2", cred_1_sig$names), "gebcoSD", NA)))))))))))


cred_1_sig$temp <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "temp", "warm", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "temp", "cool", NA))  

cred_1_sig$sal <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "sal", "saline", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "sal", "nonsaline", NA)) 

cred_1_sig$depth <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "depth", "deep", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "depth", "shallow", NA)) 

cred_1_sig$siltmud <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "silt/mud", "silt/mud", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "silt/mud", "nosilt/mud", NA)) 

cred_1_sig$sand <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "sand", "sand", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "sand", "nosand", NA))

cred_1_sig$AMO <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "AMO", "AMO+", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "AMO", "AMO-", NA)) 

cred_1_sig$NAO <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "NAO", "NAO+", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "NAO", "NAO-", NA)) 
cred_1_sig$SD_sal <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "SD_sal", "variable_sal", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "SD_sal", "notvariable_sal", NA)) 

cred_1_sig$SD_bt <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "SD_bt", "variable_bt", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "SD_bt", "notvariable_bt", NA)) 

cred_1_sig$SD_sst <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "SD_sst", "variable_sst", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "SD_sst", "notvariable_sst", NA)) 

cred_1_sig$gebco_SD <- ifelse(cred_1_sig$Estimate > 1 & cred_1_sig$var == "gebcoSD", "variable_gebco", 
                           ifelse(cred_1_sig$Estimate < 1 & cred_1_sig$var == "gebcoSD", "notvariable_gebco", NA))


#adding columns for descriptions for the second time period
cred_2_sig$var <- ifelse(grepl("bottemp", cred_2_sig$names), "temp",
                         ifelse(grepl("botsalin", cred_2_sig$names), "sal", 
                                ifelse(grepl("avgdepth", cred_2_sig$names), "depth",
                                       ifelse(grepl("SEDTYPESilt/Mud", cred_2_sig$names), "silt/mud",
                                               ifelse(grepl("SEDTYPESand", cred_2_sig$names), "sand",
                                                      ifelse(grepl("AMOunsmyear", cred_2_sig$names), "AMO",
                                                             ifelse(grepl("NAOyear", cred_2_sig$names), "NAO", 
                                                                    ifelse(grepl("SD3x3shortsal", cred_2_sig$names), "SD_sal", 
                                                                        ifelse(grepl("SD3x3shortbt", cred_2_sig$names), "SD_bt", 
                                                                         ifelse(grepl("SD3x3shortsst", cred_2_sig$names), "SD_sst", 
                                                                                ifelse(grepl("gebcoSD2", cred_2_sig$names), "gebcoSD", NA)))))))))))



cred_2_sig$temp <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "temp", "warm", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "temp", "cool", NA))  

cred_2_sig$sal <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "sal", "saline", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "sal", "nonsaline", NA)) 

cred_2_sig$depth <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "depth", "deep", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "depth", "shallow", NA)) 

cred_2_sig$siltmud <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "silt/mud", "silt/mud", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "silt/mud", "nosilt/mud", NA)) 

cred_2_sig$sand <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "sand", "sand", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "sand", "nosand", NA))

cred_2_sig$AMO <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "AMO", "AMO+", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "AMO", "AMO-", NA)) 

cred_2_sig$NAO <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "NAO", "NAO+", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "NAO", "NAO-", NA)) 

cred_2_sig$SD_sal <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "SD_sal", "variable_sal", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "SD_sal", "notvariable_sal", NA)) 

cred_2_sig$SD_bt <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "SD_bt", "variable_bt", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "SD_bt", "notvariable_bt", NA)) 

cred_2_sig$SD_sst <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "SD_sst", "variable_sst", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "SD_sst", "notvariable_sst", NA)) 

cred_2_sig$gebco_SD <- ifelse(cred_2_sig$Estimate > 1 & cred_2_sig$var == "gebcoSD", "variable_gebco", 
                           ifelse(cred_2_sig$Estimate < 1 & cred_2_sig$var == "gebcoSD", "notvariable_gebco", NA))


#total data adding columns 
cred_tot_sig$var <- ifelse(grepl("bottemp", cred_tot_sig$names), "temp",
                         ifelse(grepl("botsalin", cred_tot_sig$names), "sal", 
                                ifelse(grepl("avgdepth", cred_tot_sig$names), "depth",
                                       ifelse(grepl("SEDTYPESilt/Mud", cred_tot_sig$names), "silt/mud",
                                               ifelse(grepl("SEDTYPESand", cred_tot_sig$names), "sand",
                                                      ifelse(grepl("AMOunsmyear", cred_tot_sig$names), "AMO",
                                                             ifelse(grepl("NAOyear", cred_tot_sig$names),
                                                                    "NAO", 
                                                                    ifelse(grepl("SD3x3shortsal", cred_tot_sig$names), "SD_sal", 
                                                                        ifelse(grepl("SD3x3shortbt", cred_tot_sig$names), "SD_bt", 
                                                                         ifelse(grepl("SD3x3shortsst", cred_tot_sig$names), "SD_sst", 
                                                                                ifelse(grepl("gebcoSD2", cred_tot_sig$names), "gebcoSD", NA)))))))))))


cred_tot_sig$temp <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "temp", "warm", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "temp", "cool", NA))  

cred_tot_sig$sal <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "sal", "saline", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "sal", "nonsaline", NA)) 

cred_tot_sig$depth <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "depth", "deep", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "depth", "shallow", NA)) 

cred_tot_sig$siltmud <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "silt/mud", "silt/mud", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "silt/mud", "nosilt/mud", NA)) 

cred_tot_sig$sand <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "sand", "sand", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "sand", "nosand", NA))

cred_tot_sig$AMO <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "AMO", "AMO+", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "AMO", "AMO-", NA)) 

cred_tot_sig$NAO <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "NAO", "NAO+", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "NAO", "NAO-", NA)) 

cred_tot_sig$SD_sal <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "SD_sal", "variable_sal", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "SD_sal", "notvariable_sal", NA)) 

cred_tot_sig$SD_bt <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "SD_bt", "variable_bt", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "SD_bt", "notvariable_bt", NA)) 

cred_tot_sig$SD_sst <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "SD_sst", "variable_sst", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "SD_sst", "notvariable_sst", NA)) 

cred_tot_sig$gebco_SD <- ifelse(cred_tot_sig$Estimate > 1 & cred_tot_sig$var == "gebcoSD", "variable_gebco", 
                           ifelse(cred_tot_sig$Estimate < 1 & cred_tot_sig$var == "gebcoSD", "notvariable_gebco", NA))







```


Okay so we could have a few things happening. 
1. species relationship with BT could be positive in the first time period and negative in second (both significant relationships)
  Highlighted yellow in csv file only_matching_sig_betas_changeshown.csv
2. Species could have significant relationship with BT in first time period and that relationship isnt significant in the second. 
  Those cases are in cred_1_sig_no match (sig in first but not second) or cred_2_sig_nomatch (sig in    second but not first). All of thr changes are in the excel file Change_total. 
    in sigs_all sheet I have highlighted all of the species matching both cases 1 and 2 described above. 

I also have to go through and see if species were not caught (or not caught enought to be included in our gjam analysis) or if the relationship with the environment just wasn't significant. doing that now by highlihgting the ones with no significance in first then something significant in second and looking at all of the gjam beta outputs . 

#determining which specs 
```{r}

total <- read.csv("total.csv")
names(total)<-make.names(names(total),unique = TRUE)
total_1 <- subset(total, est_year < 2000)
sums_1 <- colSums(total_1[7:513])
names_1_sum <- rbind(colnames(total_1[7:513]), sums_1)

total_2 <- subset(total, est_year > 1999)
sums_2 <- colSums(total_2[7:513])
names_2_sum <- rbind(colnames(total_2[7:513]), sums_2)

sum_tot <- rbind(names_1_sum, names_2_sum)
sum_tot <- t(sum_tot)
sum_tot <- as.data.frame(sum_tot)

sum_tot$sums_1 <- as.numeric(sum_tot$sums_1)
sum_tot$sums_2 <- as.numeric(sum_tot$sums_2)

sum_tot_nozero <-sum_tot[ which(sum_tot$sums_1!=0 
& sum_tot$sums_2!=0 ), ]




fall_catch <- read.csv("~/Documents/ClimateOceanPlanning/Datasets/NEFSC_Bottom_Trawl/22560_FSCSTables_Fall/22560_UNION_FSCS_SVCAT.csv")
fall_x <- read.csv("~/Documents/ClimateOceanPlanning/Datasets/NEFSC_Bottom_Trawl/22560_FSCSTables_Fall/22560_UNION_FSCS_SVSTA.csv")

spring_catch <- read.csv("~/Documents/ClimateOceanPlanning/Datasets/NEFSC_Bottom_Trawl/22561_FSCSTables_spring/22561_UNION_FSCS_SVCAT.csv")
spring_x <- read.csv("~/Documents/ClimateOceanPlanning/Datasets/NEFSC_Bottom_Trawl/22561_FSCSTables_spring/22561_UNION_FSCS_SVSTA.csv")

#manipulated the catch data to be in tidy format 
fall_catch$id <- as.numeric(as.character(fall_catch$id))

#joining the tables 
fall_x$id <- as.numeric(as.character(fall_x$id))

fall_test <- left_join(fall_catch, fall_x, by="id")
fall_test <- fall_test %>% dplyr:::select(id, expcatchnum, scientific_name, est_year, est_month )


spring_catch$id <- as.numeric(as.character(spring_catch$id))

#joining the tables 
spring_x$id <- as.numeric(as.character(spring_x$id))

spring_test <- left_join(spring_catch, spring_x, by="id")
spring_test <- spring_test %>% dplyr:::select(id, expcatchnum, scientific_name, est_year, est_month )

tot_test <- rbind(spring_test, fall_test)

tot_test_1 <- subset(tot_test, est_year < 2000) 

tot_test_2 <- subset(tot_test, est_year > 1999)

#which species are present in multiple months in both time periods
tot_1_m <- tot_test_1 %>% group_by(scientific_name) %>% 
  summarise(
  months = length(unique(est_month)))

tot_2_m <- tot_test_2 %>% group_by(scientific_name) %>% 
  summarise(
  months = length(unique(est_month)))

tot_by_m <- left_join(tot_1_m, tot_2_m, by="scientific_name")
tot_by_m$scientific_name <- gsub(" ", ".", tot_by_m$scientific_name)
tot_by_m$scientific_name <- gsub("\\(", ".", tot_by_m$scientific_name)
tot_by_m$scientific_name <- gsub("\\)", ".", tot_by_m$scientific_name)
tot_by_m$scientific_name <- gsub("\\-", ".", tot_by_m$scientific_name)

write.csv(tot_by_m, file="total_months.csv")
tot_m_6 <- subset(tot_by_m, tot_by_m$months.x>5 & tot_by_m$months.y>5)
tot_m_4 <- subset(tot_by_m, tot_by_m$months.x>3 & tot_by_m$months.y>3)

tot_m_5 <- subset(tot_by_m, tot_by_m$months.x>4 & tot_by_m$months.y>4)

specnames_6 <- as.vector(tot_m_6$scientific_name)
specnames_5 <- as.vector(tot_m_5$scientific_name)

tot_6_orig <- left_join(tot_m_6, specnames_orig, by=c("scientific_name"="specNames"))

ycommon_all <- as.data.frame(ycommon_2)
ycommon_all$two <- 1
ycommon_1 <- as.data.frame(ycommon_1)
ycommon_1$one <-1
ycommon_all <- left_join(ycommon_all, ycommon_1, by =c("ycommon_2"= "ycommon_1"))

specnames_6 <- as.data.frame(specnames)
specnames_6$sixmo <- 1
ycommon_all <- left_join(ycommon_all, specnames_6, by =c("ycommon_2"= "specnames"))


sum_m_spec <- ycommon_all[ycommon_all$ycommon_2 %in% specnames,] 

```


#Shfiting ENV 
##mean centroids
This is to get at if the environment is changing or if species are changing with the environment. 
```{r load pacakges}
install.packages("sp")
library(sp)
install.packages("spatialEco")
library(spatialEco)
install.packages("geosphere")
library(geosphere)
```
this makes the dataset a spatial object
```{r}
total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")

total_for_sp <- total
names(total)<-make.names(names(total),unique = TRUE)
total_sp <- total_for_sp
coordinates(total_sp) <- ~ decdeg_beglon + decdeg_beglat


#Lets select out the time period chunks we need. 
total_sp_1 <- subset(total, est_year < 2000)
#trying to figure out if the 137 species i am using are present in all of these 
total_1 <- subset(total, est_year < 2000)
sums_1 <- colSums(total_1[7:513])
names_1_sum <- rbind(colnames(total_1[7:513]), sums_1)

#second time period 
total_2 <- subset(total, est_year > 1999)
sums_1 <- colSums(total_1[7:513])
names_1_sum <- rbind(colnames(total_1[7:513]), sums_1)

total_sp_2 <- subset(total, est_year > 1999)
sums_2 <- colSums(total_2[7:513])
names_2_sum <- rbind(colnames(total_2[7:513]), sums_2)

sum_tot <- rbind(names_1_sum, names_2_sum)
sum_tot <- t(sum_tot)
specnames_small <-specnames
specNames <- cred_order$names
specnames_orig <- as.data.frame(specNames)
specnames_orig$dot <- 1
sum_tot <- as.data.frame(sum_tot)

sum_tot_nozero <-sum_tot[ which(sum_tot$sums_1!=0 
& sum_tot$sums_2!=0 ), ]

sum_tot$sums_1 <- as.numeric(sum_tot$sums_1)
sum_tot$sums_2 <- as.numeric(sum_tot$sums_2)

sum_tot_twenty <-sum_tot[ which(sum_tot$sums_1 > 49 
& sum_tot$sums_2 > 49 ), ]

sum_tot_with_orig <- left_join(sum_tot, specnames_orig, by=c("V1"="specNames"))

specnames_dist <- as.vector(sum_tot_nozero$V1)
#total_sp_85_90 <- subset(total, est_year < 1991)
#total_sp_12_17 <- subset(total, est_year > 2011)

sum_tot_spec <- sum_tot_nozero[sum_tot_nozero$V1 %in% specNames,] 

sum_tot_spec_2 <- sum_tot_twenty[sum_tot_twenty$V1 %in% specNames,] 

specNames <- as.vector(sum_tot_spec$V1)

#now make all of those spatial objects: 

coordinates(total_sp_1) <- ~ decdeg_beglon + decdeg_beglat

coordinates(total_sp_2) <- ~ decdeg_beglon + decdeg_beglat

coordinates(total_sp_85_90) <- ~ decdeg_beglon + decdeg_beglat

coordinates(total_sp_12_17) <- ~ decdeg_beglon + decdeg_beglat

```

Now we can only do this for species that were duplicated in all of them. I went back to the excel file (Change_total.xls) and got out all of the species that had significant relationships with the ENV and were duplicated in the two time periods (tab is called specnames). 

lets find which species were in both the cred_1_sig and cred_2_sig columns: 

```{r}

names_1 <- data.frame(table(cred_1_sig$names))
names_1 <- names_1 %>% separate(col=Var1, sep="([_])", into=c("names", "var"))
names_1 <- names_1 %>%  group_by(names) %>% 
  summarise(
  freq = mean(freq))
  


names_2 <- data.frame(table(cred_2_sig$names))
names_2 <- names_2 %>% separate(col=Var1, sep="([_])", into=c("names", "var"))
names_2 <- names_2 %>%  group_by(names) %>% 
  summarise(
  freq = mean(freq))
  



names <- rbind(names_1, names_2)
names_rep <- names[duplicated(names$names),]
specnames <- as.vector(names_rep$Var1)

write.csv(specnames, file="specnames.csv")

#actually use specnames_large here 
```

```{r}
specnames_1<-c("Alosa_aestivalis_(blueback_herring)", "Alosa_pseudoharengus_(alewife)", "Alosa_sapidissima_(American_shad)", "Amblyraja_radiata_(thorny_skate)", "Ammodytes_dubius_(northern_sand_lance)", "Anchoa_hepsetus_(striped_anchovy)", "Anchoa_mitchilli_(bay_anchovy)", "Argentina_silus_(Atlantic_argentine)", "Aspidophoroides_monopterygius_(alligatorfish)", "Atlantopandalus_propinqvus_()", "Bairdiella_chrysoura_(silver_perch)", "Brevoortia_tyrannus_(Atlantic_menhaden)", "Callinectes_sapidus_(blue_crab)", "Cancer_borealis_(Jonah_crab)", "Cancer_irroratus_(Atlantic_rock_crab)", "Caridea", "Centropristis_striata_(black_sea_bass)", "Chaceon_quinquedens_(red_deepsea_crab)", "Chlorophthalmus_agassizi_(shortnose_greeneye)", "Citharichthys_arctifrons_(Gulf_stream_flounder)", "Clupea_harengus_(Atlantic_herring)", "Crangon_septemspinosa_(sevenspine_bay_shrimp)", "Cryptacanthodes_maculatus_(wrymouth)", "Cynoscion_regalis_(weakfish)", "Dasyatis_say_(bluntnose_stingray)", "Decapterus_punctatus_(round_scad)", "Dichelopandalus_leptocerus_(bristled_longbeak)", "Dipturus_laevis_(barndoor_skate)", "Enchelyopus_cimbrius_(fourbeard_rockling)", "Etropus_microstomus_(smallmouth_flounder)", "Etrumeus_teres_(round_herring)", "Gadus_morhua_(Atlantic_cod)", "Glyptocephalus_cynoglossus_(witch_flounder)", "Helicolenus_dactylopterus_(blackbelly_rosefish)", "Hemitripterus_americanus_(sea_raven)", "Hippoglossina_oblonga_(fourspot_flounder)", "Hippoglossoides_platessoides_(American_plaice)", "Homarus_americanus_(American_lobster)", "Illex_illecebrosus_(northern_shortfin_squid)", "Lagodon_rhomboides_(pinfish)", "Larimus_fasciatus_(banded_drum)", "Leiostomus_xanthurus_(spot)", "Lepophidium_profundorum_(fawn_cusk-eel)", "Leptoclinus_maculatus_(daubed_shanny)", "Leucoraja_erinacea_(little_skate)", "Leucoraja_garmani_(rosette_skate)", "Leucoraja_ocellata_(winter_skate)", "Limanda_ferruginea_(yellowtail_flounder)", "Limulus_polyphemus_(horseshoe_crab)", "Loligo_pealeii_(longfin_squid)", "Lophius_americanus_(goosefish)", "Macrouridae", "Malacoraja_senta_(smooth_skate)", "Maurolicus_weitzmani_(Weitzmans_pearlsides)", "Melanogrammus_aeglefinus_(haddock)", "Melanostigma_atlanticum_(Atlantic_soft_pout)", "Menidia_menidia_(Atlantic_silverside)", "Menticirrhus_americanus_(southern_kingfish)")


specnames_2 <- c("Menticirrhus_saxatilis_(northern_kingfish)", "Merluccius_albidus_(offshore_hake)", "Merluccius_bilinearis_(silver_hake)", "Micropogonias_undulatus_(Atlantic_croaker)", "Morone_saxatilis_(striped_bass)", "Mustelus_canis_(smooth_dogfish)", "Myctophidae", "Myliobatis_freminvillii_(bullnose_ray)", "Myoxocephalus_octodecemspinosus_(longhorn_sculpin)", "Opisthonema_oglinum_(Atlantic_thread_herring)", "Orthopristis_chrysoptera_(pigfish)", "Ovalipes_ocellatus_(lady_crab)", "Ovalipes_stephensoni_(coarsehand_lady_crab)", "Pandalus_borealis_(northern_shrimp)", "Pandalus_montagui_(Aesop_shrimp)", "Paralichthys_dentatus_(summer_flounder)", "Pasiphaea_multidentata_(pink_glass_shrimp)", "Penaeus", "Peprilus_triacanthus_(butterfish)", "Phycis_chesteri_(longfin_hake)", "Placopecten_magellanicus_(sea_scallop)", "Pollachius_virens_(pollock)", "Polymixia_lowei_(beardfish)", "Pomatomus_saltatrix_(bluefish)", "Prionotus_carolinus_(northern_searobin)", "Prionotus_evolans_(striped_searobin)", "Pseudopleuronectes_americanus_(winter_flounder)", "Raja_eglanteria_(clearnose_skate)", "Rhizoprionodon_terraenovae_(Atlantic_sharpnose_shark)", "Sardinella_aurita_(Spanish_sardine)", "Scomber_scombrus_(Atlantic_mackerel)", "Scophthalmus_aquosus_(windowpane)", "Sebastes_fasciatus_(Acadian_redfish)", "Selene_setapinnis_(Atlantic_moonfish)", "Sphoeroides_maculatus_(northern_puffer)", "Squalus_acanthias_(spiny_dogfish)", "Stenotomus_chrysops_(scup)", "Stephanolepis_hispida_(planehead_filefish)", "Syngnathus_fuscus_(northern_pipefish)", "Synodus_foetens_(inshore_lizardfish)", "Tautogolabrus_adspersus_(cunner)", "Trachinocephalus_myops_(snakefish)", "Trachurus_lathami_(rough_scad)", "Trichiurus_lepturus_(Atlantic_cutlassfish)", "Triglops_murrayi_(moustache_sculpin)", "Urophycis_chuss_(red_hake)", "Urophycis_regia_(spotted_hake)", "Urophycis_tenuis_(white_hake)", "Zenopsis_conchifera_(buckler_dory)", "Zoarces_americanus_(ocean_pout)")

specnames <- c(specnames_1, specnames_2)


#figure this out for the 5 year chunks as well! 

specnames_1<-c("Alosa_aestivalis_.blueback_herring.", "Alosa_pseudoharengus_.alewife.", "Alosa_sapidissima_.American_shad.", "Amblyraja_radiata_.thorny_skate.", "Ammodytes_dubius_.northern_sand_lance.", "Anchoa_hepsetus_.striped_anchovy.", "Anchoa_mitchilli_.bay_anchovy.", "Argentina_silus_.Atlantic_argentine.", "Aspidophoroides_monopterygius_.alligatorfish.", "Bairdiella_chrysoura_.silver_perch.", "Brevoortia_tyrannus_.Atlantic_menhaden.", "Callinectes_sapidus_.blue_crab.", "Cancer_borealis_.Jonah_crab.", "Cancer_irroratus_.Atlantic_rock_crab.", "Caridea", "Centropristis_striata_.black_sea_bass.", "Chaceon_quinquedens_.red_deepsea_crab.", "Chlorophthalmus_agassizi_.shortnose_greeneye.", "Citharichthys_arctifrons_.Gulf_stream_flounder.", "Clupea_harengus_.Atlantic_herring.", "Cryptacanthodes_maculatus_.wrymouth.", "Cynoscion_regalis_.weakfish.", "Dasyatis_say_.bluntnose_stingray.", "Decapterus_punctatus_.round_scad.", "Dipturus_laevis_.barndoor_skate.", "Enchelyopus_cimbrius_.fourbeard_rockling.", "Etropus_microstomus_.smallmouth_flounder.", "Etrumeus_teres_.round_herring.", "Gadus_morhua_.Atlantic_cod.", "Glyptocephalus_cynoglossus_.witch_flounder.", "Helicolenus_dactylopterus_.blackbelly_rosefish.", "Hemitripterus_americanus_.sea_raven.", "Hippoglossina_oblonga_.fourspot_flounder.", "Hippoglossoides_platessoides_.American_plaice.", "Homarus_americanus_.American_lobster.", "Illex_illecebrosus_.northern_shortfin_squid.", "Lagodon_rhomboides_.pinfish.", "Larimus_fasciatus_.banded_drum.", "Leiostomus_xanthurus_.spot.", "Lepophidium_profundorum_.fawn_cusk.eel.", "Leptoclinus_maculatus_.daubed_shanny.", "Leucoraja_erinacea_.little_skate.", "Leucoraja_garmani_.rosette_skate.", "Leucoraja_ocellata_.winter_skate.", "Limanda_ferruginea_.yellowtail_flounder.", "Limulus_polyphemus_.horseshoe_crab.", "Loligo_pealeii_.longfin_squid.", "Lophius_americanus_.goosefish.", "Macrouridae", "Malacoraja_senta_.smooth_skate.", "Maurolicus_weitzmani_.Weitzmans_pearlsides.", "Melanogrammus_aeglefinus_.haddock.", "Melanostigma_atlanticum_.Atlantic_soft_pout.", "Menidia_menidia_.Atlantic_silverside.", "Menticirrhus_americanus_.southern_kingfish.")


specnames_2 <- c("Menticirrhus_saxatilis_.northern_kingfish.", "Merluccius_albidus_.offshore_hake.", "Merluccius_bilinearis_.silver_hake.", "Micropogonias_undulatus_.Atlantic_croaker.", "Morone_saxatilis_.striped_bass.", "Mustelus_canis_.smooth_dogfish.", "Myctophidae", "Myliobatis_freminvillii_.bullnose_ray.", "Myoxocephalus_octodecemspinosus_.longhorn_sculpin.", "Opisthonema_oglinum_.Atlantic_thread_herring.", "Orthopristis_chrysoptera_.pigfish.", "Ovalipes_ocellatus_.lady_crab.", "Ovalipes_stephensoni_.coarsehand_lady_crab.", "Pandalus_borealis_.northern_shrimp.", "Paralichthys_dentatus_.summer_flounder.", "Penaeus", "Peprilus_triacanthus_.butterfish.", "Phycis_chesteri_.longfin_hake.", "Placopecten_magellanicus_.sea_scallop.", "Pollachius_virens_.pollock.", "Polymixia_lowei_.beardfish.", "Pomatomus_saltatrix_.bluefish.", "Prionotus_carolinus_.northern_searobin.", "Prionotus_evolans_.striped_searobin.", "Pseudopleuronectes_americanus_.winter_flounder.", "Raja_eglanteria_.clearnose_skate.", "Rhizoprionodon_terraenovae_.Atlantic_sharpnose_shark.", "Sardinella_aurita_.Spanish_sardine.", "Scomber_scombrus_.Atlantic_mackerel.", "Scophthalmus_aquosus_.windowpane.", "Sebastes_fasciatus_.Acadian_redfish.", "Selene_setapinnis_.Atlantic_moonfish.", "Sphoeroides_maculatus_.northern_puffer.", "Squalus_acanthias_.spiny_dogfish.", "Stenotomus_chrysops_.scup.", "Stephanolepis_hispida_.planehead_filefish.", "Syngnathus_fuscus_.northern_pipefish.", "Synodus_foetens_.inshore_lizardfish.", "Tautogolabrus_adspersus_.cunner.", "Trachinocephalus_myops_.snakefish.", "Trachurus_lathami_.rough_scad.", "Trichiurus_lepturus_.Atlantic_cutlassfish.", "Triglops_murrayi_.moustache_sculpin.", "Urophycis_chuss_.red_hake.", "Urophycis_regia_.spotted_hake.", "Urophycis_tenuis_.white_hake.", "Zenopsis_conchifera_.buckler_dory.", "Zoarces_americanus_.ocean_pout.")
specnames <- c(specnames_1, specnames_2)



#for the second iteration of running the model 
specnames_1<-c("Alosa_aestivalis_.blueback_herring.", "Alosa_pseudoharengus_.alewife.", "Alosa_sapidissima_.American_shad.", "Amblyraja_radiata_.thorny_skate.", "Ammodytes_dubius_.northern_sand_lance.", "Anchoa_hepsetus_.striped_anchovy.", "Anchoa_mitchilli_.bay_anchovy.", "Atlantopandalus_propinqvus_..", "Brevoortia_tyrannus_.Atlantic_menhaden.", "Callinectes_sapidus_.blue_crab.", "Cancer_irroratus_.Atlantic_rock_crab.", "Caridea", "Centropristis_striata_.black_sea_bass.", "Chlorophthalmus_agassizi_.shortnose_greeneye.", "Citharichthys_arctifrons_.Gulf_stream_flounder.", "Clupea_harengus_.Atlantic_herring.", "Crangon_septemspinosa_.sevenspine_bay_shrimp.", "Cynoscion_regalis_.weakfish.", "Dasyatis_say_.bluntnose_stingray.", "Decapterus_punctatus_.round_scad.", "Dichelopandalus_leptocerus_.bristled_longbeak.", "Etropus_microstomus_.smallmouth_flounder.", "Etrumeus_teres_.round_herring.", "Gadus_morhua_.Atlantic_cod.", "Glyptocephalus_cynoglossus_.witch_flounder.", "Helicolenus_dactylopterus_.blackbelly_rosefish.", "Hemitripterus_americanus_.sea_raven.", "Hippoglossina_oblonga_.fourspot_flounder.", "Hippoglossoides_platessoides_.American_plaice.", "Homarus_americanus_.American_lobster.", "Illex_illecebrosus_.northern_shortfin_squid.", "Leiostomus_xanthurus_.spot.", "Lepophidium_profundorum_.fawn_cusk.eel.", "Leptoclinus_maculatus_.daubed_shanny.", "Leucoraja_erinacea_.little_skate.", "Leucoraja_ocellata_.winter_skate.", "Limanda_ferruginea_.yellowtail_flounder.", "Loligo_pealeii_.longfin_squid.", "Lophius_americanus_.goosefish.", "Malacoraja_senta_.smooth_skate.", "Maurolicus_weitzmani_.Weitzmans_pearlsides.", "Melanogrammus_aeglefinus_.haddock.", "Melanostigma_atlanticum_.Atlantic_soft_pout.", "Menidia_menidia_.Atlantic_silverside.", "Menticirrhus_americanus_.southern_kingfish.")


specnames_2 <- c("Menticirrhus_saxatilis_.northern_kingfish.", "Merluccius_bilinearis_.silver_hake.", "Micropogonias_undulatus_.Atlantic_croaker.", "Morone_saxatilis_.striped_bass.", "Mustelus_canis_.smooth_dogfish.", "Myctophidae", "Myliobatis_freminvillii_.bullnose_ray.", "Myoxocephalus_octodecemspinosus_.longhorn_sculpin.", "Opisthonema_oglinum_.Atlantic_thread_herring.", "Orthopristis_chrysoptera_.pigfish.", "Ovalipes_ocellatus_.lady_crab.", "Ovalipes_stephensoni_.coarsehand_lady_crab.", "Pandalus_borealis_.northern_shrimp.", "Pandalus_montagui_.Aesop_shrimp.", "Paralichthys_dentatus_.summer_flounder.", "Pasiphaea_multidentata_.pink_glass_shrimp.", "Penaeus", "Peprilus_triacanthus_.butterfish.", "Phycis_chesteri_.longfin_hake.", "Placopecten_magellanicus_.sea_scallop.", "Pollachius_virens_.pollock.", "Pomatomus_saltatrix_.bluefish.", "Prionotus_carolinus_.northern_searobin.", "Prionotus_evolans_.striped_searobin.", "Pseudopleuronectes_americanus_.winter_flounder.", "Raja_eglanteria_.clearnose_skate.", "Sardinella_aurita_.Spanish_sardine.", "Scomber_scombrus_.Atlantic_mackerel.", "Scophthalmus_aquosus_.windowpane.", "Sebastes_fasciatus_.Acadian_redfish.", "Selene_setapinnis_.Atlantic_moonfish.", "Sphoeroides_maculatus_.northern_puffer.", "Squalus_acanthias_.spiny_dogfish.", "Stenotomus_chrysops_.scup.", "Stephanolepis_hispida_.planehead_filefish.", "Synodus_foetens_.inshore_lizardfish.", "Trachurus_lathami_.rough_scad.", "Triglops_murrayi_.moustache_sculpin.", "Urophycis_chuss_.red_hake.", "Urophycis_regia_.spotted_hake.", "Urophycis_tenuis_.white_hake.", "Zoarces_americanus_.ocean_pout.")
specnames_test <- c(specnames_1, specnames_2)

#second iteration, 5 year chunks 
#for the second iteration of running the model 
specnames_1<-c("Alosa_aestivalis_.blueback_herring.", "Alosa_pseudoharengus_.alewife.", "Alosa_sapidissima_.American_shad.", "Amblyraja_radiata_.thorny_skate.", "Ammodytes_dubius_.northern_sand_lance.", "Anchoa_hepsetus_.striped_anchovy.", "Anchoa_mitchilli_.bay_anchovy.", "Brevoortia_tyrannus_.Atlantic_menhaden.", "Callinectes_sapidus_.blue_crab.", "Cancer_irroratus_.Atlantic_rock_crab.", "Caridea", "Centropristis_striata_.black_sea_bass.", "Chlorophthalmus_agassizi_.shortnose_greeneye.", "Citharichthys_arctifrons_.Gulf_stream_flounder.", "Clupea_harengus_.Atlantic_herring.", "Cynoscion_regalis_.weakfish.", "Dasyatis_say_.bluntnose_stingray.", "Decapterus_punctatus_.round_scad.", "Etropus_microstomus_.smallmouth_flounder.", "Etrumeus_teres_.round_herring.", "Gadus_morhua_.Atlantic_cod.", "Glyptocephalus_cynoglossus_.witch_flounder.", "Helicolenus_dactylopterus_.blackbelly_rosefish.", "Hemitripterus_americanus_.sea_raven.", "Hippoglossina_oblonga_.fourspot_flounder.", "Hippoglossoides_platessoides_.American_plaice.", "Homarus_americanus_.American_lobster.", "Illex_illecebrosus_.northern_shortfin_squid.", "Leiostomus_xanthurus_.spot.", "Lepophidium_profundorum_.fawn_cusk.eel.", "Leptoclinus_maculatus_.daubed_shanny.", "Leucoraja_erinacea_.little_skate.", "Leucoraja_ocellata_.winter_skate.", "Limanda_ferruginea_.yellowtail_flounder.", "Loligo_pealeii_.longfin_squid.", "Lophius_americanus_.goosefish.", "Malacoraja_senta_.smooth_skate.", "Maurolicus_weitzmani_.Weitzmans_pearlsides.", "Melanogrammus_aeglefinus_.haddock.", "Melanostigma_atlanticum_.Atlantic_soft_pout.", "Menidia_menidia_.Atlantic_silverside.", "Menticirrhus_americanus_.southern_kingfish.")


specnames_2 <- c("Menticirrhus_saxatilis_.northern_kingfish.", "Merluccius_bilinearis_.silver_hake.", "Micropogonias_undulatus_.Atlantic_croaker.", "Morone_saxatilis_.striped_bass.", "Mustelus_canis_.smooth_dogfish.", "Myliobatis_freminvillii_.bullnose_ray.", "Myoxocephalus_octodecemspinosus_.longhorn_sculpin.", "Opisthonema_oglinum_.Atlantic_thread_herring.", "Orthopristis_chrysoptera_.pigfish.", "Ovalipes_ocellatus_.lady_crab.", "Ovalipes_stephensoni_.coarsehand_lady_crab.", "Pandalus_borealis_.northern_shrimp.", "Paralichthys_dentatus_.summer_flounder.", "Penaeus", "Peprilus_triacanthus_.butterfish.", "Phycis_chesteri_.longfin_hake.", "Placopecten_magellanicus_.sea_scallop.", "Pollachius_virens_.pollock.", "Pomatomus_saltatrix_.bluefish.", "Prionotus_carolinus_.northern_searobin.", "Prionotus_evolans_.striped_searobin.", "Pseudopleuronectes_americanus_.winter_flounder.", "Raja_eglanteria_.clearnose_skate.", "Sardinella_aurita_.Spanish_sardine.", "Scomber_scombrus_.Atlantic_mackerel.", "Scophthalmus_aquosus_.windowpane.", "Sebastes_fasciatus_.Acadian_redfish.", "Selene_setapinnis_.Atlantic_moonfish.", "Sphoeroides_maculatus_.northern_puffer.", "Squalus_acanthias_.spiny_dogfish.", "Stenotomus_chrysops_.scup.", "Stephanolepis_hispida_.planehead_filefish.", "Synodus_foetens_.inshore_lizardfish.", "Trachurus_lathami_.rough_scad.", "Triglops_murrayi_.moustache_sculpin.", "Urophycis_regia_.spotted_hake.", "Urophycis_tenuis_.white_hake.", "Zoarces_americanus_.ocean_pout.")
specnames_5yr <- c(specnames_1, specnames_2)

```

weighted centroid
```{r weighted centroid}
#first time chunk 

spec_coords_1 <- data.frame(name=rep(0,400), x=rep(0,400), y=rep(0,400))

for (i in 1:length(specnames_dist)) { #for each species in spec_list
  wt.try <- wt.centroid(total_sp_1, specnames_dist[i])
  name <- specnames[i]
  xcord <- wt.try@coords[1]
  ycord <- wt.try@coords[2] 
  spec_coords_1[i,] = c(name, xcord, ycord)
}

#For the 2nd time chunk

spec_coords_2 <- data.frame(name=rep(0,400), x=rep(0,400), y=rep(0,400))
for (i in 1:length(specnames_dist)) { #for each species in spec_list
  wt.try <- wt.centroid(total_sp_2, specnames_dist[i])
  name <- specnames[i]
  xcord <- wt.try@coords[1]
  ycord <- wt.try@coords[2] 
  spec_coords_2[i,] = c(name, xcord, ycord)
}
```

```{r 5 years}
#first 5 years 
spec_coords_85_90 <- data.frame(name=rep(0,80), x=rep(0,80), y=rep(0,80))
for (i in 1:length(specnames_5yr)) { #for each species in spec_list
  wt.try <- wt.centroid(total_sp_85_90, specnames_5yr[i])
  name <- specnames_5yr[i]
  xcord <- wt.try@coords[1]
  ycord <- wt.try@coords[2] 
  spec_coords_85_90[i,] = c(name, xcord, ycord)
}

#2nd 5 year chunk

spec_coords_12_17 <- data.frame(name=rep(0,80), x=rep(0,80), y=rep(0,80))
for (i in 1:length(specnames_5yr)) { #for each species in spec_list
  wt.try <- wt.centroid(total_sp_12_17, specnames_5yr[i])
  name <- specnames_5yr[i]
  xcord <- wt.try@coords[1]
  ycord <- wt.try@coords[2] 
  spec_coords_12_17[i,] = c(name, xcord, ycord)
}

```

```{r}
all_specs <- cbind(spec_coords_1,spec_coords_2)

colnames(spec_coords_1) <- c("name", "Longitude_1", "Latitude_1")
colnames(spec_coords_2) <- c("name", "Longitude_2", "Latitude_2")

spec_coords_1$Latitude_1 <- as.numeric(spec_coords_1$Latitude_1)
spec_coords_1$Longitude_1 <- as.numeric(spec_coords_1$Longitude_1)

spec_coords_2$Latitude_2 <- as.numeric(spec_coords_2$Latitude_2)
spec_coords_2$Longitude_2 <- as.numeric(spec_coords_2$Longitude_2)

#5 year periods 
all_specs_2 <- cbind(spec_coords_85_90,spec_coords_12_17)

colnames(spec_coords_85_90) <- c("name", "Longitude_1", "Latitude_1")
colnames(spec_coords_12_17) <- c("name", "Longitude_2", "Latitude_2")

spec_coords_85_90$Latitude_1 <- as.numeric(spec_coords_85_90$Latitude_1)
spec_coords_85_90$Longitude_1 <- as.numeric(spec_coords_85_90$Longitude_1)

spec_coords_12_17$Latitude_2 <- as.numeric(spec_coords_12_17$Latitude_2)
spec_coords_12_17$Longitude_2 <- as.numeric(spec_coords_12_17$Longitude_2)

```

this calculates the geodesic distance between the two points

```{r geodesic distance}

dist_total <- as.data.frame(distGeo(spec_coords_1[2:3], spec_coords_2[2:3]))
dist_total <- cbind(specnames_dist, dist_total)
dist_total <- cbind(dist_total, spec_coords_1)
dist_total <- cbind(dist_total, spec_coords_2)

write.csv(dist_total, "dist_total_full_400.csv")
dist_total <- read.csv("dist_total_full_400.csv")
#lets save all of the mean centroid coordinates to map later
write.csv(spec_coords_1, "spec_coords_1_full_2.csv")
write.csv(spec_coords_2, "spec_coords_2_full_2.csv")

#for 5 year chunks
dist_total_5yr <- as.data.frame(distGeo(spec_coords_85_90[2:3], spec_coords_12_17[2:3]))
dist_total_5yr <- cbind(specnames_5yr, dist_total_5yr)
dist_total_5yr <- cbind(dist_total_5yr, spec_coords_85_90)
dist_total_5yr <- cbind(dist_total_5yr, spec_coords_12_17)

write.csv(dist_total_5yr, "dist_total_5yr_2.csv")

#lets save all of the mean centroid coordinates to map later
write.csv(spec_coords_85_90, "spec_coords_85_90_2.csv")
write.csv(spec_coords_12_17, "spec_coords_12_17_2.csv")

```

```{r distance IQR and box plot}
boxplot(dist_total$`distGeo(spec_coords_1[2:3], spec_coords_2[2:3])`)
dist <- dist_total$`distGeo(spec_coords_1[2:3], spec_coords_2[2:3])`
Q3 <- quantile(dist, 0.75)
Q1 <- quantile(dist, 0.25)

lat <- dist_total$Latitude_1
Q3_lat <- quantile(lat, 0.75)
Q1_lat <- quantile(lat, 0.25)

```

##minimum convex hull 
```{r}
#note these use 95% but could also do 100 

#need to have the original data to do this one
fall_catch <- read.csv("~/Documents/ClimateOceanPlanning/Datasets/NEFSC_Bottom_Trawl/22560_FSCSTables_Fall/22560_UNION_FSCS_SVCAT.csv")
fall_x <- read.csv("~/Documents/ClimateOceanPlanning/Datasets/NEFSC_Bottom_Trawl/22560_FSCSTables_Fall/22560_UNION_FSCS_SVSTA.csv")

#manipulated the catch data to be in tidy format 
fall_catch$id <- as.numeric(as.character(fall_catch$id))

#joining the tables 
fall_x$id <- as.numeric(as.character(fall_x$id))
fall <- left_join(fall_catch, fall_x, by="id")
fall$season <- "fall"

spring_catch <- read.csv("~/Documents/ClimateOceanPlanning/Datasets/NEFSC_Bottom_Trawl/22561_FSCSTables_spring/22561_UNION_FSCS_SVCAT.csv")
spring_x <- read.csv("~/Documents/ClimateOceanPlanning/Datasets/NEFSC_Bottom_Trawl/22561_FSCSTables_spring/22561_UNION_FSCS_SVSTA.csv")

#manipulated the catch data to be in tidy format 
spring_catch$id <- as.numeric(as.character(spring_catch$id))

#joining the tables 
spring_x$id <- as.numeric(as.character(spring_x$id))
spring <- left_join(spring_catch, spring_x, by="id")
spring$season <- "spring"

total_big <- rbind(fall, spring)
total_big_1 <- as.data.frame(total_big)
total_big_1 <- subset(total_big_1, total_big_1$est_year >= 1984)

total_big_1 <- total_big_1 %>% 
  dplyr::select(scientific_name, decdeg_beglon, decdeg_beglat) %>% 
  rename(ID=scientific_name)


#check if any specs have less than 5 relocations using dplyr
total_big_1 <- subset(total_big_1, ID %in% names(which(table(ID) >= 5))) 
total_big_1$ID <- factor(total_big_1$ID)

#make a spatial object
total_big_sp <- total_big_1 %>% drop_na()
coordinates(total_big_sp) <- ~ decdeg_beglon + decdeg_beglat


library(adehabitatHR)


spec_hull_tot <- mcp(total_big_sp[,1], percent=95)
spec_hull_tot_area <- as.data.frame(spec_hull_tot[])


#now for two time chunks
total_big <- rbind(fall, spring)
total_big_1 <- as.data.frame(total_big)
total_big_1 <- subset(total_big_1, total_big_1$est_year >= 1984)


total_big_first <- subset(total_big_1, est_year < 2000)
total_big_second <- subset(total_big_1, est_year > 1999)

#first
total_big_first <- total_big_first %>% 
  dplyr::select(scientific_name, decdeg_beglon, decdeg_beglat) %>% 
  rename(ID=scientific_name)


#check if any specs have less than 5 relocations using dplyr
total_big_first <- subset(total_big_first, ID %in% names(which(table(ID) >= 5)))
total_big_first$ID <- factor(total_big_first$ID)

#make a spatial object
total_big_first_sp <- total_big_first %>% drop_na()
coordinates(total_big_first_sp) <- ~ decdeg_beglon + decdeg_beglat

library(adehabitatHR)


spec_hull_first <- mcp(total_big_first_sp[,1], percent=95)
spec_hull_first_area <- as.data.frame(spec_hull_first[])
plot(spec_hull_tot)

#second
total_big_second <- total_big_second %>% 
  dplyr::select(scientific_name, decdeg_beglon, decdeg_beglat) %>% 
  rename(ID=scientific_name)


#check if any specs have less than 5 relocations using dplyr
total_big_second <- subset(total_big_second, ID %in% names(which(table(ID) >= 5)))
total_big_second$ID <- factor(total_big_second$ID)

#make a spatial object
total_big_second_sp <- total_big_second %>% drop_na()
coordinates(total_big_second_sp) <- ~ decdeg_beglon + decdeg_beglat

library(adehabitatHR)


spec_hull_second <- mcp(total_big_second_sp[,1], percent=95)
spec_hull_second_area <- as.data.frame(spec_hull_second[])

write.csv(spec_hull_tot_area, file="spec_hull_tot_area.csv")
write.csv(spec_hull_first_area, file="spec_hull_first_area.csv")
write.csv(spec_hull_second_area, file="spec_hull_second_area.csv")

library(rgdal)
#write these out to shapefiles
writeOGR(spec_hull_tot, layer= "homerange", driver="ESRI Shapefile", dsn="spechull")
writeOGR(spec_hull_first, layer= "homerange_1", driver="ESRI Shapefile", dsn="spechull")
writeOGR(spec_hull_second, layer= "homerange_2", driver="ESRI Shapefile", dsn="spechull")



#5 year time periods 
total_big <- rbind(fall, spring)
total_big_1 <- as.data.frame(total_big)
total_big_1 <- subset(total_big_1, total_big_1$est_year >= 1984)


total_big_first <- subset(total_big_1, est_year < 1991)
total_big_second <- subset(total_big_1, est_year > 2011)

#first
total_big_first <- total_big_first %>% 
  dplyr::select(scientific_name, decdeg_beglon, decdeg_beglat) %>% 
  rename(ID=scientific_name)


#check if any specs have less than 5 relocations using dplyr
total_big_first <- subset(total_big_first, ID %in% names(which(table(ID) >= 5)))
total_big_first$ID <- factor(total_big_first$ID)

#make a spatial object
total_big_first_sp <- total_big_first %>% drop_na()
coordinates(total_big_first_sp) <- ~ decdeg_beglon + decdeg_beglat

library(adehabitatHR)


spec_hull_first <- mcp(total_big_first_sp[,1], percent=95)
spec_hull_first_area <- as.data.frame(spec_hull_first[])
plot(spec_hull_first)

#second
total_big_second <- total_big_second %>% 
  dplyr::select(scientific_name, decdeg_beglon, decdeg_beglat) %>% 
  rename(ID=scientific_name)


#check if any specs have less than 5 relocations using dplyr
total_big_second <- subset(total_big_second, ID %in% names(which(table(ID) >= 5)))
total_big_second$ID <- factor(total_big_second$ID)

#make a spatial object
total_big_second_sp <- total_big_second %>% drop_na()
coordinates(total_big_second_sp) <- ~ decdeg_beglon + decdeg_beglat

library(adehabitatHR)


spec_hull_second <- mcp(total_big_second_sp[,1], percent=95)
spec_hull_second_area <- as.data.frame(spec_hull_second[])
plot(spec_hull_first)
plot(spec_hull_second)

write.csv(spec_hull_first_area, file="spec_hull_first5yr_area.csv")
write.csv(spec_hull_second_area, file="spec_hull_second5yr_area.csv")

library(rgdal)
#write these out to shapefiles
writeOGR(spec_hull_first, layer= "homerange_1_5yr", driver="ESRI Shapefile", dsn="spechull")
writeOGR(spec_hull_second, layer= "homerange_2_5yr", driver="ESRI Shapefile", dsn="spechull")


```
manipulating what I already did in excel to get the specnames into the format I want 

```{r}
spec_hull_tot <- read.csv("spec_hull_tot_area_2.csv")
spec_hull_first <- read.csv("spec_hull_first_area_2.csv")
spec_hull_second <- read.csv("spec_hull_second_area_2.csv")
```


##abundance 
Lets try and get out abunance for each species in the two time periods, that way we can compare those to things like BT and salinity importance vs substrate importance. Might get at who is more vulnerable to climate change 

```{r}
#first
total <- read.csv("total.csv")
xdata <- read.csv("xdata.csv")
ydata <- read.csv("ydata.csv")
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
total_data <- cbind(ycommon,xdata)

total <- subset(total, est_year < 2000)
ydata <- total[,2:508]
ydata[is.na(ydata)] <- 0
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y


newdat <- as.data.frame(colSums(ycommon))
newdat$total <- colSums(newdat)
newdat$relAb <- (newdat$'colSums(ycommon)')/newdat$total
newdat$names <- colnames(ycommon)
newdat_first <- newdat

#second
total <- read.csv("total.csv")
xdata <- read.csv("xdata.csv")
ydata <- read.csv("ydata.csv")
total <- subset(total, est_year > 1999)
ydata <- total[,2:508]
ydata[is.na(ydata)] <- 0
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y

newdat <- as.data.frame(colSums(ycommon))
newdat$total <- colSums(newdat)
newdat$relAb <- (newdat$'colSums(ycommon)')/newdat$total
newdat$names <- colnames(ycommon)
newdat_second <- newdat

#total
ydata <- read.csv("ydata.csv")
total <- read.csv("total.csv")
xdata <- read.csv("xdata.csv")
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
total_data <- cbind(ycommon,xdata)
newdat <- as.data.frame(colSums(ycommon))
newdat$total <- colSums(newdat)
newdat$relAb <- (newdat$'colSums(ycommon)')/newdat$total
newdat$names <- colnames(ycommon)
newdat_total <- newdat


write.csv(newdat_first, file= "abd_1_v2.csv")
write.csv(newdat_second, file= "abd_2_v2.csv")
write.csv(newdat_total, file= "abd_total_v2.csv")

abd_first <- newdat_first
colnames(abd_first) <- c("abd", "total_catch_abd", "relAb", "names")
abd_second <- newdat_second
colnames(abd_second) <- c("abd", "total_catch_abd", "relAb", "names")
abd_total <- newdat_total
colnames(abd_total) <- c("abd", "total_catch_abd", "relAb", "names")
```

#Combining all the data
Okay now lets combine all of the information together based on species names
we have the betas for each species for each time period, distance measures for each time period lets add them all into one big dataset

```{r}
#cluster data 
cluster1 <- as.data.frame(cluster1)
cluster1$names <- rownames(cluster1)

cluster2 <- as.data.frame(cluster2)
cluster2$names <- rownames(cluster2)
```

```{r}
#need to go in and get all of the data I want and rename columns so its easier
colnames(spec_hull_first) <- c("X", "id", "convex_hull_first")
colnames(spec_hull_second) <- c("X", "id", "convex_hull_second")
colnames(spec_hull_tot) <- c("X", "id", "convex_hull_tot")
colnames(dist_total) <- c("names", "dist_shifted", "names_2", "x", "y", "names_3", "x_1", "y_1")
colnames(abd_first) <- c("abd_1", "total_catch_abd_1","relAb_1","names" )
colnames(abd_second) <- c("abd_2", "total_catch_abd_2","relAb_2","names" )
colnames(abd_total) <- c("abd_tot", "total_catch_abd_tot","relAb_tot","names" )


cred_1_sig_comb <- left_join(cred_1_sig, spec_hull_first, by = c("names"="id"))
cred_1_sig_comb <- left_join(cred_1_sig_comb, spec_hull_second, by = c("names"="id"))
cred_1_sig_comb <- left_join(cred_1_sig_comb, spec_hull_tot, by = c("names"="id"))
cred_1_sig_comb <- left_join(cred_1_sig_comb, dist_total, by = "names")
cred_1_sig_comb <- left_join(cred_1_sig_comb, abd_first, by = "names")
cred_1_sig_comb <- left_join(cred_1_sig_comb, abd_second, by = "names")
cred_1_sig_comb <- left_join(cred_1_sig_comb, cluster1, by = "names")

cred_2_sig_comb <- left_join(cred_2_sig, spec_hull_first, by = c("names"="id"))
cred_2_sig_comb <- left_join(cred_2_sig_comb, spec_hull_second, by = c("names"="id"))
cred_2_sig_comb <- left_join(cred_2_sig_comb, spec_hull_tot, by = c("names"="id"))
cred_2_sig_comb <- left_join(cred_2_sig_comb, dist_total, by = "names")
cred_2_sig_comb <- left_join(cred_2_sig_comb, abd_first, by = "names")
cred_2_sig_comb <- left_join(cred_2_sig_comb, abd_second, by = "names")
cred_2_sig_comb <- left_join(cred_2_sig_comb, cluster2, by = "names")


cred_tot_sig_comb <- left_join(cred_tot_sig, spec_hull_first, by = c("names"="id"))
cred_tot_sig_comb <- left_join(cred_tot_sig_comb, spec_hull_second, by = c("names"="id"))
cred_tot_sig_comb <- left_join(cred_tot_sig_comb, spec_hull_tot, by = c("names"="id"))
cred_tot_sig_comb <- left_join(cred_tot_sig_comb, dist_total, by = "names")
cred_tot_sig_comb <- left_join(cred_tot_sig_comb, abd_first, by = "names")
cred_tot_sig_comb <- left_join(cred_tot_sig_comb, abd_second, by = "names")

#adding in some variables for changes between first and second time period 
cred_tot_sig_comb <- cred_tot_sig_comb %>% 
  dplyr:::select(-X.x, -X.y, -y_1, -x_1, -names_2, -names_3, -X)
cred_1_sig_comb <- cred_1_sig_comb %>% 
  dplyr:::select(-X.x, -X.y, -y_1, -x_1, -names_2, -names_3, -X)
cred_2_sig_comb <- cred_2_sig_comb %>% 
  dplyr:::select(-X.x, -X.y, -y_1, -x_1, -names_2, -names_3, -X)

cred_tot_sig_comb$abd_diff <- cred_tot_sig_comb$abd_2 - cred_tot_sig_comb$abd_1
cred_tot_sig_comb$rel_abd_diff <- cred_tot_sig_comb$relAb_2 - cred_tot_sig_comb$relAb_1
cred_tot_sig_comb$convex_diff <- cred_tot_sig_comb$convex_hull_second - cred_tot_sig_comb$convex_hull_first

cred_2_sig_comb$abd_diff <- cred_2_sig_comb$abd_2 - cred_2_sig_comb$abd_1
cred_2_sig_comb$rel_abd_diff <- cred_2_sig_comb$relAb_2 - cred_2_sig_comb$relAb_1
cred_2_sig_comb$convex_diff <- cred_2_sig_comb$convex_hull_second - cred_2_sig_comb$convex_hull_first

cred_1_sig_comb$abd_diff <- cred_1_sig_comb$abd_2 - cred_1_sig_comb$abd_1
cred_1_sig_comb$rel_abd_diff <- cred_1_sig_comb$relAb_2 - cred_1_sig_comb$relAb_1
cred_1_sig_comb$convex_diff <- cred_1_sig_comb$convex_hull_second - cred_1_sig_comb$convex_hull_first


#creating a big file for change 
change_tot <- full_join(cred_1_sig_comb, cred_2_sig_comb, by="names")


#save these files 
write.csv(cred_tot_sig_comb, file= "cred_tot.csv")
write.csv(cred_1_sig_comb, file= "cred_1.csv")
write.csv(cred_2_sig_comb, file= "cred_2.csv")

```


#variable importance (beta strength) vs shifting mean centroids
I want to compare the strength of the betas to how far the species shifted to get at if sticky fish shift less 

This should be really easy to do now that I have manipulated the data above 

```{r}  
cred_tot_sig_comb <- cred_tot_sig_comb %>%  
  filter(!names %in% c("Anchoa.mitchilli..bay.anchovy.", "Anchoa.hepsetus..striped.anchovy."))

#this makes one data frame with just the substrate variables combined 
cred_tot_sub1 <- cred_tot_sig_comb %>% 
  dplyr:::select(names, `SEDTYPESilt/Mud`, dist_shifted, convex_diff, rel_abd_diff, abd_diff)
cred_tot_sub1$sub <- cred_tot_sub1$`SEDTYPESilt/Mud`

cred_tot_sub12 <- cred_tot_sig_comb %>% 
  dplyr:::select(names, SEDTYPESand, dist_shifted, convex_diff, rel_abd_diff, abd_diff)
cred_tot_sub12$sub <- cred_tot_sub12$SEDTYPESand
cred_tot_sub12$names <- paste(cred_tot_sub12$names, "2", sep="")


cred_sub <- smartbind(cred_tot_sub1, cred_tot_sub12)

ggplot(cred_sub, aes(x=dist_shifted, y=abs(sub))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)
summary(glm(dist_shifted ~ abs(sub), data=cred_sub))

ggplot(cred_sub, aes(x=convex_diff, y=abs(sub))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_sub, aes(x=rel_abd_diff, y=abs(sub))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_sub, aes(x=abd_diff, y=abs(sub))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)


##distance shifted 
ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=abs(AMOunsmyear))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=abs(avgdepth))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=abs(botsalin))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=abs(bottemp))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=abs(gebcoSD2))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=abs(NAOyear))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=abs(SD3x3shortbt))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=abs(SD3x3shortsal))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=abs(SD3x3shortsst))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=abs(SEDTYPESand))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=abs(`SEDTYPESilt/Mud`))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

##convex hull subtraction 
ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=abs(AMOunsmyear))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=abs(avgdepth))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=abs(botsalin))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=abs(bottemp))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=abs(gebcoSD2))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=abs(NAOyear))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=abs(SD3x3shortbt))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=abs(SD3x3shortsal))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=abs(SD3x3shortsst))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=abs(SEDTYPESand))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=abs(`SEDTYPESilt/Mud`))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)



##relative abundance diff 
ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=abs(AMOunsmyear))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=abs(avgdepth))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=abs(botsalin))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=abs(bottemp))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=abs(gebcoSD2))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=abs(NAOyear))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=abs(SD3x3shortbt))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=abs(SD3x3shortsal))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=abs(SD3x3shortsst))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=abs(SEDTYPESand))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=abs(`SEDTYPESilt/Mud`))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

##abd diff
ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=abs(AMOunsmyear))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=abs(avgdepth))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=abs(botsalin))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=abs(bottemp))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=abs(gebcoSD2))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=abs(NAOyear))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=abs(SD3x3shortbt))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=abs(SD3x3shortsal))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=abs(SD3x3shortsst))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=abs(SEDTYPESand))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=abs(`SEDTYPESilt/Mud`))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)


```

non absolute value 
```{r}  
cred_tot_sig_comb <- cred_tot_sig_comb %>%  
  filter(!names %in% c("Anchoa.mitchilli..bay.anchovy.", "Anchoa.hepsetus..striped.anchovy."))


##distance shifted 
ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=AMOunsmyear)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=avgdepth)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=botsalin)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=bottemp)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=gebcoSD2)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=NAOyear)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=SD3x3shortbt)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=SD3x3shortsal)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=SD3x3shortsst)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=SEDTYPESand)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=dist_shifted, y=`SEDTYPESilt/Mud`)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

##convex hull subtraction 
ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=AMOunsmyear)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=avgdepth)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=botsalin)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=bottemp)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=gebcoSD2)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=NAOyear)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=SD3x3shortbt)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=SD3x3shortsal)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=SD3x3shortsst)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=SEDTYPESand)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=convex_diff, y=`SEDTYPESilt/Mud`)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)



##relative abundance diff 
ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=AMOunsmyear)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=avgdepth)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=botsalin)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=bottemp)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=gebcoSD2)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=NAOyear)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=SD3x3shortbt)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=SD3x3shortsal)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=SD3x3shortsst)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=SEDTYPESand)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=rel_abd_diff, y=`SEDTYPESilt/Mud`)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

##abd diff
ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=AMOunsmyear)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=avgdepth)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=botsalin)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=bottemp)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=gebcoSD2)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=NAOyear)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=SD3x3shortbt)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=SD3x3shortsal)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=SD3x3shortsst)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) #this is a good result!!

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=SEDTYPESand)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_tot_sig_comb, aes(x=abd_diff, y=`SEDTYPESilt/Mud`)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)


```


Old 
```{r sig substrate}
sig_1_substrate <- cred_1_sig %>% 
  filter(!is.na(siltmud)| !is.na(sand)) 

sig_2_substrate <- cred_2_sig %>% 
  filter(!is.na(siltmud)| !is.na(sand)) 

#now go and manipulate in excel 
write.csv(sig_1_substrate, file = "sig_1_substrate_2.csv")
write.csv(sig_2_substrate, file = "sig_2_substrate_2.csv")

sig_tot_substrate <- cred_tot_sig %>% 
  filter(!is.na(siltmud)| !is.na(sand)) 


#now go and manipulate in excel to add the geo distance column in (add column of just names (copy paste text to columns text to columns separate at _, then find replace ._ with ) and . with (  Then vlookup all of the names and add the distance column))
write.csv(sig_tot_substrate, file = "sig_tot_substrate_2.csv")
```


```{r sig bt salinity}
sig_1_env <- cred_1_sig %>% 
  filter(!is.na(temp)| !is.na(sal)) 

sig_2_env <- cred_2_sig %>% 
  filter(!is.na(temp)| !is.na(sal)) 

#now go and manipulate in excel 
write.csv(sig_1_env, file = "sig_1_env__2.csv")
write.csv(sig_2_env, file = "sig_2_env_2.csv")

sig_tot_env <- cred_tot_sig %>% 
  filter(!is.na(temp)| !is.na(sal)) 


#now go and manipulate in excel to add the geo distance column in (add column of just names (copy paste text to columns text to columns separate at _, then find replace ._ with ) and . with (  Then vlookup all of the names and add the distance column))
write.csv(sig_tot_env, file = "sig_tot_env_2.csv")
```

```{r sig depth, substrate}
sig_1_depth_substrate <- cred_1_sig %>% 
  filter(!is.na(siltmud)| !is.na(sand) | !is.na(depth)) 

sig_2_depth_substrate <- cred_2_sig %>% 
  filter(!is.na(siltmud)| !is.na(sand)| !is.na(depth))

#now go and manipulate in excel 
write.csv(sig_1_depth_substrate, file = "sig_1_depth_substrate_2.csv")
write.csv(sig_2_depth_substrate, file = "sig_2_depth_substrate_2.csv")

sig_tot_depth_substrate <- cred_tot_sig %>% 
  filter(!is.na(siltmud)| !is.na(sand)| !is.na(depth))


#now go and manipulate in excel to add the geo distance column in (add column of just names (copy paste text to columns text to columns separate at _, then find replace ._ with ) and . with (  Then vlookup all of the names and add the distance column))
write.csv(sig_tot_depth_substrate, file = "sig_tot_depth_substrate_2.csv")
```

```{r sig climate}
sig_1_climate <- cred_1_sig %>% 
  filter(!is.na(NAO)| !is.na(AMO)) 

sig_2_climate <- cred_2_sig %>% 
  filter(!is.na(NAO)| !is.na(AMO))

#now go and manipulate in excel 
write.csv(sig_1_climate, file = "sig_1_climate.csv")
write.csv(sig_2_climate, file = "sig_2_climate.csv")

sig_tot_climate <- cred_tot_sig %>% 
  filter(!is.na(NAO)| !is.na(AMO))
         

#now go and manipulate in excel to add the geo distance column in (add column of just names (copy paste text to columns text to columns separate at _, then find replace ._ with ) and . with (  Then vlookup all of the names and add the distance column))
write.csv(sig_tot_climate, file = "sig_tot_climate.csv")
```


```{r glms}
##substrate
sig_1_sub_geo <- read.csv("sig_1_substrate_geo.csv")
sig_2_sub_geo <- read.csv("sig_2_substrate_geo.csv")

#first
plot((sig_1_sub_geo$dist_geo.1), log(sig_1_sub_geo$Estimate.1))
abline(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$dist_geo.1)))
summary(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$dist_geo.1)))

plot((sig_1_sub_geo$convex_hull), log(sig_1_sub_geo$Estimate.1))
abline(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$convex_hull)))
summary(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$convex_hull)))

plot((sig_1_sub_geo$convex_hull_subtraction), log(sig_1_sub_geo$Estimate.1))
abline(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$convex_hull_subtraction)))
summary(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$convex_hull_subtraction)))


plot((sig_1_sub_geo$abd), log(sig_1_sub_geo$Estimate.1))
abline(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$abd)))
summary(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$abd)))

plot((sig_1_sub_geo$rel_ab), log(sig_1_sub_geo$Estimate.1))
abline(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$rel_ab)))
summary(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$rel_ab)))

plot((sig_1_sub_geo$abd_subtract), log(sig_1_sub_geo$Estimate.1))
abline(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$abd_subtract)))
summary(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$abd_subtract)))

plot((sig_1_sub_geo$rel_ab_subtract), log(sig_1_sub_geo$Estimate.1))
abline(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$rel_ab_subtract)))
summary(glm(log(sig_1_sub_geo$Estimate.1) ~ (sig_1_sub_geo$rel_ab_subtract)))


#second
plot((sig_2_sub_geo$dist_geo.1), log(sig_2_sub_geo$Estimate))
abline(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$dist_geo.1)))
summary(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$dist_geo.1)))

plot((sig_2_sub_geo$convex_hull), log(sig_2_sub_geo$Estimate))
abline(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$convex_hull)))
summary(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$convex_hull)))

plot((sig_2_sub_geo$convex_hull_subtraction), log(sig_2_sub_geo$Estimate))
abline(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$convex_hull_subtraction)))
summary(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$convex_hull_subtraction)))

plot((sig_2_sub_geo$abd), log(sig_2_sub_geo$Estimate))
abline(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$abd)))
summary(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$abd)))

plot((sig_2_sub_geo$rel_ab), log(sig_2_sub_geo$Estimate))
abline(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$rel_ab)))
summary(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$rel_ab)))

plot((sig_2_sub_geo$abd_subtract), log(sig_2_sub_geo$Estimate))
abline(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$abd_subtract)))
summary(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$abd_subtract)))

plot((sig_2_sub_geo$rel_ab_subtract), log(sig_2_sub_geo$Estimate))
abline(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$rel_ab_subtract)))
summary(glm(log(sig_2_sub_geo$Estimate) ~ (sig_2_sub_geo$rel_ab_subtract)))





#total data
sig_tot_sub_geo <- read.csv("sig_tot_substrate_geo_2.csv")


plot((sig_tot_sub_geo$dist_geo_1), abs(sig_tot_sub_geo$Estimate))
abline(glm(abs(sig_tot_sub_geo$Estimate) ~ (sig_tot_sub_geo$dist_geo_1)))
summary(glm(abs(sig_tot_sub_geo$Estimate) ~ (sig_tot_sub_geo$dist_geo_1)))



plot((sig_tot_sub_geo$convex_hull), sig_tot_sub_geo$Estimate)
abline(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$convex_hull))
summary(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$convex_hull))

plot((sig_tot_sub_geo$convex_hull_subtraction), sig_tot_sub_geo$Estimate)
abline(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$convex_hull_subtraction))
summary(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$convex_hull_subtraction))

plot(sig_tot_sub_geo$abd_subtract, sig_tot_sub_geo$Estimate)
abline(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$abd_subtract))
summary(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$abd_subtract))

plot((sig_tot_sub_geo$rel_ab_subtract), log(sig_tot_sub_geo$Estimate))
abline(glm(log(sig_tot_sub_geo$Estimate) ~ (sig_tot_sub_geo$rel_ab_subtract)))
summary(glm(log(sig_tot_sub_geo$Estimate) ~ (sig_tot_sub_geo$rel_ab_subtract)))


#total data depth
sig_tot_sub_geo <- read.csv("sig_tot_depth_substrate_2.csv")

#note i removed bay anchovy and striped anchovy because they were such an extreme outlier 
plot((sig_tot_sub_geo$dist_geo), sig_tot_sub_geo$Estimate)
abline(glm(sig_tot_sub_geo$Estimate ~ (sig_tot_sub_geo$dist_geo)))
summary(glm(sig_tot_sub_geo$Estimate ~ (sig_tot_sub_geo$dist_geo)))

plot((sig_tot_sub_geo$dist_geo), abs(sig_tot_sub_geo$Estimate))
abline(glm(abs(sig_tot_sub_geo$Estimate) ~ (sig_tot_sub_geo$dist_geo)))
summary(glm(abs(sig_tot_sub_geo$Estimate) ~ (sig_tot_sub_geo$dist_geo)))



plot((sig_tot_sub_geo$convex_hull), sig_tot_sub_geo$Estimate)
abline(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$convex_hull))
summary(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$convex_hull))

plot((sig_tot_sub_geo$convex_hull_subtraction), sig_tot_sub_geo$Estimate)
abline(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$convex_hull_subtraction))
summary(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$convex_hull_subtraction))

plot((sig_tot_sub_geo$abd), sig_tot_sub_geo$Estimate)
abline(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$abd))
summary(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$abd))

plot((sig_tot_sub_geo$rel_ab), log(sig_tot_sub_geo$Estimate))
abline(glm(log(sig_tot_sub_geo$Estimate) ~ (sig_tot_sub_geo$rel_ab)))
summary(glm(log(sig_tot_sub_geo$Estimate) ~ (sig_tot_sub_geo$rel_ab)))

plot(sig_tot_sub_geo$abd_subtract, sig_tot_sub_geo$Estimate)
abline(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$abd_subtract))
summary(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$abd_subtract))

plot(sig_tot_sub_geo$rel_ab_subtract, sig_tot_sub_geo$Estimate)
abline(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$rel_ab_subtract))
summary(glm(sig_tot_sub_geo$Estimate ~ sig_tot_sub_geo$rel_ab_subtract))



#salinity and bt 
sig_tot_env_geo <- read.csv("sig_tot_env_geo_2.csv")
sig_1_env_geo <- read.csv("sig_1_env_geo.csv")
sig_2_env_geo <- read.csv("sig_2_env_geo.csv")

#tot 
plot((sig_tot_env_geo$dist_5yr), sig_tot_env_geo$Estimate)
abline(glm(sig_tot_env_geo$Estimate ~ (sig_tot_env_geo$dist_5yr)))
summary(glm(sig_tot_env_geo$Estimate ~ (sig_tot_env_geo$dist_5yr)))


#first
plot((sig_1_env_geo$dist_geo), log(sig_1_env_geo$Estimate))
abline(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$dist_geo)))
summary(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$dist_geo)))

plot((sig_1_env_geo$convex_hull), log(sig_1_env_geo$Estimate))
abline(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$convex_hull)))
summary(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$convex_hull)))

plot((sig_1_env_geo$convex_hull_subtraction), log(sig_1_env_geo$Estimate))
abline(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$convex_hull_subtraction)))
summary(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$convex_hull_subtraction)))

plot((sig_1_env_geo$abd), log(sig_1_env_geo$Estimate))
abline(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$abd)))
summary(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$abd)))

plot((sig_1_env_geo$rel_ab), log(sig_1_env_geo$Estimate))
abline(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$rel_ab)))
summary(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$rel_ab)))

plot((sig_1_env_geo$abd_subtract), log(sig_1_env_geo$Estimate))
abline(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$abd_subtract)))
summary(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$abd_subtract)))

plot((sig_1_env_geo$rel_ab_subtract), log(sig_1_env_geo$Estimate))
abline(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$rel_ab_subtract)))
summary(glm(log(sig_1_env_geo$Estimate) ~ (sig_1_env_geo$rel_ab_subtract)))



#second
plot((sig_2_env_geo$dist_geo), log(sig_2_env_geo$Estimate))
abline(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$dist_geo)))
summary(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$dist_geo)))

plot((sig_2_env_geo$convex_hull), log(sig_2_env_geo$Estimate))
abline(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$convex_hull)))
summary(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$convex_hull)))

plot((sig_2_env_geo$convex_hull_subtraction), log(sig_2_env_geo$Estimate))
abline(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$convex_hull_subtraction)))
summary(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$convex_hull_subtraction)))

plot((sig_2_env_geo$abd), log(sig_2_env_geo$Estimate))
abline(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$abd)))
summary(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$abd)))

plot((sig_2_env_geo$rel_ab), log(sig_2_env_geo$Estimate))
abline(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$rel_ab)))
summary(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$rel_ab)))

plot((sig_2_env_geo$abd_subtract), log(sig_2_env_geo$Estimate))
abline(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$abd_subtract)))
summary(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$abd_subtract)))

plot((sig_2_env_geo$rel_ab_subtract), log(sig_2_env_geo$Estimate))
abline(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$rel_ab_subtract)))
summary(glm(log(sig_2_env_geo$Estimate) ~ (sig_2_env_geo$rel_ab_subtract)))



#total
plot((sig_tot_env_geo$dist_geo), log(sig_tot_env_geo$Estimate))
abline(glm(log(sig_tot_env_geo$Estimate) ~ (sig_tot_env_geo$dist_geo)))
summary(glm(log(sig_tot_env_geo$Estimate) ~ (sig_tot_env_geo$dist_geo)))

plot(sig_tot_env_geo$convex_hull_subtraction, sig_tot_env_geo$Estimate)
abline(glm(sig_tot_env_geo$Estimate ~ sig_tot_env_geo$convex_hull_subtraction))
summary(glm(sig_tot_env_geo$Estimate ~ sig_tot_env_geo$convex_hull_subtraction))

plot(sig_tot_env_geo$convex_hull, sig_tot_env_geo$Estimate)
abline(glm(sig_tot_env_geo$Estimate ~ sig_tot_env_geo$convex_hull))
summary(glm(sig_tot_env_geo$Estimate ~ sig_tot_env_geo$convex_hull))


plot(log(sig_tot_env_geo$abd), log(sig_tot_env_geo$Estimate))
abline(glm(log(sig_tot_env_geo$Estimate) ~ log(sig_tot_env_geo$abd)))
summary(glm(log(sig_tot_env_geo$Estimate) ~ log(sig_tot_env_geo$abd)))

plot((sig_tot_env_geo$rel_ab), log(sig_tot_env_geo$Estimate))
abline(glm(log(sig_tot_env_geo$Estimate) ~ (sig_tot_env_geo$rel_ab)))
summary(glm(log(sig_tot_env_geo$Estimate) ~ (sig_tot_env_geo$rel_ab)))

plot(sig_tot_env_geo$abd_subtract, sig_tot_env_geo$Estimate)
abline(glm(sig_tot_env_geo$Estimate ~ sig_tot_env_geo$abd_subtract))
summary(glm(log(sig_tot_env_geo$Estimate) ~ (sig_tot_env_geo$abd_subtract)))

plot(sig_tot_env_geo$rel_ab_subtract, sig_tot_env_geo$Estimate)
abline(glm(sig_tot_env_geo$Estimate ~ sig_tot_env_geo$rel_ab_subtract))
summary(glm(sig_tot_env_geo$Estimate ~ sig_tot_env_geo$rel_ab_subtract))



```


```{running with SD data}
sig_1_SD <- cred_1_sig %>% 
  filter(!is.na(SD_sal)| !is.na(SD_bt)| !is.na(SD_sst)) 

sig_2_SD <- cred_2_sig %>% 
  filter(!is.na(SD_sal)| !is.na(SD_bt)| !is.na(SD_sst)) 

#now go and manipulate in excel 
write.csv(sig_1_SD, file = "sig_1_SD.csv")
write.csv(sig_2_SD, file = "sig_2_SD.csv")

#sig_tot_env <- cred_tot_sig %>% 
  #filter(!is.na(temp)| !is.na(sal)) 


#now go and manipulate in excel to add the geo distance column in (add column of just names (copy paste text to columns text to columns separate at _, then find replace ._ with ) and . with (  Then vlookup all of the names and add the distance column))
#write.csv(sig_tot_env, file = "sig_tot_env.csv")
```
```{r}
sig_1_SD_geo <- read.csv("sig_1_SD_geo.csv")
sig_2_SD_geo <- read.csv("sig_2_SD_geo.csv")


plot(sig_1_SD_geo$distGeo, sig_1_SD_geo$Estimate)
abline(glm(sig_1_SD_geo$Estimate ~ sig_1_SD_geo$distGeo))
summary(glm(sig_1_SD_geo$Estimate ~ sig_1_SD_geo$distGeo))

plot(sig_2_SD_geo$distGeo, sig_2_SD_geo$Estimate)
abline(glm(sig_2_SD_geo$Estimate ~ sig_2_SD_geo$distGeo))
summary(glm(sig_2_SD_geo$Estimate ~ sig_2_SD_geo$distGeo))

```
##absolute variable importance
okay so above I looked at just the significant relationships, but the problem is if a significant relationship is negative it is still strongly related. Maybe I should compare the significant with the non-significant on one graph to see whats going on there. 

lets first try testing this with linear models with all of the sig and non-sig 
this actually just turned out to be more of the above but with an easier way of splitting out data and plotting with ggplot. 

Okay so the findings are okay 
the stronger the association withs substrate (absolute), the less shifted, but no good p-value there. The stronger the association with bt and salinity (absolute), the more likely a species is to shift abundances but that p-value is shit also. 

```{r get data and specnames}
total <- read.csv("total.csv")
#for the second iteration of running the model 
specnames_1<-c("Alosa_aestivalis_.blueback_herring.", "Alosa_pseudoharengus_.alewife.", "Alosa_sapidissima_.American_shad.", "Amblyraja_radiata_.thorny_skate.", "Ammodytes_dubius_.northern_sand_lance.", "Anchoa_hepsetus_.striped_anchovy.", "Anchoa_mitchilli_.bay_anchovy.", "Atlantopandalus_propinqvus_..", "Brevoortia_tyrannus_.Atlantic_menhaden.", "Callinectes_sapidus_.blue_crab.", "Cancer_irroratus_.Atlantic_rock_crab.", "Caridea", "Centropristis_striata_.black_sea_bass.", "Chlorophthalmus_agassizi_.shortnose_greeneye.", "Citharichthys_arctifrons_.Gulf_stream_flounder.", "Clupea_harengus_.Atlantic_herring.", "Crangon_septemspinosa_.sevenspine_bay_shrimp.", "Cynoscion_regalis_.weakfish.", "Dasyatis_say_.bluntnose_stingray.", "Decapterus_punctatus_.round_scad.", "Dichelopandalus_leptocerus_.bristled_longbeak.", "Etropus_microstomus_.smallmouth_flounder.", "Etrumeus_teres_.round_herring.", "Gadus_morhua_.Atlantic_cod.", "Glyptocephalus_cynoglossus_.witch_flounder.", "Helicolenus_dactylopterus_.blackbelly_rosefish.", "Hemitripterus_americanus_.sea_raven.", "Hippoglossina_oblonga_.fourspot_flounder.", "Hippoglossoides_platessoides_.American_plaice.", "Homarus_americanus_.American_lobster.", "Illex_illecebrosus_.northern_shortfin_squid.", "Leiostomus_xanthurus_.spot.", "Lepophidium_profundorum_.fawn_cusk.eel.", "Leptoclinus_maculatus_.daubed_shanny.", "Leucoraja_erinacea_.little_skate.", "Leucoraja_ocellata_.winter_skate.", "Limanda_ferruginea_.yellowtail_flounder.", "Loligo_pealeii_.longfin_squid.", "Lophius_americanus_.goosefish.", "Malacoraja_senta_.smooth_skate.", "Maurolicus_weitzmani_.Weitzmans_pearlsides.", "Melanogrammus_aeglefinus_.haddock.", "Melanostigma_atlanticum_.Atlantic_soft_pout.", "Menidia_menidia_.Atlantic_silverside.", "Menticirrhus_americanus_.southern_kingfish.")


specnames_2 <- c("Menticirrhus_saxatilis_.northern_kingfish.", "Merluccius_bilinearis_.silver_hake.", "Micropogonias_undulatus_.Atlantic_croaker.", "Morone_saxatilis_.striped_bass.", "Mustelus_canis_.smooth_dogfish.", "Myctophidae", "Myliobatis_freminvillii_.bullnose_ray.", "Myoxocephalus_octodecemspinosus_.longhorn_sculpin.", "Opisthonema_oglinum_.Atlantic_thread_herring.", "Orthopristis_chrysoptera_.pigfish.", "Ovalipes_ocellatus_.lady_crab.", "Ovalipes_stephensoni_.coarsehand_lady_crab.", "Pandalus_borealis_.northern_shrimp.", "Pandalus_montagui_.Aesop_shrimp.", "Paralichthys_dentatus_.summer_flounder.", "Pasiphaea_multidentata_.pink_glass_shrimp.", "Penaeus", "Peprilus_triacanthus_.butterfish.", "Phycis_chesteri_.longfin_hake.", "Placopecten_magellanicus_.sea_scallop.", "Pollachius_virens_.pollock.", "Pomatomus_saltatrix_.bluefish.", "Prionotus_carolinus_.northern_searobin.", "Prionotus_evolans_.striped_searobin.", "Pseudopleuronectes_americanus_.winter_flounder.", "Raja_eglanteria_.clearnose_skate.", "Sardinella_aurita_.Spanish_sardine.", "Scomber_scombrus_.Atlantic_mackerel.", "Scophthalmus_aquosus_.windowpane.", "Sebastes_fasciatus_.Acadian_redfish.", "Selene_setapinnis_.Atlantic_moonfish.", "Sphoeroides_maculatus_.northern_puffer.", "Squalus_acanthias_.spiny_dogfish.", "Stenotomus_chrysops_.scup.", "Stephanolepis_hispida_.planehead_filefish.", "Synodus_foetens_.inshore_lizardfish.", "Trachurus_lathami_.rough_scad.", "Triglops_murrayi_.moustache_sculpin.", "Urophycis_chuss_.red_hake.", "Urophycis_regia_.spotted_hake.", "Urophycis_tenuis_.white_hake.", "Zoarces_americanus_.ocean_pout.")
specnames <- c(specnames_1, specnames_2)

```

##full model 
```{r variable importance vs }
cred_1_tot<- cred_1 %>% 
  filter(!grepl('intercept', names))  #remove anything that says intercept in there 

cred_2_tot<- cred_2 %>% 
  filter(!grepl('intercept', names))  #remove anything that says intercept in there 

cred_tot_tot<- cred_tot %>% 
  filter(!grepl('intercept', names))  #remove anything that says intercept in there 

write.csv(cred_tot_tot, file="cred_tot_tot.csv")
cred_all <- read.csv("cred_tot_tot_2.csv")

#substrate and depth 
cred_sub_depth <- cred_all %>% filter(var=="avgdepth"| var=="SEDTYPESand"| var=="SEDTYPESilt/Mud")

  cred_sub_depth <- cred_sub_depth %>%  
  filter(!names %in% c("Anchoamitchilli.bayanchovy.", "Anchoahepsetus.stripedanchovy."))

ggplot(cred_sub_depth, aes(x=dist_geo, y=abs(Estimate))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_sub_depth, aes(x=convex_hull_subtraction, y=abs(Estimate))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_sub_depth, aes(x=rel_ab_subtract, y=abs(Estimate))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

#just substrate 

cred_sub <- cred_all %>% filter(var=="SEDTYPESand"| var=="SEDTYPESilt/Mud")

  cred_sub <- cred_sub %>%  
  filter(!names %in% c("Anchoamitchilli.bayanchovy.", "Anchoahepsetus.stripedanchovy."))
  
  ggplot(cred_sub, aes(x=dist_geo, y=abs(Estimate))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)
  #okay so  here the stronger the association with substrate the less likely they will shift! 
  
ggplot(cred_sub, aes(x=convex_hull_subtraction, y=abs(Estimate))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(cred_sub, aes(x=rel_ab_subtract, y=abs(Estimate))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)
  
#salinity and bt 
  
cred_env <- cred_all %>% filter(var=="bottemp"| var=="botsalin")

  cred_env <- cred_env %>%  
  filter(!names %in% c("Anchoamitchilli.bayanchovy.", "Anchoahepsetus.stripedanchovy."))
  
  ggplot(cred_env, aes(x=dist_geo, y=abs(Estimate))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)
  
# are species that are associated with cooler or warmer water shifting more? 
  cred_bt <- cred_all %>% filter(var=="bottemp")

  cred_bt <- cred_bt %>%  
  filter(!names %in% c("Anchoamitchilli.bayanchovy.", "Anchoahepsetus.stripedanchovy."))
  
  ggplot(cred_bt, aes(x=dist_geo, y=Estimate)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)
  #answer, warmer bottom temps mean shift more. 
  
#are species that are associated with deeper or shallower water shifting more? 
cred_depth <- cred_all %>% filter(var=="avgdepth")

  cred_depth <- cred_bt %>%  
  filter(!names %in% c("Anchoamitchilli.bayanchovy.", "Anchoahepsetus.stripedanchovy."))
  
  ggplot(cred_depth, aes(x=dist_geo, y=abs(Estimate))) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)
  #answer, deeper mean shift more. 
  #answer, the stronger association with depth the less you shift. 

  #are species that are associated positively associated with a certain substrate shifting less? 
cred_sub <- cred_all %>% filter(var=="SEDTYPESand"| var=="SEDTYPESilt/Mud")

  cred_sub <- cred_sub %>%  
  filter(!names %in% c("Anchoamitchilli.bayanchovy.", "Anchoahepsetus.stripedanchovy."))
  
  
  ggplot(cred_sub, aes(x=dist_geo, y=Estimate, color=sig95)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)
  #answer, positive association with substrate mean shift less! 
  
  #okay so a story now could be that species with a strong positive association with substrate are shifting less than species with a strong association with bt.  
  
#climate doesnt really show anything 
  cred_clim <- cred_all %>% filter(var=="AMOunsmyea"| var=="NAOyear")

  cred_clim <- cred_sub %>%  
  filter(!names %in% c("Anchoamitchilli.bayanchovy.", "Anchoahepsetus.stripedanchovy."))
  
  
  ggplot(cred_clim, aes(x=dist_geo, y=abs(Estimate), color=sig95)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)
```

uggggggg okay this isnt really showing anything 

#sankey 
Okay so I have messed with the excel file change_total a bit to pull out the significant variables and group the species based on their sig relationship with the env. that is all in the change_total csv and tab in the bigger excel document 

```{r}
#getting cluster info 
change_tot$egroups_1 <- ifelse(change_tot$E.x ==1, "cool, nonsaline, shallow, nosilt/mud, not_variable_sst, rugged", 
                               ifelse(change_tot$E.x ==2, "cool, nonsaline, AMO+, NAO+, not_variable_bt, not_variable_sal, variable_sst", 
                                      ifelse(change_tot$E.x==3, "saline, deep, AMO+, NAO+, not_variable_sal, variable_sst", 
                                             ifelse(change_tot$E.x==4, "warm, nonsaline, shallow, nosilt/mud, nosand, variable_sst, rugged", NA))))

change_tot$egroups_2 <- ifelse(change_tot$E.y ==1, "warm, saline, deep, no silt/mud, AMO_, variable_bt, variable_sal, rugged", 
                               ifelse(change_tot$E.y ==2, "cool, nonsaline, deep, AMO+, NAO-, not_variable_bt, not_variable_sal", 
                                      ifelse(change_tot$E.y==3, "cool, nonsaline, shallow, nosilt/mud, not_variable_sal, not_variable_sst, rugged", 
                                             ifelse(change_tot$E.y==4, "warm, nonsaline, shallow, nosilt/mud, nosand, NAO-, variable_sal, rugged", NA))))

change_tot$egroups_1 <- replace_na(change_tot$egroups_1, "not_caught")
change_tot$egroups_2 <- replace_na(change_tot$egroups_2, "not_caught2")
```

```{r sankey egroups}
dataSk <- data.frame(from = change_tot$egroups_1, to = change_tot$egroups_2 , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "1000",
                                 height = "500",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))
plot(sankey)
```

```{r sankey salinity}
dataSk <- data.frame(from = paste(change_tot$sal_1.x, "1"), to=paste(change_tot$sal_1.y, "2") , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "1000",
                                 height = "500",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))
plot(sankey)
```

```{r sankey temp}
dataSk <- data.frame(from = paste(change_tot$temp_1.x, "1"), to=paste(change_tot$temp_1.y, "2") , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "500",
                                 height = "500",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))
plot(sankey)
```

```{r sankey depth}
dataSk <- data.frame(from = paste(change_tot$depth_1.x, "1"), to=paste(change_tot$depth_1.y, "2") , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "500",
                                 height = "500",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))
plot(sankey)
```

```{r sankey substrate}
dataSk <- data.frame(from = paste(change_tot$siltmud_1.x, change_tot$sand_1.x, "1"), to=paste(change_tot$siltmud_1.y, change_tot$sand_1.y, "2") , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "1000",
                                 height = "500",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))
plot(sankey)
```

```{r sankey AMO}
dataSk <- data.frame(from = paste(change_tot$AMO_1.x, "1"), to=paste(change_tot$AMO_1.y, "2") , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "500",
                                 height = "500",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))
plot(sankey)
```

```{r sankey NAO}
dataSk <- data.frame(from = paste(change_tot$NAO_1.x, "1"), to=paste(change_tot$NAO_1.y, "2") , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "500",
                                 height = "500",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))
plot(sankey)
```

```{r sankey SD}
dataSk <- data.frame(from = paste(change_tot$SD_bt_1.x, "1"), to=paste(change_tot$SD_bt_1.y, "2") , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "500",
                                 height = "500",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))
plot(sankey)
```

```{r sankey SD}
dataSk <- data.frame(from = paste(change_tot$SD_sst_1.x, "1"), to=paste(change_tot$SD_sst_1.y, "2") , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "500",
                                 height = "500",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))
plot(sankey)
```

```{r sankey SD}
dataSk <- data.frame(from = paste(change_tot$SD_sal_1.x, "1"), to=paste(change_tot$SD_sal_1.y, "2") , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "500",
                                 height = "500",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))
plot(sankey)
```

```{r sankey SD}
dataSk <- data.frame(from = paste(change_tot$SD_gebco_1.x, "1"), to=paste(change_tot$SD_gebco_1.y, "2") , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "500",
                                 height = "500",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))
plot(sankey)
```

```{r}
Change_total <- read.csv("~/Documents/ClimateOceanPlanning/R/NEFSC_GJAMM_GIT/egroups_2.csv")
library(googleVis)
```

```{r sankey all}
dataSk <- data.frame( from = Change_total$Group_1, to= Change_total$Group_2 , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "3000",
                                 height = "2000",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))

sankeyplot <- plot(sankey) 

plot(sankey)
```

now lets just look at specific variables that change 

```{r sankey bt}
dataSk <- data.frame( from = Change_total$temp, to= Change_total$temp_2 , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "1000",
                                 height = "1000",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))

sankeyplot <- plot(sankey) 

#plot(sankey)
```

```{r sankey salinity}
dataSk <- data.frame( from = Change_total$sal, to= Change_total$sal_2 , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "1000",
                                 height = "1000",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))

sankeyplot <- plot(sankey) 

#plot(sankey)
```

```{r sankey depth}
dataSk <- data.frame( from = Change_total$depth, to= Change_total$depth_2 , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "1000",
                                 height = "1000",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))

sankeyplot <- plot(sankey) 

#plot(sankey)
```

```{r sankey substrate}
dataSk <- data.frame( from = Change_total$substrate, to= Change_total$substrate_2 , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "1000",
                                 height = "1000",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))

sankeyplot <- plot(sankey) 

#plot(sankey)
```

```{r sankey AMO}
dataSk <- data.frame( from = Change_total$AMO, to= Change_total$AMO_2 , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "1000",
                                 height = "1000",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))

sankeyplot <- plot(sankey) 

#plot(sankey)
```

```{r sankey NAO}
dataSk <- data.frame( from = Change_total$NAO, to= Change_total$NAO_2 , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "1000",
                                 height = "1000",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))

sankeyplot <- plot(sankey) 

#plot(sankey)
```

```{r sankey bt}
dataSk <- data.frame( from = Change_total$temp.x, to= Change_total$temp_y , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "1000",
                                 height = "1000",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))

sankeyplot <- plot(sankey) 

#plot(sankey)
```


```{r sankey all simplified}
Change_total <- read.csv("~/Documents/ClimateOceanPlanning/R/NEFSC_GJAMM_GIT/simp_groups.csv")
dataSk <- data.frame( from = Change_total$simp_group, to= Change_total$simp_group2 , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "2000",
                                 height = "1000",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))

sankeyplot <- plot(sankey) 

plot(sankey)
```

```{r sankey egroups}
Change_total <- read.csv("~/Documents/ClimateOceanPlanning/R/NEFSC_GJAMM_GIT/egroups.csv", stringsAsFactors = FALSE)

Change_total[Change_total=="one"] <- "cool, nonsaline"
Change_total[Change_total=="two"] <- "deep, cool and warm"
Change_total[Change_total=="three"] <- "warm and cool, shallow, nonsaline"
Change_total[Change_total=="four"] <- "warm, shallow"


Change_total[Change_total=="first"] <- "warm, shallow."
Change_total[Change_total=="second"] <- "cool, deep, nonsaline, mud"
Change_total[Change_total=="third"] <- "cool, shallow, nonsaline"
Change_total[Change_total=="fourth"] <- "warm, deep saline"


dataSk <- data.frame( from = Change_total$E_a, to= Change_total$E_b , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "2000",
                                 height = "1000",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))



sankeyplot <- plot(sankey) 

plot(sankey)
```


even though nobody changes BT preferences, there are some species where BT wasn't importnat and then it was. In fact, in the future, bottom temperature becomes more improtant, which could be a cool ecological question (the same thing happens with salinity and depth, but we don't see this finding with substrate)


#Things to look at
1) species that went from non sig to having sig temperature relationship, was their non sig temperature preference the same or opposite from the other one 

2)I have to figure out a way to combine the geographic (shifting mean centroids) with the shifting environmental preferences data. Interesting questions could be are the species that are shifting geographically trying to stay within their preferred salinity range and don't care as much about substrate? What types of species are they? Are some that are not switching substrate switching salinity or temperature or depth? 

3) Also I should look at fishing pressure and see who is more influenced by fishing pressure and if those have shifted geographically or in environmental space. 


#sankey with SD variables 

```{r sankey SD}
Change_total <- read.csv("~/Documents/ClimateOceanPlanning/R/NEFSC_GJAMM_GIT/Change_total_SD.csv")
dataSk <- data.frame( from = Change_total$E_1_description, to= Change_total$E_2_description , Weight = .002)
sankey <- gvisSankey(dataSk, from = "from", to="to", weight = "Weight", options=list(width = "2000",
                                 height = "1000",
                                 sankey="{
                                 link: {colorMode: 'gradient', color: { fill: '#green' } },
                                 node: {nodePadding: 20, width:30, color: { fill: '#a61d4c'} },
                                 label: { color: '#871b47',fontSize: 50 } }"))

sankeyplot <- plot(sankey) 

plot(sankey)
```


"ATLANTOPANDALUS.PROPINQVUS","CANCER.PLEBEJUS", "CHACEON.QUINQUEDENS",
need to fix this because some things are spelled incorrectly etc 
specnames from Batt 2017
 `Atlantopandalus propinqvus`, `Hippoglossoides platessoides`,`Hippoglossina oblonga`, `Leptoclinus maculatus`, `Lopholatilus chamaeleonticeps`, `Lumpenus lampretaeformis`, `Lycenchelys verrillii`, `Macrorhamphosus scolopax`, 
ydata <- ydata %>% 
   select(`Acipenser oxyrinchus`, `Alosa aestivalis`, `Alosa pseudoharengus`, `Alosa sapidissima`, `Amblyraja radiata`, `Ammodytes dubius`, `Anarhichas lupus`, `Anchoa hepsetus`, `Anchoa mitchilli`, `Antigonia capros`, `Argentina silus`, `Argentina striata`, `Aspidophoroides monopterygius`,`Bairdiella chrysoura`, `Bathynectes longispina`, `Bathypolypus arcticus`, `Brevoortia tyrannus`, `Brosme brosme`, `Cancer borealis`, `Cancer plebejus`, `Carcharhinus plumbeus`, `Centropristis philadelphica`, `Centropristis striata`, `Chaceon quinquedens`, `Chionoecetes opilio`, `Chlorophthalmus agassizi`, `Citharichthys arctifrons`, `Clupea harengus`, `Conger oceanicus`, `Crangon septemspinosa`, `Cryptacanthodes maculatus`, `Cyclopterus lumpus`, `Cynoscion regalis`, `Dasyatis centroura`, `Dasyatis say`, `Decapterus punctatus`, `Dichelopandalus leptocerus`, `Dipturus laevis`, `Enchelyopus cimbrius`, `Etropus microstomus`, `Etrumeus teres(sadina)`, `Foetorepus agassizii`, `Gadus morhua`, `Glyptocephalus cynoglossus`, `Gymnura altavela`, `Helicolenus dactylopterus`, `Hemitripterus americanus`, `Hippoglossus hippoglossus`, `Homarus americanus`, `Illex illecebrosus`, `Lagodon rhomboides`, `Larimus fasciatus`, `Lebbeus polaris`, `Leiostomus xanthurus`, `Lepophidium profundorum`, `Leucoraja erinacea`, `Leucoraja garmani`, `Leucoraja ocellata`, `Limanda ferruginea`, `Limulus polyphemus`, `Liparis atlanticus`, `Lithodes maja`, `Loligo pealeii`, `Lolliguncula brevis`, `Lophius americanus`, `Malacoraja senta`, `Maurolicus weitzmani`, `Melanogrammus aeglefinus`, `Melanostigma atlanticum`, `Menidia menidia`, `Menticirrhus americanus`, `Menticirrhus saxatilis`, `Merluccius albidus`, `Merluccius bilinearis`, `Micropogonias undulatus`, `Monolene sessilicauda`, `Morone saxatilis`, `Mustelus canis`, `Myliobatis freminvillii`, `Myoxocephalus aenaeus`, `Myoxocephalus octodecemspinosus`, `Myxine glutinosa`, `Nemichthys scolopaceus`, `Ophidion marginatum`, `Osmerus mordax`, `Ovalipes ocellatus`, `Ovalipes stephensoni`, `Pandalus borealis`, `Pandalus montagui`, `Paralichthys dentatus`, `Parasudis truculenta`, `Pasiphaea multidentata`, `Peprilus triacanthus`, `Peristedion miniatum`, `Petromyzon marinus`, `Phycis chesteri`, `Placopecten magellanicus`, `Pollachius virens`, `Polymixia lowei`, `Pomatomus saltatrix`, `Pontinus longispinis`, `Pontophilus norvegicus`, `Prionotus alatus`, `Prionotus carolinus`, `Prionotus evolans`, `Pseudopleuronectes americanus`, `Raja eglanteria`, `Scomber scombrus`, `Scophthalmus aquosus`, `Scyliorhinus retifer`, `Sebastes fasciatus`, `Sicyonia brevirostris`, `Squalus acanthias`, `Squatina dumeril`, `Stenotomus chrysops`, `Syacium papillosum`, `Symphurus plagiusa`, `Synagrops bellus`, `Syngnathus fuscus`, `Synodus foetens`, `Synodus poeyi`, `Tautogolabrus adspersus`, `Trachinocephalus myops`, `Trachurus lathami`, `Trichiurus lepturus`, `Triglops murrayi`, `Trinectes maculatus`, `Ulvaria subbifurcata`, `Urophycis chuss`, `Urophycis regia`, `Urophycis tenuis`, `Zenopsis conchifera`, `Zoarces americanus`)


specNames <- c("ACIPENSER.OXYRYNCHUS"`, `"ALOSA.AESTIVALIS", "ALOSA.PSEUDOHARENGUS", "ALOSA.SAPIDISSIMA", "AMBLYRAJA.RADIATA", "AMMODYTES.DUBIUS", "ANARHICHAS.LUPUS", "ANCHOA.HEPSETUS", "ANCHOA.MITCHILLI", "ANTIGONIA.CAPROS", "ARGENTINA.SILUS", "ARGENTINA.STRIATA", "ASPIDOPHOROIDES.MONOPTERYGIUS", "BAIRDIELLA.CHRYSOURA", "BATHYNECTES.LONGISPINA", "BATHYPOLYPUS.ARCTICUS", "BREVOORTIA.TYRANNUS", "BROSME.BROSME", "CANCER.BOREALIS", "CARCHARHINUS.PLUMBEUS", "CENTROPRISTIS.PHILADELPHICA", "CENTROPRISTIS.STRIATA", "CHIONOECETES.OPILIO", "CHLOROPHTHALMUS.AGASSIZI", "CITHARICHTHYS.ARCTIFRONS", "CLUPEA.HARENGUS", "CONGER.OCEANICUS", "CRANGON.SEPTEMSPINOSA", "CRYPTACANTHODES.MACULATUS", "CYCLOPTERUS.LUMPUS", "CYNOSCION.REGALIS", "DASYATIS.CENTROURA", "DASYATIS.SAY", "DECAPTERUS.PUNCTATUS", "DICHELOPANDALUS.LEPTOCERUS", "DIPTURUS.LAEVIS", "ENCHELYOPUS.CIMBRIUS", "ETROPUS.MICROSTOMUS", "ETRUMEUS.TERES", "FOETOREPUS.AGASSIZII", "GADUS.MORHUA", "GLYPTOCEPHALUS.CYNOGLOSSUS", "GYMNURA.ALTAVELA", "HELICOLENUS.DACTYLOPTERUS", "HEMITRIPTERUS.AMERICANUS", "HIPPOGLOSSINA.OBLONGA", "HIPPOGLOSSOIDES.PLATESSOIDES", "HIPPOGLOSSUS.HIPPOGLOSSUS", "HOMARUS.AMERICANUS", "ILLEX.ILLECEBROSUS", "LAGODON.RHOMBOIDES", "LARIMUS.FASCIATUS", "LEBBEUS.POLARIS", "LEIOSTOMUS.XANTHURUS", "LEPOPHIDIUM.PROFUNDORUM", "LEPTOCLINUS.MACULATUS", "LEUCORAJA.ERINACEA", "LEUCORAJA.GARMANI", "LEUCORAJA.OCELLATA", "LIMANDA.FERRUGINEA", "LIMULUS.POLYPHEMUS", "LIPARIS.ATLANTICUS", "LITHODES.MAJA", "LOLIGO.PEALEII", "LOLLIGUNCULA.BREVIS", "LOPHIUS.AMERICANUS", "LOPHOLATILUS.CHAMAELEONTICEPS", "LUMPENUS.LAMPRETAEFORMIS", "LYCENCHELYS.VERRILLII", "MACRORHAMPHOSUS.SCOLOPAX", "MALACORAJA.SENTA", "MAUROLICUS.WEITZMANI", "MELANOGRAMMUS.AEGLEFINUS", "MELANOSTIGMA.ATLANTICUM", "MENIDIA.MENIDIA", "MENTICIRRHUS.AMERICANUS", "MENTICIRRHUS.SAXATILIS", "MERLUCCIUS.ALBIDUS", "MERLUCCIUS.BILINEARIS", "MICROPOGONIAS.UNDULATUS", "MONOLENE.SESSILICAUDA", "MORONE.SAXATILIS", "MUSTELUS.CANIS", "MYLIOBATIS.FREMINVILLII", "MYOXOCEPHALUS.AENAEUS", "MYOXOCEPHALUS.OCTODECEMSPINOSUS", "MYXINE.GLUTINOSA", "NEMICHTHYS.SCOLOPACEUS", "OPHIDION.MARGINATUM", "OSMERUS.MORDAX", "OVALIPES.OCELLATUS", "OVALIPES.STEPHENSONI", "PANDALUS.BOREALIS", "PANDALUS.MONTAGUI", "PARALICHTHYS.DENTATUS", "PARASUDIS.TRUCULENTA", "PASIPHAEA.MULTIDENTATA", "PEPRILUS.TRIACANTHUS", "PERISTEDION.MINIATUM", "PETROMYZON.MARINUS")

specNames <- c("PHYCIS.CHESTERI", "PLACOPECTEN.MAGELLANICUS", "POLLACHIUS.VIRENS", "POLYMIXIA.LOWEI", "POMATOMUS.SALTATRIX", "PONTINUS.LONGISPINIS", "PONTOPHILUS.NORVEGICUS", "PRIONOTUS.ALATUS", "PRIONOTUS.CAROLINUS", "PRIONOTUS.EVOLANS", "PSEUDOPLEURONECTES.AMERICANUS", "RAJA.EGLANTERIA", "SCOMBER.SCOMBRUS", "SCOPHTHALMUS.AQUOSUS", "SCYLIORHINUS.RETIFER", "SEBASTES.FASCIATUS", "SICYONIA.BREVIROSTRIS", "SQUALUS.ACANTHIAS", "SQUATINA.DUMERIL", "STENOTOMUS.CHRYSOPS", "SYACIUM.PAPILLOSUM", "SYMPHURUS.PLAGIUSA", "SYNAGROPS.BELLUS", "SYNGNATHUS.FUSCUS", "SYNODUS.FOETENS", "SYNODUS.POEYI", "TAUTOGOLABRUS.ADSPERSUS", "TRACHINOCEPHALUS.MYOPS", "TRACHURUS.LATHAMI", "TRICHIURUS.LEPTURUS", "TRIGLOPS.MURRATRINECTES.MACULATUS", "ULVARIA.SUBBIFURCATA", "UROPHYCIS.CHUSS", "UROPHYCIS.REGIA", "UROPHYCIS.TENUIS", "ZENOPSIS.CONCHIFERA", "ZOARCES.AMERICANUS")

specNames <- c(spec1, spec2)

xnames <- c("year", "depth", "btemp", "ssalin", "AMO_unsm_month", "NAO_month", "NAO_JFM", "BATHYMETRY", "SBF_GRP", "SEDIMENT")

ydata <- bioandcatch[,specNames]
xdata <- bioandcatch[,xnames]


```{r species diversity}
#how is species diversity related to environmental similarity? 
library(vegan)
library(Hotelling)
ydata <- read.csv("ydata.csv")
ydata <- ydata[2:508]

shann <- diversity(ydata)
simp <- (diversity(ydata,"simpson"))
total <- cbind(total, shann)

div <- glm(simp ~ surftemp + bottemp + botsalin + avgdepth + NAO_JFM + SD3x3shortsal + SD3x3shortsst + SD3x3shortbt, data = total)
```


#looping through GLM 
```{r}
#first time chunk 
total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")
#so I ran this with all of the SD types and the one that came out as much more important in the frist was the 3x3 short ones so I am going to rerun with just those for both time periods. 


total <- subset(total, est_year < 2000)
ydata <- total[,2:508]
ydata[is.na(ydata)] <- 0
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
#need to do this here to see ones that werent caught early and are caught later 
#now all of the unkown fish are outta there
first_glm_results <- data.frame()

for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- glm(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)

        ## capture summary stats
        intercept <- coef(summary(fit))[1]
        slope <- coef(summary(fit))[2]
        p.value <- coef(summary(fit))[8]
        AIC <- AIC(fit)
        Deviance <- deviance(fit)

        # get coefficents of fit
        cfit <- coef(summary(fit))
        cfit <- as.data.frame(cfit)
        cfit$names <- paste(specnames[i], rownames(cfit), sep="_")
        cfit$AIC <- AIC(fit)
        cfit$Deviance <- deviance(fit)
  
       
        first_glm_results <- rbind(results, cfit)
    } 

#second time chunk 

total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")
#so I ran this with all of the SD types and the one that came out as much more important in the frist was the 3x3 short ones so I am going to rerun with just those for both time periods. 


total <- subset(total, est_year > 1999)
ydata <- total[,2:508]
ydata[is.na(ydata)] <- 0
ycommon <- gjamTrimY(ydata, 100, OTHER=F)$y
#need to do this here to see ones that werent caught early and are caught later 
#now all of the unkown fish are outta there
# create data frame to store results
second_glm_results <- data.frame()

for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- glm(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)

        ## capture summary stats
        intercept <- coef(summary(fit))[1]
        slope <- coef(summary(fit))[2]
        p.value <- coef(summary(fit))[8]
        AIC <- AIC(fit)
        Deviance <- deviance(fit)

        # get coefficents of fit
        cfit <- coef(summary(fit))
        cfit <- as.data.frame(cfit)
        cfit$names <- paste(specnames[i], rownames(cfit), sep="_")
        cfit$AIC <- AIC(fit)
        cfit$Deviance <- deviance(fit)
  
       
        second_glm_results <- rbind(results, cfit)
    } 


#total 
total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")


# create data frame to store results
tot_glm_results <- data.frame()
tot_glm_stand <- data.frame()

for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- glm(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)
standardized <- lm.beta(fit)
        
  ## capture summary stats
        intercept <- coef(summary(fit))[1]
        slope <- coef(summary(fit))[2]
        p.value <- coef(summary(fit))[8]
        AIC <- AIC(fit)
        Deviance <- deviance(fit)
        
        sfit <- as.data.frame(t(standardized))
        sfit$names <- specnames[i]
  
        # get coefficents of fit
        cfit <- coef(summary(fit))
        cfit <- as.data.frame(cfit)
        cfit$names <- paste(specnames[i], rownames(cfit), sep="_")
        cfit$AIC <- AIC(fit)
        cfit$Deviance <- deviance(fit)
  
       
        tot_glm_results <- rbind(tot_glm_results, cfit)
        tot_glm_stand <- rbind(tot_glm_stand, sfit)
} 




#total RF 
total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")


# create data frame to store results
tot_rf_results <- data.frame()

for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- randomForest(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SEDIMENT + SBFDEPTH + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total, ntree=300, na.action = na.omit, importance=TRUE)
varimp <- importance(fit, type=1)

        varfit <- as.data.frame(t(varimp))
       varfit$names <- specnames[i]
  
        
       
        tot_rf_results <- rbind(tot_rf_results, varfit)
} 

tot_rf_results$strong <- colnames(tot_rf_results[1:11])[apply(tot_rf_results[1:11],1,which.max)]

```
#gam
````{r}
#total gam 
library(mgcv)
total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")
specnames <- as.vector(supp$names)

# create data frame to store results
tot_gam_results <- data.frame()
tot_gam_stand <- data.frame()
tot_gam_dev <- data.frame(matrix(ncol=11, nrow=1))
colnames(tot_gam_dev) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.geb")

for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- gam(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)
#standardized <- lm.beta(fit)
        fit_depth <- gam(as.formula(paste(specnames[i],"~ 1 +avgdepth")), data=total)
          fit_bt <- gam(as.formula(paste(specnames[i],"~ bottemp")), data=total)
           fit_sal <- gam(as.formula(paste(specnames[i],"~ botsalin")), data=total)
           fit_AMO <- gam(as.formula(paste(specnames[i],"~ AMO_unsm_year")), data=total)
           fit_NAO <- gam(as.formula(paste(specnames[i],"~ NAO_year")), data=total)   
         fit_sed <- gam(as.formula(paste(specnames[i],"~ SED_TYPE")), data=total)
         fit_sdsal <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsal")), data=total)
         fit_sdbt <- gam(as.formula(paste(specnames[i],"~ SD3x3shortbt")), data=total) 
          fit_sdsst <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsst")), data=total)
        fit_geb <- gam(as.formula(paste(specnames[i],"~ gebco_SD_2")), data=total)
        dev.depth <- summary(fit_depth)$dev.expl
        dev.bt <- summary(fit_bt)$dev.expl
        dev.sal <- summary(fit_sal)$dev.expl
        dev.AMO <- summary(fit_AMO)$dev.expl
        dev.NAO <- summary(fit_NAO)$dev.expl
        dev.sed <- summary(fit_sed)$dev.expl
        dev.sdsal <- summary(fit_sdsal)$dev.expl
        dev.sdbt <- summary(fit_sdbt)$dev.expl
        dev.sdsst <- summary(fit_sdsst)$dev.expl
        dev.geb <- summary(fit_geb)$dev.expl
        
        dev_table <- list("null", dev.depth, dev.bt, dev.sal, dev.AMO, dev.NAO, dev.sed, dev.sdsal, dev.sdbt, dev.sdsst, dev.geb)
        dev_table <- as.data.frame(dev_table)
        colnames(dev_table) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.geb")
        dev_table$names <- specnames[i]
        
        tot_gam_dev <- rbind(tot_gam_dev, dev_table)
        # get coefficents of fit
        #summary_model <- summary(fit)
        #p <- summary_model$p.table
        
        
        #cfit <- fit$coefficients
        #cfit <- as.data.frame(cfit)
        #cfit$names <- paste(specnames[i], rownames(cfit), sep="+")
        #cfit$AIC <- AIC(fit)
        #cfit$Deviance <- dev_table
        #cfit$p_value <- p[,4]
  
       
       # tot_gam_results <- rbind(tot_gam_results, cfit)
        #tot_gam_stand <- rbind(tot_gam_stand, sfit)
} 
tot_gam_dev <- tot_gam_dev[2:78,]

#gam with all substrates 
total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")
specnames <- as.vector(supp$names)

# create data frame to store results
#tot_gam_results <- data.frame()
#tot_gam_stand <- data.frame()
tot_gam_dev2 <- data.frame(matrix(ncol=17, nrow=1))
colnames(tot_gam_dev2) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.geb", "dev.lpi", "dev.slope", "dev.sbfgrp", "dev.sbfdepth", "dev.sed2", "dev.sbfdesed")

for (i in 1:length(specnames)) { #for each species in spec_list
  #fit <- gam(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + LPI + SLOPE + SBF_GRP + SBFDEPTH + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)
#standardized <- lm.beta(fit)
        fit_depth <- gam(as.formula(paste(specnames[i],"~ avgdepth")), data=total, poisson(link = "log"))
          fit_bt <- gam(as.formula(paste(specnames[i],"~ bottemp")), data=total, poisson(link = "log"))
           fit_sal <- gam(as.formula(paste(specnames[i],"~ botsalin")), data=total, poisson(link = "log"))
           fit_AMO <- gam(as.formula(paste(specnames[i],"~ AMO_unsm_year")), data=total, poisson(link = "log"))
           fit_NAO <- gam(as.formula(paste(specnames[i],"~ NAO_year")), data=total, poisson(link = "log"))   
         fit_sed <- gam(as.formula(paste(specnames[i],"~ SED_TYPE")), data=total, poisson(link = "log"))
         fit_sdsal <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsal")), data=total, poisson(link = "log"))
         fit_sdbt <- gam(as.formula(paste(specnames[i],"~ SD3x3shortbt")), data=total, poisson(link = "log")) 
          fit_sdsst <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsst")), data=total, poisson(link = "log"))
        fit_geb <- gam(as.formula(paste(specnames[i],"~ gebco_SD_2")), data=total, poisson(link = "log"))
        fit_lpi <- gam(as.formula(paste(specnames[i],"~ LPI")), data=total, poisson(link = "log"))
        fit_slope <- gam(as.formula(paste(specnames[i],"~ SLOPE")), data=total, poisson(link = "log"))
        fit_sbfgrp <- gam(as.formula(paste(specnames[i],"~ SBF_GRP")), data=total, poisson(link = "log"))
        fit_sbfdepth <- gam(as.formula(paste(specnames[i],"~ SBFDEPTH")), data=total, poisson(link = "log"))
        fit_sed2 <- gam(as.formula(paste(specnames[i],"~ SEDIMENT")), data=total, poisson(link = "log"))
        fit_sbfdesed <- gam(as.formula(paste(specnames[i],"~ SBFDESED")), data=total, poisson(link = "log"))

        dev.depth <- summary(fit_depth)$dev.expl
        dev.bt <- summary(fit_bt)$dev.expl
        dev.sal <- summary(fit_sal)$dev.expl
        dev.AMO <- summary(fit_AMO)$dev.expl
        dev.NAO <- summary(fit_NAO)$dev.expl
        dev.sed <- summary(fit_sed)$dev.expl
        dev.sdsal <- summary(fit_sdsal)$dev.expl
        dev.sdbt <- summary(fit_sdbt)$dev.expl
        dev.sdsst <- summary(fit_sdsst)$dev.expl
        dev.geb <- summary(fit_geb)$dev.expl
        dev.lpi <- summary(fit_lpi)$dev.expl
        dev.slope <- summary(fit_slope)$dev.expl
        dev.sbfgrp <- summary(fit_sbfgrp)$dev.expl
        dev.sbfdepth <- summary(fit_sbfdepth)$dev.expl
        dev.sed2 <- summary(fit_sed2)$dev.expl
        dev.sbfdesed <- summary(fit_sbfdesed)$dev.expl

        dev_table <- list("null", dev.depth, dev.bt, dev.sal, dev.AMO, dev.NAO, dev.sed, dev.sdsal, dev.sdbt, dev.sdsst, dev.geb, dev.lpi, dev.slope, dev.sbfgrp, dev.sbfdepth, dev.sed2, dev.sbfdesed)
        dev_table <- as.data.frame(dev_table)
        colnames(dev_table) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.geb", "dev.lpi", "dev.slope", "dev.sbfgrp", "dev.sbfdepth", "dev.sed2", "dev.sbfdesed")
        dev_table$names <- specnames[i]
        
        tot_gam_dev2 <- rbind(tot_gam_dev2, dev_table)
        # get coefficents of fit
        #summary_model <- summary(fit)
        #p <- summary_model$p.table
        
        
        #cfit <- fit$coefficients
        #cfit <- as.data.frame(cfit)
        #cfit$names <- paste(specnames[i], rownames(cfit), sep="+")
        #cfit$AIC <- AIC(fit)
        #cfit$Deviance <- dev_table
        #cfit$p_value <- p[,4]
  
       
       # tot_gam_results <- rbind(tot_gam_results, cfit)
        #tot_gam_stand <- rbind(tot_gam_stand, sfit)
} 
tot_gam_dev2 <- tot_gam_dev2[2:78,]
tot_gam_dev2$strong <- colnames(tot_gam_dev2[2:17])[apply(tot_gam_dev2[2:17],1,which.max)]

tot_gam_sub <- tot_gam_dev2

#alright after running this its clear that the substrate variable with the most deviance explained across species is sbfdesed. Try running GAM with that as the only substrate variable 

#gam with just sbfdesed 
total <- read.csv("total.csv")
ydata <- read.csv("ydata.csv")
xdata <- read.csv("xdata.csv")
specnames <- as.vector(supp$names)

# create data frame to store results
#tot_gam_results <- data.frame()
#tot_gam_stand <- data.frame()
tot_gam_dev2 <- data.frame(matrix(ncol=11, nrow=1))
colnames(tot_gam_dev2) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.sbfdesed", "dev.sed")

for (i in 1:length(specnames)) { #for each species in spec_list
  #fit <- gam(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + LPI + SLOPE + SBF_GRP + SBFDEPTH + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)
#standardized <- lm.beta(fit)
        fit_depth <- gam(as.formula(paste(specnames[i],"~ avgdepth")), data=total, family=nb(link="log"))
          fit_bt <- gam(as.formula(paste(specnames[i],"~ bottemp")), data=total, family=nb(link="log"))
           fit_sal <- gam(as.formula(paste(specnames[i],"~ botsalin")), data=total, family=nb(link="log"))
           fit_AMO <- gam(as.formula(paste(specnames[i],"~ AMO_unsm_year")), data=total, family=nb(link="log"))
           fit_NAO <- gam(as.formula(paste(specnames[i],"~ NAO_year")), data=total, family=nb(link="log"))   
         fit_sdsal <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsal")), data=total, family=nb(link="log"))
         fit_sdbt <- gam(as.formula(paste(specnames[i],"~ SD3x3shortbt")), data=total, family=nb(link="log")) 
          fit_sdsst <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsst")), data=total, family=nb(link="log"))
          fit_sbfdesed <- gam(as.formula(paste(specnames[i],"~ SBFDESED")), data=total, family=nb(link="log"))
          fit_sed <- gam(as.formula(paste(specnames[i],"~ SEDIMENT")), data=total, family=nb(link="log"))

        
        dev.depth <- summary(fit_depth)$dev.expl
        dev.bt <- summary(fit_bt)$dev.expl
        dev.sal <- summary(fit_sal)$dev.expl
        dev.AMO <- summary(fit_AMO)$dev.expl
        dev.NAO <- summary(fit_NAO)$dev.expl
        dev.sdsal <- summary(fit_sdsal)$dev.expl
        dev.sdbt <- summary(fit_sdbt)$dev.expl
        dev.sdsst <- summary(fit_sdsst)$dev.expl
        dev.sed <- summary(fit_sed)$dev.expl
        dev.sbfdesed <- summary(fit_sbfdesed)$dev.expl

        dev_table <- list("null", dev.depth, dev.bt, dev.sal, dev.AMO, dev.NAO, dev.sdsal, dev.sdbt, dev.sdsst, dev.sbfdesed, dev.sed)
        dev_table <- as.data.frame(dev_table)
        colnames(dev_table) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.sbfdesed", "dev.sed")
        
        dev_table$names <- specnames[i]
        
        tot_gam_dev2 <- rbind(tot_gam_dev2, dev_table)
        # get coefficents of fit
        #summary_model <- summary(fit)
        #p <- summary_model$p.table
        
        
        #cfit <- fit$coefficients
        #cfit <- as.data.frame(cfit)
        #cfit$names <- paste(specnames[i], rownames(cfit), sep="+")
        #cfit$AIC <- AIC(fit)
        #cfit$Deviance <- dev_table
        #cfit$p_value <- p[,4]
  
       
       # tot_gam_results <- rbind(tot_gam_results, cfit)
        #tot_gam_stand <- rbind(tot_gam_stand, sfit)
} 
tot_gam_dev2 <- tot_gam_dev2[2:78,]
tot_gam_dev2$strong <- colnames(tot_gam_dev2[2:11])[apply(tot_gam_dev2[2:11],1,which.max)]

#removing sbfsed 
tot_gam_dev3 <- tot_gam_dev2 %>% dplyr::select(-dev.sbfdesed, -dev.depth)
tot_gam_dev3$strong <- colnames(tot_gam_dev3[2:9])[apply(tot_gam_dev3[2:9],1,which.max)]


##citation for negative binomial model https://www.nrcresearchpress.com/doi/full/10.1139/cjfas-2013-0342#.XcxMXJNKg6U

# fit_bt <- gam(as.formula(paste(specnames[i],"~ bottemp")), data=total, family=ziP())
# summary(fit_bt)
# fit_bt <- gam(as.formula(paste(specnames[i],"~ bottemp")), data=total, family=poisson(link="log"))
# summary(fit_bt)
fit_bt <- gam(Paralichthys.dentatus..summer.flounder.~ bottemp + SBFDESED + avgdepth + botsalin + AMO_unsm_year + NAO_year + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2, data=total, family=nb(link="log"), method="REML")

summary(fit_bt)
# 
# fit_bt <- gam(as.formula(paste(specnames[i],"~ SBFDESED")), data=total, family=ziP())
# summary(fit_bt)
# fit_bt <- gam(as.formula(paste(specnames[i],"~ SBFDESED")), data=total, family=poisson(link="log"))
# summary(fit_bt)
# fit_bt <- gam(as.formula(paste(specnames[i],"~ SBFDESED")), data=total, family=nb(link="log"))
# summary(fit_bt)


# same as above but rsquared 
tot_gam_dev2 <- data.frame(matrix(ncol=11, nrow=1))
colnames(tot_gam_dev2) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.sbfdesed", "dev.sed")

for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- gam(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + LPI + SLOPE + SBF_GRP + SBFDEPTH + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)
#standardized <- lm.beta(fit)
        fit_depth <- gam(as.formula(paste(specnames[i],"~ avgdepth")), data=total, family=nb(link="log"))
          fit_bt <- gam(as.formula(paste(specnames[i],"~ bottemp")), data=total, family=nb(link="log"))
           fit_sal <- gam(as.formula(paste(specnames[i],"~ botsalin")), data=total, family=nb(link="log"))
           fit_AMO <- gam(as.formula(paste(specnames[i],"~ AMO_unsm_year")), data=total, family=nb(link="log"))
           fit_NAO <- gam(as.formula(paste(specnames[i],"~ NAO_year")), data=total, family=nb(link="log"))   
         fit_sdsal <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsal")), data=total, family=nb(link="log"))
         fit_sdbt <- gam(as.formula(paste(specnames[i],"~ SD3x3shortbt")), data=total, family=nb(link="log")) 
          fit_sdsst <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsst")), data=total, family=nb(link="log"))
          fit_sbfdesed <- gam(as.formula(paste(specnames[i],"~ SBFDESED")), data=total, family=nb(link="log"))
          fit_sed <- gam(as.formula(paste(specnames[i],"~ SEDIMENT")), data=total, family=nb(link="log"))

        
        dev.depth <- summary(fit_depth)$r.sq
        dev.bt <- summary(fit_bt)$r.sq
        dev.sal <- summary(fit_sal)$r.sq
        dev.AMO <- summary(fit_AMO)$r.sq
        dev.NAO <- summary(fit_NAO)$r.sq
        dev.sdsal <- summary(fit_sdsal)$r.sq
        dev.sdbt <- summary(fit_sdbt)$r.sq
        dev.sdsst <- summary(fit_sdsst)$r.sq
        dev.sbfdesed <- summary(fit_sbfdesed)$r.sq
        dev.sed <- summary(fit_sed)$r.sq

        dev_table <- list("null", dev.depth, dev.bt, dev.sal, dev.AMO, dev.NAO, dev.sdsal, dev.sdbt, dev.sdsst, dev.sbfdesed, dev.sed)
        dev_table <- as.data.frame(dev_table)
        colnames(dev_table) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.sbfdesed", "dev.sed")
        
        dev_table$names <- specnames[i]
        
        tot_gam_dev2 <- rbind(tot_gam_dev2, dev_table)
        # get coefficents of fit
        #summary_model <- summary(fit)
        #p <- summary_model$p.table
        
        
        #cfit <- fit$coefficients
        #cfit <- as.data.frame(cfit)
        #cfit$names <- paste(specnames[i], rownames(cfit), sep="+")
        #cfit$AIC <- AIC(fit)
        #cfit$Deviance <- dev_table
        #cfit$p_value <- p[,4]
  
       
       # tot_gam_results <- rbind(tot_gam_results, cfit)
        #tot_gam_stand <- rbind(tot_gam_stand, sfit)
} 
tot_gam_dev2 <- tot_gam_dev2[2:78,]
tot_gam_dev2$strong <- colnames(tot_gam_dev2[2:10])[apply(tot_gam_dev2[2:10],1,which.max)]

tot_gam_r2 <- tot_gam_dev2


#stepwise ANOVA 

tot_gam_drop_pois <- data.frame(matrix(ncol=11, nrow=1))
colnames(tot_gam_drop_pois) <- colnames(drop_1)

for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- gam(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SEDIMENT + SBFDESED + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst")), data=total, family=ziP(theta = NULL, link = "identity",b=0))

drop <- anova(fit)
drop <- drop$pTerms.table
drop_1 <- as.data.frame(t(drop[,2]))
       
        drop_1$names <- specnames[i]
        
        tot_gam_drop_pois <- rbind(tot_gam_drop_pois, drop_1)
                              }

tot_gam_drop_pois <- tot_gam_drop_pois[2:78,]
tot_gam_drop_pois$strong <- colnames(tot_gam_drop_pois[1:10])[apply(tot_gam_drop_pois[1:10],1,which.max)]



```

#negbino glm 

```{r}
# create data frame to store results
tot_gam_results <- data.frame()
tot_gam_log <- data.frame()
tot_gam_dev <- data.frame(matrix(ncol=7, nrow=1))
colnames(tot_gam_dev) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed")
tot_gam_log <- data.frame(matrix(ncol=7, nrow=1))
colnames(tot_gam_log) <- c("names", "log.depth", "log.bt", "log.sal", "log.AMO", "log.NAO", "log.sed")


for (i in 1:length(specnames)) { #for each species in spec_list
  #fit <- gam(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SEDIMENT + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)
#standardized <- lm.beta(fit)
  tryCatch({
        fit_depth <- glm.nb(as.formula(paste(specnames[i],"~ 1+ avgdepth")), data=total)
            fit_bt <- glm.nb(as.formula(paste(specnames[i],"~ 1 + bottemp")), data=total)
           fit_sal <- glm.nb(as.formula(paste(specnames[i],"~ 1 +  botsalin")), data=total)
           fit_AMO <- glm.nb(as.formula(paste(specnames[i],"~ 1 + AMO_unsm_year")), data=total)
           fit_NAO <- glm.nb(as.formula(paste(specnames[i],"~1 + NAO_year")), data=total)   
         fit_sed <- glm.nb(as.formula(paste(specnames[i],"~ 1 + SEDIMENT")), data=total)
         #fit_sdsal <- glm.nb(as.formula(paste(specnames[i],"~ 1 + SD3x3shortsal")), data=total)
         #fit_sdbt <- glm.nb(as.formula(paste(specnames[i],"~ 1 + SD3x3shortbt")), data=total) 
          #fit_sdsst <- glm.nb(as.formula(paste(specnames[i],"~ 1 + SD3x3shortsst")), maxit = 1000, data=total)
       # fit_geb <- glm.nb(as.formula(paste(specnames[i],"~ 1 + gebco_SD_2")), data=total)
        dev.depth<- 1-(fit_depth$deviance/fit_depth$null.deviance)
        dev.bt<- 1-(fit_bt$deviance/fit_bt$null.deviance)
        dev.sal <- 1-(fit_sal$deviance/fit_sal$null.deviance)
        dev.AMO <- 1-(fit_AMO$deviance/fit_AMO$null.deviance)
        dev.NAO <- 1-(fit_NAO$deviance/fit_NAO$null.deviance)
        dev.sed <- 1-(fit_sed$deviance/fit_sed$null.deviance)
        #dev.sdsal <- fit_sdsal$deviance
        #dev.sdbt <- fit_sdbt$deviance
      #  dev.geb <- fit_geb$deviance
        
       log.depth <- logLik(fit_depth)
        log.bt <- logLik(fit_bt)
        log.sal <- logLik(fit_sal)
        log.AMO <- logLik(fit_AMO)
        log.NAO <- logLik(fit_NAO)
        log.sed <- logLik(fit_sed)
        #log.sdsal <- logLik(fit_sdsal)
        #log.sdbt <- logLik(fit_sdbt)
       # log.geb <- logLik(fit_geb)
        
        dev_table <- list("null", dev.depth, dev.bt, dev.sal, dev.AMO, dev.NAO, dev.sed)
        dev_table <- as.data.frame(dev_table)
        colnames(dev_table) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed")
        dev_table$names <- specnames[i]
        
        tot_gam_dev <- rbind(tot_gam_dev, dev_table)
        
        log_table <- list("null", log.depth, log.bt, log.sal, log.AMO, log.NAO, log.sed)
        log_table <- as.data.frame(log_table)
        colnames(log_table) <- c("names", "log.depth", "log.bt", "log.sal", "log.AMO", "log.NAO", "log.sed")
        log_table$names <- specnames[i]
        tot_gam_log <- rbind(tot_gam_log, log_table)
    }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
        # get coefficents of fit
        #summary_model <- summary(fit)
        #p <- summary_model$p.table
        
        
        #cfit <- fit$coefficients
        #cfit <- as.data.frame(cfit)
        #cfit$names <- paste(specnames[i], rownames(cfit), sep="+")
        #cfit$AIC <- AIC(fit)
        #cfit$Deviance <- dev_table
        #cfit$p_value <- p[,4]
  
       
       # tot_gam_results <- rbind(tot_gam_results, cfit)
        #tot_gam_stand <- rbind(tot_gam_stand, sfit)
} 
tot_gam_dev <- tot_gam_dev[2:70,]
```
#using drop 1 glm
```{r}
tot_gam_drop_AIC <- data.frame(matrix(ncol=17, nrow=1))
colnames(tot_gam_drop_AIC) <- colnames(drop_1)

for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- glm(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + LPI + SLOPE + SBF_GRP + SBFDEPTH + SED_TYPE + SEDIMENT + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)
drop <- drop1(fit, test="F")
drop_1 <- as.data.frame(t(drop[3]))
       
        drop_1$names <- specnames[i]
        
        tot_gam_drop_AIC <- rbind(tot_gam_drop_AIC, drop_1)
                              }

tot_gam_drop_dev <- data.frame(matrix(ncol=17, nrow=1))
colnames(tot_gam_drop_dev) <- colnames(drop_1)



for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- glm(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + LPI + SLOPE + SBF_GRP + SBFDEPTH + SED_TYPE + SEDIMENT + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)
drop <- drop1(fit, test="F")
drop_1 <- as.data.frame(t(drop[2]))
       
        drop_1$names <- specnames[i]
        
        tot_gam_drop_dev <- rbind(tot_gam_drop_dev, drop_1)
                              }


tot_gam_drop_AIC <- tot_gam_drop_AIC[2:78,]
tot_gam_drop_dev <- tot_gam_drop_dev[2:78,]
tot_gam_drop_AIC$strong <- colnames(tot_gam_drop_AIC[2:16])[apply(tot_gam_drop_AIC[2:16],1,which.max)]

tot_gam_drop_dev$strong <- colnames(tot_gam_drop_dev[2:16])[apply(tot_gam_drop_dev[2:16],1,which.max)]


#simplified drop 
tot_gam_drop_AIC_simp <- data.frame(matrix(ncol=11, nrow=1))
colnames(tot_gam_drop_AIC_simp) <- colnames(drop_1)

for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- glm(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SEDIMENT + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst")), data=total)
drop <- drop1(fit, test="F")
drop_1 <- as.data.frame(t(drop[3]))
       
        drop_1$names <- specnames[i]
        
        tot_gam_drop_AIC_simp <- rbind(tot_gam_drop_AIC_simp, drop_1)
                              }

tot_gam_drop_dev_simp <- data.frame(matrix(ncol=11, nrow=1))
colnames(tot_gam_drop_dev_simp) <- colnames(drop_1)



for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- glm(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SEDIMENT + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst")), data=total)
drop <- drop1(fit, test="F")
drop_1 <- as.data.frame(t(drop[2]))
       
        drop_1$names <- specnames[i]
        
        tot_gam_drop_dev_simp <- rbind(tot_gam_drop_dev_simp, drop_1)
                              }


tot_gam_drop_AIC_simp <- tot_gam_drop_AIC_simp[2:78,]
tot_gam_drop_dev_simp <- tot_gam_drop_dev_simp[2:78,]
tot_gam_drop_AIC_simp$strong <- colnames(tot_gam_drop_AIC_simp[2:10])[apply(tot_gam_drop_AIC_simp[2:10],1,which.max)]

tot_gam_drop_dev_simp$strong <- colnames(tot_gam_drop_dev_simp[2:10])[apply(tot_gam_drop_dev_simp[2:10],1,which.max)]

#lets compare 
glm_drop_compare <- left_join(tot_gam_drop_dev_simp, tot_gam_drop_AIC_simp, by="names")
glm_drop_compare <- glm_drop_compare %>% dplyr::select(names, strong.x, strong.y)



#negativebinomial drop 
library(pscl)

glm_drop_AIC <- data.frame(matrix(ncol=17, nrow=1))
colnames(glm_drop_AIC) <- colnames(drop_1)

for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- zeroinfl(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + LPI + SLOPE + SBF_GRP + SBFDEPTH + SED_TYPE + SEDIMENT + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total, dist="negbin", maxit = 100)
drop <- drop1(fit, test="F")
drop_1 <- as.data.frame(t(drop[3]))
       
        drop_1$names <- specnames[i]
        
        glm_drop_AIC <- rbind(glm_drop_AIC, drop_1)
                              }

glm_drop_dev <- data.frame(matrix(ncol=11, nrow=1))
glm_drop_AIC <- data.frame(matrix(ncol=11, nrow=1))

colnames(glm_drop_dev) <- colnames(drop_1)
colnames(glm_drop_AIC) <- colnames(drop_1)

library(arm)
library(hurdlr)
set.seed(123)
for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- glm.nb(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SEDIMENT + SD3x3shortsal + SD3x3shortbt")), data=total, na.action = na.omit, maxit=1000)
  #fit <- glm(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + gebco_SD_2 + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst")), data=total, na.action = na.omit, family=quasipoisson(link="log"))
  #coefini=coef(glm(Lumpenus.lampretaeformis..snakeblenny.~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SEDIMENT + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst, , data=total, na.action = na.omit, family=quasipoisson(link="log")))
fit <- bayesglm(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SEDIMENT + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst")), data=total, na.action = na.omit, family=nb(link="log"))
# logLik_1 <- logLik(fit)
# getS3method('logLik', 'negbin')
# getS3method(fit)
# drop <- lrtest(fit)
drop <- drop1(fit)
drop_1 <- as.data.frame(t(drop[2]))
       
        drop_1$names <- specnames[i]
        
        glm_drop_dev <- rbind(glm_drop_dev, drop_1)
        drop_2 <- as.data.frame(t(drop[3]))
        glm_drop_AIC <- rbind(glm_drop_AIC, drop_2)
                                )
                              }


glm_drop_AIC <- glm_drop_AIC[2:78,]
glm_drop_dev <- glm_drop_dev[2:78,]
glm_drop_AIC$strong <- colnames(glm_drop_AIC[2:16])[apply(glm_drop_AIC[2:16],1,which.max)]

glm_drop_dev$strong <- colnames(glm_drop_dev[1:10])[apply(glm_drop_dev[1:10],1,which.max)]




```

#deviance explained - kinda useless
```{r}
# cred_dev_gam <- tot_gam_results %>% 
# separate(col=names, sep="([+])", into=c("names", "var"))
# cred_dev_gam <- cred_dev_gam[!(cred_dev_gam$p_value > .05),]
#   #this gets out all of the significant values 
# 
# cred_dev_gam_2 <- cred_dev_gam%>% 
#   dplyr:::select(-AIC, -p_value, -cfit) %>% 
#   spread(var, value=Deviance)
# 
# ix <- 2:13 
# cred_dev_gam_2[ix] <- lapply(cred_dev_gam_2[ix], as.numeric) 

tot_gam_dev$strong <- colnames(tot_gam_dev[2:11])[apply(tot_gam_dev[2:11],1,which.max)]
#MAX<-apply(cred_dev_gam_2[2:13], 1, max, na.rm=TRUE)

#compare this to cred_order 
check <- merge(x=cred_dev_gam_2, y=cred_order[, c("names", "strong")], by="names", all.x=TRUE)


spec_info <- read.csv("specnames_withinfo.csv")
cred_dev_gam_2 <- left_join(cred_dev_gam_2, spec_info, by="names")




cred_dist <- cred_order %>% 
  dplyr:::select(names, dist_shifted, convex_diff)

cred_dev_gam_2 <- left_join(cred_dev_gam_2, cred_dist, by="names")
                 
cred_dev_gam_2$strong_2 <- ifelse(cred_dev_gam_2$strong == "SEDTYPESilt/Mud" | cred_dev_gam_2$strong == "SEDTYPESand", "substrate", ifelse(cred_dev_gam_2$strong == "bottemp", "bottemp", ifelse(cred_dev_gam_2$strong == "avgdepth", "depth", ifelse(cred_dev_gam_2$strong == "SD3x3shortsal" | cred_dev_gam_2$strong == "SD3x3shortsst" | cred_dev_gam_2$strong == "SD3x3shortsst", "variability", ifelse(cred_dev_gam_2$strong == "AMOunsmyear"| cred_dev_gam_2$strong == "NAOyear", "climate", NA)))))


cred_dev_gam_2$strong_3 <- ifelse(cred_dev_gam_2$strong == "SEDTYPESilt/Mud" | cred_dev_gam_2$strong == "SEDTYPESand", "substrate", ifelse(cred_dev_gam_2$strong == "bottemp", "bottemp", NA))
                                                                                           
                 
#run comaprison test and make boxplots 
summary(aov(dist_shifted ~ strong, data=cred_dev_gam_2))
summary(aov(dist_shifted ~ strong_2, data=cred_dev_gam_2))
summary(lm(dist_shifted ~ strong_2, data=cred_dev_gam_2))



kruskal.test(AMO_unsm_year ~ as.factor(depth_saba_simp), data=cred_dev_gam_2)

kruskal.test(avgdepth ~ as.factor(depth_saba_simp), data=cred_dev_gam_2)

kruskal.test(botsalin ~ as.factor(depth_saba_simp), data=cred_dev_gam_2)

kruskal.test(bottemp ~ as.factor(depth_saba_simp), data=cred_dev_gam_2) # yikes this isn't significant

kruskal.test(gebco_SD_2 ~ as.factor(depth_saba_simp), data=cred_dev_gam_2)

kruskal.test(NAO_year ~ as.factor(depth_saba_simp), data=cred_dev_gam_2)

kruskal.test(SD3x3shortbt ~ as.factor(depth_saba_simp), data=cred_dev_gam_2)

kruskal.test(SD3x3shortsal ~ as.factor(depth_saba_simp), data=cred_dev_gam_2)

kruskal.test(SD3x3shortsst ~ as.factor(depth_saba_simp), data=cred_dev_gam_2)

kruskal.test(SED_TYPESand ~ as.factor(depth_saba_simp), data=cred_dev_gam_2)


summary(lm(dist_shifted ~ bottemp, data=cred_dev_gam_2))

#okay so sediment is significantly different between pelagic and benthic when we include p values that aren't significant and not when they arent. bottom temperature is never significant, ugh. 

```


#figures by specs 
```{r}
spec_info <- read.csv("specnames_withinfo.csv")
cred_order <- left_join(cred_tot_sig_comb, spec_info, by="names")
cred_order<-cred_order[!(cred_order$names=="Unknown.01" | cred_order$names=="Unknown.02"),]
ggplot(cred_order, aes(x=dist_shifted, y=abs(bottemp), color=depth_profile)) +
    geom_point(shape=1) 

#summary(glm(dist_shifted ~ avgdepth + bottemp + botsalin + AMOunsmyear + NAOyear + `SEDTYPESilt/Mud` + SEDTYPESand + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebcoSD2, data=cred_order, na.action=na.exclude))

#distance info 
cred_dist <- read.csv("dist_info.csv")

cred_order <- left_join(cred_order, cred_dist)
#this makes one data frame with just the substrate variables combined 
cred_sub1 <- cred_order %>% 
  dplyr:::select(names, `SEDTYPESilt/Mud`, dist_shifted, convex_diff, rel_abd_diff, abd_diff, depth_profile, depth_saba_simp)
cred_sub1$sub <- cred_sub1$`SEDTYPESilt/Mud`

cred_sub <- cred_order %>% 
  dplyr:::select(names, SEDTYPESand, dist_shifted, convex_diff, rel_abd_diff, abd_diff, depth_profile)
cred_sub$sub <- cred_sub$SEDTYPESand
cred_sub$names <- paste(cred_sub$names, "2", sep="")


cred_sub2 <- smartbind(cred_sub1, cred_sub)

ggplot(cred_sub2, aes(x=dist_shifted, y=abs(sub), color=depth_profile)) +
    geom_point(shape=1) #+    # Use hollow circles
    #\geom_smooth(method=lm)
#summary(glm(dist_shifted ~ abs(sub), data=cred_sub2))



```

Okay, what if we took a species strongest relationship and mapped that number vs distance shifted and then categorized it (colored it) based on what the association is! 
```{r}
cred_strong <- cred_order[3:13] 
cred_strong <- abs(cred_strong)
cred_strong$strong <- colnames(cred_strong)[apply(cred_strong,1,which.max)]
MAX<-apply(cred_strong[1:11], 1, max, na.rm=TRUE)

cred_strong$strong_estimate <- MAX

cred_order$strong_estimate <- MAX
cred_order$strong <- cred_strong$strong

ggplot(cred_order, aes(x=dist_shifted, y=abs(strong_estimate), color=strong)) +
    geom_point(shape=1)

ggplot(cred_order, aes(x=dist_shifted, y=strong, color=depth_saba_simp)) + 
  geom_point()

ggplot(cred_order, aes(x=dist_shifted, y=depth_saba)) + 
  geom_point()

ggplot(cred_order, aes(x=dist_shifted, y=names, color=depth_profile)) + 
  geom_point()


ggplot(cred_order, aes(x=convex_diff, y=names, color=depth_profile)) + 
  geom_point()

summary(lm(dist_shifted ~ strong, data=cred_order))

cred_order$strong_2 <- ifelse(cred_order$strong == "SEDTYPESilt/Mud" | cred_order$strong == "SEDTYPESand", "substrate", ifelse(cred_order$strong == "bottemp", "bottemp", ifelse(cred_order$strong == "avgdepth", "depth", ifelse(cred_order$strong == "SD3x3shortsal" | cred_order$strong == "SD3x3shortsst" | cred_order$strong == "SD3x3shortsst", "variability", ifelse(cred_order$strong == "AMOunsmyear"| cred_order$strong == "NAOyear", "climate", NA)))))


cred_order$strong_3 <- ifelse(cred_order$strong == "SEDTYPESilt/Mud" | cred_order$strong == "SEDTYPESand", "substrate", ifelse(cred_order$strong == "bottemp", "bottemp", NA))
                                                                                                                               
summary(lm(dist_shifted ~ strong_2, data=cred_order))
#if only this was significant



ggplot(cred_order, aes(x=dist_shifted, y=strong_2, color=depth_saba)) + 
  geom_point()

ggplot(cred_order, aes(x=dist_shifted, y=depth_saba_simp, color=strong_3)) + 
  geom_point()


kruskal.test(dist_shifted ~ as.factor(strong_2), data=cred_order)
pairwise.wilcox.test(cred_order$dist_shifted,  as.factor(cred_order$strong_2))

#okay so p is .1 here which could mean there is a significant difference between species that have substrate as their strongest variable vs species that have bt as their strongest variable in terms of their distance shifted. 

summary(lm(dist_shifted ~ strong_2, data=cred_order))
###Okay if I am interpreting this correctly than there is a significant relationship between distance shifted and the factor (either bt or substrate) as the most significant variable. Right?? 


summary(anovaD)
TukeyHSD(anovaD)
```
#standardizing ggplot 
```{r}
ggtheme_Plot <- function() {
  theme(
    plot.title = element_text(size = rel(1), hjust = 0, face = "bold"),
    panel.background = element_blank(),
    strip.background = element_blank(),
    # strip.text       = element_text(size = base_size, face = "italic"),
    panel.border     = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    axis.text.x = element_text(size = 18,
                               angle = 0,
                               face = "plain"),
    axis.text.y = element_text(size = 18),
    axis.title = element_text(size = 18),
    legend.key = element_rect(colour = NA, fill = NA),
    legend.position  = "top",
    legend.title = element_text(size = 18),
    legend.text = element_text(size = 18),
    strip.text.x = element_text(size = 18),
    strip.text = element_text(size = 18)
  )
}

```

#assumptions of normality 
```{r}
source("http://goo.gl/UUyEzD")
outlierKD(cred_order, avgdepth)

qqnorm(cred_order$bottemp)
qqline(cred_order$bottemp)


#homogeneity of variances 
fligner.test(dist_shifted~depth_saba_simp, data=cred_order)
bartlett.test(dist~depth_saba, data=cred_order)
library(car)
leveneTest(dist~depth_saba, data=cred_order)
leveneTest(dist~depth_profile_simp, data=cred_order)

#if p is significant, means there is difference in variances between groups and can't use ANOVA 
```

#lets try an anova 
```{r}

anovaD <- aov(dist ~ depth_profile_simp, data=cred_order)
summary(anovaD) #sig
TukeyHSD(anovaD)

anovaD <- aov(dist_shifted ~ strong_2, data=cred_order)
summary(anovaD) #sig
TukeyHSD(anovaD)

anovaD <- aov(dist_shifted ~ strong_3, data=cred_order)
summary(anovaD) #sig
TukeyHSD(anovaD)

anovaD <- aov(convex_diff ~ depth_saba_simp, data=cred_order)
summary(anovaD)
TukeyHSD(anovaD) #sig

anovaD <- aov(abd_diff ~ depth_saba_simp, data=cred_order)
summary(anovaD)
TukeyHSD(anovaD)

anovaD <- aov(rel_abd_diff ~ depth_saba_simp, data=cred_order)
summary(anovaD)
TukeyHSD(anovaD)

anovaD <- aov(abs(bottemp) ~ depth_saba_simp, data=cred_order)
summary(anovaD)
TukeyHSD(anovaD) #sig

anovaD <- aov(abs(AMOunsmyear) ~ depth_saba_simp, data=cred_order)
summary(anovaD)
TukeyHSD(anovaD)

anovaD <- aov(abs(avgdepth) ~ depth_saba_simp, data=cred_order)
summary(anovaD)
TukeyHSD(anovaD)

anovaD <- aov(abs(botsalin) ~ depth_saba_simp, data=cred_order)
summary(anovaD)
TukeyHSD(anovaD)

anovaD <- aov(abs(NAOyear) ~ depth_saba_simp, data=cred_order)
summary(anovaD)
TukeyHSD(anovaD)

anovaD <- aov(abs(SD3x3shortbt) ~ depth_saba_simp, data=cred_order)
summary(anovaD)
TukeyHSD(anovaD)

anovaD <- aov(abs(SD3x3shortsal) ~ depth_saba_simp, data=cred_order)
summary(anovaD)
TukeyHSD(anovaD)

anovaD <- aov(abs(SD3x3shortsst) ~ depth_saba_simp, data=cred_order)
summary(anovaD)
TukeyHSD(anovaD)

cred_sub$depth_profile_simp <- cred_order$depth_profile_simp
cred_sub$depth_profile <- cred_order$depth_profile
cred_sub$depth_saba <- cred_order$depth_saba
cred_sub$depth_saba_simp <- cred_order$depth_saba_simp

anovaD <- aov(abs(sub) ~ depth_saba_simp, data=cred_sub2)
summary(anovaD)
TukeyHSD(anovaD)

#okay so there is a significant difference between the pelagic and demersal species and distance shifted. as well as a significant distance between pelagic and demersal and strength of bottemp association as well as AMO, NAO and SD bt. Unofturnately, non significant difference with substrate or rugosity or depth.  
#maybe group into even smaller groups (pelagic vs demersal/benthic)

#this is the test that Saba et al used (this is non-parametric because data isnt normally distributed, but I have a largeish sample size so might be able use the ANOVA: 
#https://blog.minitab.com/blog/adventures-in-statistics-2/choosing-between-a-nonparametric-test-and-a-parametric-test)
#all the same things as above are significant 



kruskal.test(rel_abd_diff ~ depth_saba_simp, data=cred_order) 
kruskal.test(convex_diff ~ depth_saba_simp, data=cred_order)
kruskal.test(abd_diff ~ depth_saba_simp, data=cred_order)
kruskal.test(dist_shifted ~ depth_saba_simp, data=cred_order) #sig
kruskal.test(dist_shifted ~ factor(strong), data=cred_order) #.07
kruskal.test(dist_shifted ~ factor(strong_2), data=cred_order)
kruskal.test(dist_shifted ~ factor(strong_3), data=cred_order) 

kruskal.test(dist ~ depth_saba, data=cred_order) #sig
kruskal.test(dist ~ factor(strong), data=cred_order) #.07
kruskal.test(dist ~ factor(strong_2), data=cred_order)
kruskal.test(dist ~ factor(strong_3), data=cred_order) 


t.test(dist_shifted ~ factor(strong_3), alternative = "greater", data=cred_order)

t.test(dist_shifted ~ factor(depth_saba_simp), alternative = "less" , data=cred_order)



#then use this test to see which groups are different
pairwise.wilcox.test(cred_order$dist_shifted, cred_order$strong_3)
pairwise.wilcox.test(cred_order$dist_shifted, cred_order$strong_2)
pairwise.wilcox.test(cred_order$dist_shifted, cred_order$depth_saba_simp)
pairwise.wilcox.test(cred_order$convex_diff, cred_order$depth_saba_simp)
pairwise.wilcox.test(abs(cred_order$bottemp), cred_order$depth_saba_simp)
pairwise.wilcox.test(abs(cred_sub2$sub), cred_sub2$depth_saba_simp)

pairwise.wilcox.test(cred_order$dist, cred_order$strong_3)
pairwise.wilcox.test(cred_order$dist, cred_order$strong_2)
pairwise.wilcox.test(cred_order$dist, cred_order$depth_saba_simp)

#if unequal variances can run welch anova 
oneway.test(dist ~ depth_profile_simp, data=cred_order)
oneway.test(dist ~ strong_3, data=cred_order)

summary(gam(dist_shifted ~ depth_saba_simp, data=cred_order))
summary.aov(lm(dist_shifted ~ depth_saba_simp, data=cred_order))

summary(gam(dist_shifted ~ strong_2, data=cred_order))

summary(lm(convex_diff ~ depth_saba_simp, data=cred_order))

summary(lm(dist_shifted ~ strong_2, data=cred_order))
summary.aov(lm(dist_shifted ~ strong_2, data=cred_order))

summary(lm(abs(bottemp) ~ depth_saba_simp, data=cred_order))


#pelagic <- subset(cred_order, cred_order$depth_saba_simp=="pelagic")
#demersal <- subset(cred_order, cred_order$depth_saba_simp=="demersal")

#summary(lm(dist_shifted ~ bottemp, data=pelagic))

write.csv(cred_order, file="cred_order.csv")

ggplot(data=cred_order, aes(x=depth_profile_simp, y=dist, fill=depth_profile_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "distance shifted", x = "species type") + 
  theme_classic()

ggplot(data=cred_order, aes(x=depth_saba_simp, y=convex_diff, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "range difference", x = "species type")+ 
  theme_classic()

ggplot(data=cred_order, aes(x=strong_2, y=dist_shifted, fill=strong_2)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "distance shifted", x = "strongest variable")+ 
  theme_classic()

ggplot(data=cred_order, aes(x=depth_saba_simp, y=abs(bottemp), fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "strength of BT", x = "species type")+ 
  theme_classic()

ggplot(data=cred_sub2, aes(x=depth_saba_simp, y=abs(sub), fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "strength of substrate", x = "species type")+ 
  theme_classic()

ggplot(data=cred_order, aes(x=depth_saba_simp, y=strong_)) + geom_point()



ggplot(data=subset(cred_order, !is.na(strong_2)), aes(x= strong_2,  group=depth_saba_simp)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", x = "strongest variable", fill="strog_2") +
    facet_grid(~depth_saba_simp) +
    scale_y_continuous(labels = scales::percent) + theme(legend.position = "none") + 
  ggtheme_Plot()

ggsave("barplot.jpeg", plot = last_plot())

```
#glm results

```{r}
cred_order_glm <- cred_order %>% 
  dplyr:::select(names, dist_shifted, convex_diff, rel_abd_diff)

cred_order_glm <- left_join(cred_order_glm, tot_glm_stand)

spec_info <- read.csv("specnames_withinfo.csv")
cred_order_glm <- left_join(cred_order_glm, spec_info, by="names")

cred_glm_strong <- cred_order_glm[5:15] 
cred_glm_strong <- abs(cred_glm_strong)
cred_glm_strong$strong <- colnames(cred_glm_strong)[max.col(cred_glm_strong,ties.method="first")] 


######nope this doesnt work cause for some reason sst variability is alway sthe most important variable for each species. 
cred_order_glm$strong <- cred_glm_strong$strong

cred_order_glm$strong_2 <- ifelse(cred_order_glm$strong == "SEDTYPESilt/Mud" | cred_order_glm$strong == "SEDTYPESand", "substrate", ifelse(cred_order_glm$strong == "bottemp", "bottemp", ifelse(cred_order_glm$strong == "avgdepth", "depth", ifelse(cred_order_glm$strong == "SD3x3shortsal" | cred_order_glm$strong == "SD3x3shortsst" | cred_order_glm$strong == "SD3x3shortsst", "variability", ifelse(cred_order_glm$strong == "AMOunsmyear"| cred_order_glm$strong == "NAOyear", "climate", NA)))))


cred_order_glm$strong_3 <- ifelse(cred_order_glm$strong == "SEDTYPESilt/Mud" | cred_order_glm$strong == "SEDTYPESand", "substrate", ifelse(cred_order_glm$strong == "bottemp", "bottemp", NA))


summary(glm(dist_shifted ~ abs(avgdepth) + abs(bottemp) + abs(botsalin) + abs(AMO_unsm_year) + abs(NAO_year) + abs(`SED_TYPESilt/Mud`) + abs(SED_TYPESand) + abs(SD3x3shortsal) + abs(SD3x3shortbt) + abs(SD3x3shortsst) + abs(gebco_SD_2), data=cred_order_glm)) #this would be awesome if it was significant 

summary(glm(convex_diff ~ abs(avgdepth) + abs(bottemp) + abs(botsalin) + abs(AMO_unsm_year) + abs(NAO_year) + abs(`SED_TYPESilt/Mud`) + abs(SED_TYPESand) + abs(SD3x3shortsal) + abs(SD3x3shortbt) + abs(SD3x3shortsst) + abs(gebco_SD_2), data=cred_order_glm))



anovaD <- aov(dist_shifted ~ depth_saba_simp, data=cred_order_glm)
summary(anovaD) #sig
TukeyHSD(anovaD)

anovaD <- aov(dist_shifted ~ strong_2, data=cred_order_glm)
summary(anovaD) #sig
TukeyHSD(anovaD)

anovaD <- aov(dist_shifted ~ strong_3, data=cred_order_glm)
summary(anovaD) #sig
TukeyHSD(anovaD)

anovaD <- aov(convex_diff ~ depth_saba_simp, data=cred_order_glm)
summary(anovaD)
TukeyHSD(anovaD) #sig

#rf
cred_rf <- cred_tot_sig_comb %>% 
  dplyr:::select(names, dist_shifted, convex_diff, rel_abd_diff, abd_diff)

cred_order_rf <- left_join(cred_rf, tot_rf_results)

spec_info <- read.csv("specnames_withinfo.csv")
cred_order_rf <- left_join(cred_order_rf, spec_info, by="names")

summary(glm(dist_shifted ~ abs(avgdepth) + abs(bottemp) + abs(botsalin) + abs(AMO_unsm_year) + abs(NAO_year) + abs(SED_TYPE) + abs(SD3x3shortsal) + abs(SD3x3shortbt) + abs(SD3x3shortsst) + abs(gebco_SD_2), data=cred_order_rf))


ggplot(cred_order_rf, aes(x=SED_TYPE, y=dist_shifted))+
  geom_point()
#this would be awesome if it was significant 


```

#results 

```{r}
#this is all of the data we would need only looking at species that are present in at least 6 months in both time periods! Got significance!!! Currently emailing Jim to make sure that I can compare factors with covariates 
supp <- read.csv("supplemental_table.csv")
supp$dist <- as.numeric(as.character(supp$dist))
supp$Months_1 <- as.numeric(supp$Months_1)
supp$Months_2 <- as.numeric(supp$Months_2)

supp <- subset(supp, supp$Months_1>5 & supp$Months_2>5)

oneway.test(as.numeric(dist) ~ depth_profile_simp, data=supp)
oneway.test(as.numeric(dist) ~ strong_3, data=supp)

pairwise.wilcox.test(as.numeric(supp$dist), supp$depth_profile_simp)
pairwise.wilcox.test(as.numeric(supp$convex_diff), supp$depth_profile_simp)
pairwise.wilcox.test(abs(supp$Bottom.Temperature), supp$depth_profile_simp)
pairwise.wilcox.test(as.numeric(supp$dist), supp$strong_3)
pairwise.wilcox.test(as.numeric(supp$dist), supp$strong_2, p.adjust.method = "BH")
pairwise.wilcox.test(as.numeric(abs(supp$Bottom.Temperature)), supp$depth_profile_simp)


kruskal.test(dist ~ depth_profile_simp, data=supp)
kruskal.test(dist ~ strong_3, data=supp)
kruskal.test(dist ~ strong_2, data=supp)

kruskal.test(convex_diff ~ depth_profile_simp, data=supp)

summary(gam(as.numeric(supp$dist) ~ supp$strong_2))

#figures 
ggplot(data=supp, aes(x=depth_profile_simp, y=abs(Bottom.Temperature), fill=depth_profile_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "bottom temperature (strength)", x = "species type") + 
  theme_classic()
  ggsave("depth_bt.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)
  
ggplot(data=supp, aes(x=depth_profile_simp, y=dist, fill=depth_profile_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "distance shifted", x = "species type") + 
  theme_classic()
  ggsave("depth_dist.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)
  
ggplot(data=supp, aes(x=depth_profile_simp, y=convex_diff, fill=depth_profile_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show.legend = FALSE) +
    labs(y = "range difference", x = "species type")+ 
  theme_classic()
  ggsave("depth_range.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)

ggplot(data=supp, aes(x=strong_2, y=dist, fill=strong_2)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "distance shifted", x = "strongest variable")+ 
  theme_classic()
  ggsave("dist_strong.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)

#boxplot 
ggplot(data=subset(supp, !is.na(strong_2)), aes(x= strong_2,  group=depth_profile_simp)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", x = "strongest variable", fill="strog_2") +
    facet_grid(~depth_profile_simp) +
    scale_y_continuous(labels = scales::percent) + theme(legend.position = "none") + 
    ggtheme_Plot()
  ggsave("barplot.jpg", plot=last_plot(), width = 12, height=6, units=c("in"), dpi=500)

#just substrate 
cred_sub1 <- supp %>% 
  dplyr:::select(names, Silt.Mud, dist, convex_diff, depth_profile_simp, depth_saba_simp)
cred_sub1$sub <- cred_sub1$Silt.Mud

cred_sub <- supp %>% 
  dplyr:::select(names, Sand, dist, convex_diff, depth_profile_simp, depth_saba_simp)
cred_sub$sub <- cred_sub$Sand
cred_sub$names <- paste(cred_sub$names, "2", sep="")


cred_sub2 <- smartbind(cred_sub1, cred_sub)

pairwise.wilcox.test(as.numeric(abs(cred_sub2$sub)), cred_sub2$depth_profile_simp)
#not significant 

#table 
supp_table <- read.csv("supplemental_table.csv")
supp_table$Months_1 <- as.numeric(supp_table$Months_1)
supp_table$Months_2 <- as.numeric(supp_table$Months_2)

supp_table <- subset(supp_table, supp_table$Months_1>5 & supp_table$Months_2>5)

supp_simp <- supp_table %>% dplyr::select(Scientific.name, Common.Name, convex_diff, depth_profile, strong_2, dist, Months_1, Months_2, rmse, r2, MAE)
write.csv(supp_simp, file="supplemental_simple.csv")
```

#dev results...
##significant difference between deviance explained for bt and substrate between pelagic and demersal. 
```{r}
supp_1 <- read.csv("supplemental_table.csv")
tot_gam_dev3$strong <- colnames(tot_gam_dev2[2:9])[apply(tot_gam_dev2[2:9],1,which.max)]

tot_gam_dev2 <- tot_gam_dev2 %>% dplyr::select(-dev.sbfdesed)
tot_gam_dev2$strong <- colnames(tot_gam_dev2[2:10])[apply(tot_gam_dev2[2:10],1,which.max)]

tot_gam_dev$strong <- colnames(tot_gam_dev[2:7])[apply(tot_gam_dev[2:7],1,which.max)]

tot_gam_log <- tot_gam_log[2:70,]

tot_gam_log$strong <- colnames(tot_gam_log[2:7])[apply(tot_gam_log[2:7],1,which.max)]

##this is significant and works!
dist <- supp_3 %>% dplyr::select(names, dist, depth_saba_simp, depth_profile_simp)
supp_2 <- left_join(tot_gam_dev3, dist,  by="names")

supp_2$strong.y.2 <- ifelse(supp_2$strong == "dev.sed", "substrate", ifelse(supp_2$strong == "dev.bt", "bottemp", ifelse(supp_2$strong == "dev.depth", "depth", ifelse(supp_2$strong == "dev.sdbt" | supp_2$strong == "dev.sdsal", "sal variability", ifelse(supp_2$strong == "dev.AMO", "climate", ifelse(supp_2$strong == "dev.sal", "salinity", NA))))))

supp_2$strong.y.3 <- ifelse(supp_2$strong.y.2 =="substrate", "bottom habitat", ifelse(supp_2$strong.y.2 == "bottemp" | supp_2$strong.y.2 == "salinity" | supp_2$strong.y.2 == "variability", "oceanography", supp_2$strong.y.2))

supp_2$strong.y.4 <- ifelse(supp_2$strong.y =="dev.sed", "sediment", ifelse(supp_2$strong.y == "dev.bt", "bottom temperature", NA))

#paralepidad is actually pelagic and lobster is demersal 
supp_2[2,20]<- "pelagic"
supp_2[14,20]<- "demersal"
supp_2[64,20]<- "demersal"

pairwise.wilcox.test(as.numeric(supp_2$dist), supp_2$depth_profile_simp)
pairwise.wilcox.test(as.numeric(supp_2$convex_diff), supp_2$depth_profile_simp)
pairwise.wilcox.test(supp_2$dev.bt, supp_2$depth_profile_simp)
pairwise.wilcox.test(supp_2$dev.sed, supp_2$depth_profile_simp)

pairwise.wilcox.test(as.numeric(supp_2$dist), supp_2$strong.y.2)
pairwise.wilcox.test(as.numeric(supp_2$dist), supp_2$strong.y.3)
pairwise.wilcox.test(as.numeric(supp_2$dist), supp_2$strong.y.4)

pairwise.wilcox.test(as.numeric(supp_2$convex_diff), supp_2$strong.y.3)
pairwise.wilcox.test(as.numeric(supp_2$convex_diff), supp_2$strong.y.2)

#neither of these is significant which stinks 



#deviance explained versus distance shifted (all of these are negative for dist, but variation for convex diff). Nothing interesting is significant if all negative 
summary(lm(supp_2$dist ~ supp_2$dev.bt))
plot(supp_2$dev.bt, supp_2$dist)
abline(lm(supp_2$dist ~ supp_2$dev.bt))

summary(lm(supp_2$convex_diff ~ supp_2$dev.sed))
plot(supp_2$dev.sed, supp_2$convex_diff)
abline(lm(supp_2$convex_diff ~ supp_2$dev.sed))

summary(lm(supp_2$convex_diff ~ supp_2$dev.bt))
plot(supp_2$dev.bt, supp_2$convex_diff)
abline(lm(supp_2$convex_diff ~ supp_2$dev.bt))

summary(lm(supp_2$dist ~ supp_2$dev.sal))
plot(supp_2$dev.sal, supp_2$dist)
abline(lm(supp_2$dist ~ supp_2$dev.sal))

summary(lm(supp_2$dist ~ supp_2$dev.depth))
plot(supp_2$dev.depth, supp_2$dist)
abline(lm(supp_2$dist ~ supp_2$dev.depth))

summary(lm(supp_2$dist ~ supp_2$dev.AMO))
plot(supp_2$dev.AMO, supp_2$dist)
abline(lm(supp_2$dist ~ supp_2$dev.AMO))

summary(lm(supp_2$dist ~ supp_2$dev.NAO))
plot(supp_2$dev.NAO, supp_2$dist)
abline(lm(supp_2$dist ~ supp_2$dev.NAO))

summary(lm(supp_2$dist ~ supp_2$dev.sdsal))
plot(supp_2$dev.sdsal, supp_2$dist)
abline(lm(supp_2$dist ~ supp_2$dev.sdsal))

summary(lm(supp_2$dist ~ supp_2$dev.sdsst))
plot(supp_2$dev.sdsst, supp_2$dist)
abline(lm(supp_2$dist ~ supp_2$dev.sdsst))

summary(lm(supp_2$dist ~ supp_2$dev.sdbt))
plot(supp_2$dev.sdbt, supp_2$dist)
abline(lm(supp_2$dist ~ supp_2$dev.sdbt))

summary(lm(supp_2$dist ~ supp_2$dev.sed)) #*
plot(supp_2$dev.sed, supp_2$dist)
abline(lm(supp_2$dist ~ supp_2$dev.sed))


pairwise.wilcox.test(as.numeric(supp_2$dist), supp_2$strong.y.3, p.adjust.method = "BH")
pairwise.wilcox.test(as.numeric(supp_2$convex_diff), supp_2$strong.y.2, p.adjust.method = "BH")
# pairwise.wilcox.test(as.numeric(supp_2$dev.geb), supp$depth_profile_simp)
# pairwise.wilcox.test(as.numeric(supp_2$dev.sed), supp$depth_profile_simp)
# pairwise.wilcox.test(as.numeric(supp_2$dev.bt), supp$depth_profile_simp)
# pairwise.wilcox.test(as.numeric(supp_2$dev.sal), supp$depth_profile_simp) #*
# pairwise.wilcox.test(as.numeric(supp_2$dev.depth), supp$depth_profile_simp) #*
# pairwise.wilcox.test(as.numeric(supp_2$dev.AMO), supp$depth_profile_simp) #* 
# pairwise.wilcox.test(as.numeric(supp_2$dev.NAO), supp$depth_profile_simp)

#actually the deviance explained by all variables is always more for demersal probably because there are more of those species. 

ggplot(data=supp_2, aes(x= strong.y.2,  group=depth_saba_simp)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", x = "strongest variable", fill="strog_2") +
    facet_grid(~depth_saba_simp) +
    scale_y_continuous(labels = scales::percent) + theme(legend.position = "none") + 
    ggtheme_Plot() + 
  ggsave("barplot_gam.jpg", plot=last_plot(), width = 12, height=6, units=c("in"), dpi=500)

ggplot(data=supp_2, aes(x=strong.y.2, y=dist, fill=strong.y.2)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "distance shifted", x = "strongest variable")+ 
  theme_classic()

ggplot(data=supp_2, aes(x=depth_profile_simp, y=dist, fill=depth_profile_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "distance shifted", x = "strongest variable")+ 
  theme_classic()

ggplot(data=supp_2, aes(x=depth_profile_simp, y=dev.sed, fill=depth_profile_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "substrate dev explained", x = "species")+ 
  theme_classic()

ggplot(data=supp_2, aes(x=depth_profile_simp, y=dev.bt, fill=depth_profile_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "bt dev explained", x = "species")+ 
  theme_classic()

summary(aov(supp_2$dev.sbfdesed ~ supp_2$depth_saba_simp))
summary(aov(supp_2$dev.bt~ supp_2$depth_saba_simp))


#lets try taking out depth as 
tot_gam_dev2 <- tot_gam_dev2 %>% dplyr::select(-dev.depth)

tot_gam_dev2$strong <- colnames(tot_gam_dev2[2:9])[apply(tot_gam_dev2[2:9],1,which.max)]


```
#gam_drop_results 

```{r}

dist_info <- supp %>% dplyr::select(dist, convex_diff, names, depth_profile_simp, depth_saba_simp)

gam_supp <- left_join(tot_gam_drop_f, dist_info, by="names")


#paralepidad is actually pelagic and lobster is demersal 
gam_supp[2,15]<- "pelagic"
gam_supp[14,15]<- "demersal"
gam_supp[64,15]<- "demersal"

#make new columns for combining strongest variables 

gam_supp$strong.dev.2 <- ifelse(gam_supp$strong == "SEDIMENT" | gam_supp$strong == "SBFDESED", "substrate", ifelse(gam_supp$strong == "bottemp", "bottemp", ifelse(gam_supp$strong == "avgdepth", "depth", ifelse(gam_supp$strong == "SD3x3shortbt" | gam_supp$strong == "SD3x3shortsal"| gam_supp$strong == "SD3x3shortsst", "variability", ifelse(gam_supp$strong == "botsalin", "salinity", ifelse(gam_supp$strong == "AMO_unsm_year", "climate", NA))))))


pairwise.wilcox.test(as.numeric(gam_supp$dist), gam_supp$depth_profile_simp)
pairwise.wilcox.test(as.numeric(gam_supp$dist), gam_supp$strong.dev.2)


ggplot(data=gam_supp, aes(x= strong.dev.2,  group=depth_profile_simp)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", x = "strongest variable", fill="strog_2") +
    facet_grid(~depth_profile_simp) +
    scale_y_continuous(labels = scales::percent) + theme(legend.position = "none") + 
    ggtheme_Plot()  
  #ggsave("barplot_gam.jpg", plot=last_plot(), width = 12, height=6, units=c("in"), dpi=500)

ggplot(data=gam_supp, aes(x=strong.dev.2, y=as.numeric(dist), fill=strong.dev.2)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "distance shifted", x = "strongest variable")+ 
  theme_classic()

```


#glm results **sig   

```{r}
supp_1 <- read.csv("supplemental_table.csv")

dist_info <- supp %>% dplyr::select(dist, convex_diff, names, depth_profile_simp, depth_saba_simp)

glm_supp <- left_join(glm_drop_dev, dist_info, by="names")


#paralepidad is actually pelagic and lobster is demersal 
glm_supp[2,15]<- "demersal"
glm_supp[14,15]<- "demersal"
glm_supp[64,15]<- "demersal"

#make new columns for combining strongest variables 

glm_supp$strong.dev <- ifelse(glm_supp$strong == "SEDIMENT", "substrate", ifelse(glm_supp$strong == "bottemp", "bottemp", ifelse(glm_supp$strong == "avgdepth", "depth", ifelse(glm_supp$strong == "SD3x3shortbt" | glm_supp$strong == "SD3x3shortsal"| glm_supp$strong == "SD3x3shortsst", "variability", ifelse(glm_supp$strong == "botsalin", "salinity", NA)))))

glm_supp$strong.dev.2 <- ifelse(glm_supp$strong.x == "SEDIMENT", "substrate", ifelse(glm_supp$strong.x == "bottemp", "bottemp", ifelse(glm_supp$strong.x == "avgdepth", "depth", ifelse(glm_supp$strong.x == "SD3x3shortbt" | glm_supp$strong.x == "SD3x3shortsal"| glm_supp$strong.x == "SD3x3shortsst", "variability", ifelse(glm_supp$strong.x == "botsalin", "salinity", NA)))))


pairwise.wilcox.test(as.numeric(glm_supp$dist), glm_supp$depth_profile_simp)
pairwise.wilcox.test(as.numeric(glm_supp$dist), glm_supp$strong.AIC.2)
pairwise.wilcox.test(as.numeric(glm_supp$dist), glm_supp$strong.dev)


ggplot(data=glm_supp, aes(x= strong.dev,  group=depth_saba_simp)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", x = "strongest variable", fill="strog_2") +
    facet_grid(~depth_saba_simp) +
    scale_y_continuous(labels = scales::percent) + theme(legend.position = "none") + 
    ggtheme_Plot()  
  #ggsave("barplot_gam.jpg", plot=last_plot(), width = 12, height=6, units=c("in"), dpi=500)

ggplot(data=glm_supp, aes(x=strong.dev, y=as.numeric(dist), fill=strong.dev)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "distance shifted", x = "strongest variable")+ 
  theme_classic()

ggplot(data=glm_supp, aes(x=strong.dev.2, y=as.numeric(dist), fill=strong.dev.2)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "distance shifted", x = "strongest variable")+ 
  theme_classic()

```

#rf results...
##no real signficance and can't compare variable importance accross species (except for which is most important which doesnt really show much )
```{r}

dist_info <- supp_1 %>% dplyr::select(dist, convex_diff, names, depth_profile_simp, depth_saba_simp)

rf_supp <- left_join(tot_rf_results, dist_info, by="names")


#paralepidad is actually pelagic and lobster is demersal 
rf_supp[2,16]<- "pelagic"
rf_supp[14,16]<- "demersal"
rf_supp[64,16]<- "demersal"

#make new columns for combining strongest variables 

rf_supp$strong.2 <- ifelse(rf_supp$strong == "SEDIMENT"| rf_supp$strong =="gebco_SD_2" | rf_supp$strong =="SBFDEPTH", "substrate", ifelse(rf_supp$strong == "bottemp", "bottemp", ifelse(rf_supp$strong == "avgdepth", "depth", ifelse(rf_supp$strong == "SD3x3shortbt" | rf_supp$strong == "SD3x3shortsal"| rf_supp$strong == "SD3x3shortsst", "variability", ifelse(rf_supp$strong == "botsalin", "salinity", NA)))))

rf_supp$strong.dev.2 <- ifelse(rf_supp$strong.x == "SEDIMENT", "substrate", ifelse(rf_supp$strong.x == "bottemp", "bottemp", ifelse(rf_supp$strong.x == "avgdepth", "depth", ifelse(rf_supp$strong.x == "SD3x3shortbt" | rf_supp$strong.x == "SD3x3shortsal"| rf_supp$strong.x == "SD3x3shortsst", "variability", ifelse(rf_supp$strong.x == "botsalin", "salinity", NA)))))


pairwise.wilcox.test(as.numeric(rf_supp$dist), rf_supp$depth_saba_simp)
pairwise.wilcox.test(as.numeric(rf_supp$dist), rf_supp$strong.2)
pairwise.wilcox.test(as.numeric(rf_supp$dist), rf_supp$strong.dev.2)


ggplot(data=rf_supp, aes(x= strong.2,  group=depth_profile_simp)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", x = "strongest variable", fill="strog_2") +
    facet_grid(~depth_profile_simp) +
    scale_y_continuous(labels = scales::percent) + theme(legend.position = "none") + 
    ggtheme_Plot()  
  #ggsave("barplot_gam.jpg", plot=last_plot(), width = 12, height=6, units=c("in"), dpi=500)

ggplot(data=rf_supp, aes(x=strong.AIC.2, y=as.numeric(dist), fill=strong.AIC.2)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "distance shifted", x = "strongest variable")+ 
  theme_classic()

ggplot(data=rf_supp, aes(x=strong.dev.2, y=as.numeric(dist), fill=strong.dev.2)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "distance shifted", x = "strongest variable")+ 
  theme_classic()

```

#results with more species - this is good!!!
```{r}
total_by_m <- read.csv("~/Documents/ClimateOceanPlanning/R/NEFSC_GJAMM_GIT/total_months.csv")
#in at least 100 tows and present in 3 or more months 

tot_m_3 <- subset(tot_by_m, tot_by_m$months.x>2 & tot_by_m$months.y>2)
specnames <- as.vector(tot_m_3$scientific_name)#257 

ycommon_all <- as.data.frame(ycommon_2)
ycommon_all$two <- 1
ycommon_1 <- as.data.frame(ycommon_1)
ycommon_1$one <-1
ycommon_all <- left_join(ycommon_all, ycommon_1, by =c("ycommon_2"= "ycommon_1"))

specnames <- as.data.frame(specnames)
ycommon_all <- left_join(ycommon_all, tot_m_3, by =c("ycommon_2"= "scientific_name"))


selected <- subset(ycommon_all, ycommon_all$one ==1 & ycommon_all$two ==1 & ycommon_all$months.x >1 )


specnames <- as.vector(selected$ycommon_2)#115

#remove unidentified fish 
specnames <- subset(specnames, specnames!="UNIDENTIFIED.FISH")


#running a negative binomial glm 

# create data frame to store results
tot_glm_log <- data.frame()
tot_glm_dev <- data.frame(matrix(ncol=7, nrow=1))
colnames(tot_glm_dev) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed")
tot_glm_log <- data.frame(matrix(ncol=7, nrow=1))
colnames(tot_glm_log) <- c("names", "log.depth", "log.bt", "log.sal", "log.AMO", "log.NAO", "log.sed")


for (i in 1:length(specnames)) { #for each species in spec_list
  #fit <- gam(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SEDIMENT + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)
#standardized <- lm.beta(fit)
  tryCatch({
        fit_depth <- glm.nb(as.formula(paste(specnames[i],"~ 1+ avgdepth")), data=total)
            fit_bt <- glm.nb(as.formula(paste(specnames[i],"~ 1 + bottemp")), data=total)
           fit_sal <- glm.nb(as.formula(paste(specnames[i],"~ 1 +  botsalin")), data=total)
           fit_AMO <- glm.nb(as.formula(paste(specnames[i],"~ 1 + AMO_unsm_year")), data=total)
           fit_NAO <- glm.nb(as.formula(paste(specnames[i],"~1 + NAO_year")), data=total)   
         fit_sed <- glm.nb(as.formula(paste(specnames[i],"~ 1 + SEDIMENT")), data=total)
         #fit_sdsal <- glm.nb(as.formula(paste(specnames[i],"~ 1 + SD3x3shortsal")), data=total)
         #fit_sdbt <- glm.nb(as.formula(paste(specnames[i],"~ 1 + SD3x3shortbt")), data=total) 
          #fit_sdsst <- glm.nb(as.formula(paste(specnames[i],"~ 1 + SD3x3shortsst")), maxit = 1000, data=total)
       # fit_geb <- glm.nb(as.formula(paste(specnames[i],"~ 1 + gebco_SD_2")), data=total)
        dev.depth<- 1-(fit_depth$deviance/fit_depth$null.deviance)
        dev.bt<- 1-(fit_bt$deviance/fit_bt$null.deviance)
        dev.sal <- 1-(fit_sal$deviance/fit_sal$null.deviance)
        dev.AMO <- 1-(fit_AMO$deviance/fit_AMO$null.deviance)
        dev.NAO <- 1-(fit_NAO$deviance/fit_NAO$null.deviance)
        dev.sed <- 1-(fit_sed$deviance/fit_sed$null.deviance)
        #dev.sdsal <- fit_sdsal$deviance
        #dev.sdbt <- fit_sdbt$deviance
      #  dev.geb <- fit_geb$deviance
        
       log.depth <- logLik(fit_depth)
        log.bt <- logLik(fit_bt)
        log.sal <- logLik(fit_sal)
        log.AMO <- logLik(fit_AMO)
        log.NAO <- logLik(fit_NAO)
        log.sed <- logLik(fit_sed)
        #log.sdsal <- logLik(fit_sdsal)
        #log.sdbt <- logLik(fit_sdbt)
       # log.geb <- logLik(fit_geb)
        
        dev_table <- list("null", dev.depth, dev.bt, dev.sal, dev.AMO, dev.NAO, dev.sed)
        dev_table <- as.data.frame(dev_table)
        colnames(dev_table) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed")
        dev_table$names <- specnames[i]
        
        tot_glm_dev <- rbind(tot_glm_dev, dev_table)
        
        log_table <- list("null", log.depth, log.bt, log.sal, log.AMO, log.NAO, log.sed)
        log_table <- as.data.frame(log_table)
        colnames(log_table) <- c("names", "log.depth", "log.bt", "log.sal", "log.AMO", "log.NAO", "log.sed")
        log_table$names <- specnames[i]
        tot_glm_log <- rbind(tot_glm_log, log_table)
    }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
        # get coefficents of fit
        #summary_model <- summary(fit)
        #p <- summary_model$p.table
        
        
        #cfit <- fit$coefficients
        #cfit <- as.data.frame(cfit)
        #cfit$names <- paste(specnames[i], rownames(cfit), sep="+")
        #cfit$AIC <- AIC(fit)
        #cfit$Deviance <- dev_table
        #cfit$p_value <- p[,4]
  
       
       # tot_gam_results <- rbind(tot_gam_results, cfit)
        #tot_gam_stand <- rbind(tot_gam_stand, sfit)
} 
tot_glm_dev <- tot_glm_dev[2:91,]

tot_glm_dev$strong <- colnames(tot_glm_dev[2:7])[apply(tot_glm_dev[2:7],1,which.max)]

#loading the specnames info 
specnames_info <- read.csv("specnames_159.csv")
specnames_info <- specnames_info[,1:7]
dist_info <- dist_total[,1:2] 


specinfo <- left_join(specnames_info, dist_info, by=c("names"="specnames"))

glm_supp <- left_join(tot_glm_dev, specinfo, by=c("names"))

glm_supp$dist <- glm_supp$`distGeo(spec_coords_1[2:3], spec_coords_2[2:3])`

glm_supp$strong.dev.2 <- ifelse(glm_supp$strong == "dev.sed", "substrate", ifelse(glm_supp$strong == "dev.bt", "bottemp", ifelse(glm_supp$strong == "dev.depth", "depth", ifelse(glm_supp$strong == "dev.AMO" | glm_supp$strong == "dev.NAO", "climate", ifelse(glm_supp$strong == "dev.sal", "salinity", NA)))))


pairwise.wilcox.test(as.numeric(glm_supp$dist), glm_supp$depth_saba_simp)
pairwise.wilcox.test(as.numeric(glm_supp$dist), glm_supp$strong.dev.2)
pairwise.wilcox.test(as.numeric(glm_supp$dev.bt), glm_supp$depth_saba_simp)
pairwise.wilcox.test(as.numeric(glm_supp$dev.sed), glm_supp$depth_saba_simp)



ggplot(data=glm_supp, aes(x= strong.dev.2,  group=depth_saba_simp)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", x = "strongest variable", fill="strog_2") +
    facet_grid(~depth_saba_simp) +
    scale_y_continuous(labels = scales::percent) + theme(legend.position = "none") + 
    ggtheme_Plot()  
  #ggsave("barplot_gam.jpg", plot=last_plot(), width = 12, height=6, units=c("in"), dpi=500)

library(reshape2)
library(ggpubr)

dat.m <- melt(glm_supp,id.vars='names', measure.vars=c('dev.bt','dev.sed','dev.depth', 'dev.AMO', 'dev.NAO', 'dev.sal'))
data.m <- left_join(specinfo, dat.m, by=c("names"))
data.m <- as.data.frame(data.m)
ggbarplot(data.m, x="variable", y="value", add="mean", facet.by = "depth_saba_simp")
#this sort of shows what I want, but mostly that pelagic species are explained by a couple of things wherease demersal are explained mainly by substrate. 

ggplot(data=glm_supp, aes(x=strong.dev.2, y=as.numeric(dist), fill=strong.dev.2)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "distance shifted", x = "strongest variable")+ 
  theme_classic()


ggplot(data=glm_supp, aes(x=depth_saba_simp, y=dev.bt, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "bottom temperature (strength)", x = "species type") + 
  theme_classic()

ggplot(data=glm_supp, aes(x=depth_saba_simp, y=dev.sed, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "bottom temperature (strength)", x = "species type") + 
  theme_classic()

ggplot(data.m, aes(x=dist, y=value)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) + facet_grid(~variable)


#I ran the same as above but with variability included and everything had variability as the strongest variabe. 

#running the same process but with GAM 
# create data frame to store results
tot_gam_results <- data.frame()
tot_gam_stand <- data.frame()
tot_gam_dev_more <- data.frame(matrix(ncol=11, nrow=1))
colnames(tot_gam_dev_more) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.geb")

for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- gam(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)
#standardized <- lm.beta(fit)
    tryCatch({
        fit_depth <- gam(as.formula(paste(specnames[i],"~ 1 +avgdepth")), data=total, family=nb(link="log"))
          fit_bt <- gam(as.formula(paste(specnames[i],"~ bottemp")), data=total, family=nb(link="log"))
           fit_sal <- gam(as.formula(paste(specnames[i],"~ botsalin")), data=total, family=nb(link="log"))
           fit_AMO <- gam(as.formula(paste(specnames[i],"~ AMO_unsm_year")), data=total, family=nb(link="log"))
           fit_NAO <- gam(as.formula(paste(specnames[i],"~ NAO_year")), data=total, family=nb(link="log"))   
         fit_sed <- gam(as.formula(paste(specnames[i],"~ SEDIMENT")), data=total, family=nb(link="log"))
         fit_sdsal <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsal")), data=total, family=nb(link="log"))
         fit_sdbt <- gam(as.formula(paste(specnames[i],"~ SD3x3shortbt")), data=total, family=nb(link="log")) 
          fit_sdsst <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsst")), data=total, family=nb(link="log"))
        fit_geb <- gam(as.formula(paste(specnames[i],"~ gebco_SD_2")), data=total, family=nb(link="log"))
        dev.depth <- summary(fit_depth)$dev.expl
        dev.bt <- summary(fit_bt)$dev.expl
        dev.sal <- summary(fit_sal)$dev.expl
        dev.AMO <- summary(fit_AMO)$dev.expl
        dev.NAO <- summary(fit_NAO)$dev.expl
        dev.sed <- summary(fit_sed)$dev.expl
        dev.sdsal <- summary(fit_sdsal)$dev.expl
        dev.sdbt <- summary(fit_sdbt)$dev.expl
        dev.sdsst <- summary(fit_sdsst)$dev.expl
        dev.geb <- summary(fit_geb)$dev.expl
        
        dev_table <- list("null", dev.depth, dev.bt, dev.sal, dev.AMO, dev.NAO, dev.sed, dev.sdsal, dev.sdbt, dev.sdsst, dev.geb)
        dev_table <- as.data.frame(dev_table)
        colnames(dev_table) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.geb")
        dev_table$names <- specnames[i]
        
        tot_gam_dev_more <- rbind(tot_gam_dev_more, dev_table)
    }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
        # get coefficents of fit
        #summary_model <- summary(fit)
        #p <- summary_model$p.table
        
        
        #cfit <- fit$coefficients
        #cfit <- as.data.frame(cfit)
        #cfit$names <- paste(specnames[i], rownames(cfit), sep="+")
        #cfit$AIC <- AIC(fit)
        #cfit$Deviance <- dev_table
        #cfit$p_value <- p[,4]
  
       
       # tot_gam_results <- rbind(tot_gam_results, cfit)
        #tot_gam_stand <- rbind(tot_gam_stand, sfit)
} 

tot_gam_dev_more <- tot_gam_dev_more[2:116,]

tot_gam_dev_more$strong <- colnames(tot_gam_dev_more[2:10])[apply(tot_gam_dev_more[2:10],1,which.max)]
tot_gam_dev_more$strong <- colnames(tot_gam_dev_more[2:7])[apply(tot_gam_dev_more[2:7],1,which.max)]

#loading the specnames info 
specnames_info <- read.csv("specnames_159.csv")
specnames_info <- specnames_info[,1:7]
dist_info <- dist_total[,1:2] 

#convex info 
convex_1 <- read.csv("spechull/homerange_1.csv")
convex_2 <- read.csv("spechull/homerange_2.csv")
convex_1 <- convex_1 %>% dplyr::select(names, area, EXT_MIN_Y, EXT_MAX_Y)
convex_2 <- convex_2 %>% dplyr::select(names, area, EXT_MIN_Y, EXT_MAX_Y)
colnames(convex_1) <- c("names", "area_1", "min_y_1", "max_y_1")
colnames(convex_2) <- c("names", "area_2", "min_y_2", "max_y_2")



convex <- merge(convex_2, convex_1, by="names")
convex$area_diff <- convex$area_2 - convex$area_1
convex$min_diff <- convex$min_y_2 - convex$min_y_1
convex$max_diff <- convex$max_y_2 - convex$max_y_1



specinfo <- left_join(specnames_info, dist_info, by=c("names"="specnames"))
specinfo <- left_join(specinfo, convex, by="names")
specinfo$dist <- specinfo$`distGeo(spec_coords_1[2:3], spec_coords_2[2:3])`
gam_supp <- left_join(tot_gam_dev_more, specinfo, by=c("names"))

gam_supp$dist <- gam_supp$`distGeo(spec_coords_1[2:3], spec_coords_2[2:3])`

gam_supp$strong.dev.2 <- ifelse(gam_supp$strong == "dev.sed", "substrate", ifelse(gam_supp$strong == "dev.bt", "bottemp", ifelse(gam_supp$strong == "dev.depth", "depth", ifelse(gam_supp$strong == "dev.AMO" | gam_supp$strong == "dev.NAO", "climate", ifelse(gam_supp$strong == "dev.sal", "salinity", ifelse(gam_supp$strong == "dev.sdsal" | gam_supp$strong == "dev.sdbt" | gam_supp$strong == "dev.sdsst", "variability", NA))))))

gam_supp$strong.dev.3 <- ifelse(gam_supp$strong.dev.2 == "substrate", "substrate", ifelse(gam_supp$strong.dev.2 == "bottemp", "bottemp", NA))

pairwise.wilcox.test(as.numeric(gam_supp$dist), gam_supp$depth_saba_simp)
pairwise.wilcox.test(as.numeric(gam_supp$area_diff), gam_supp$depth_saba_simp)
pairwise.wilcox.test(as.numeric(gam_supp$dist), gam_supp$strong.dev.2)
pairwise.wilcox.test(as.numeric(gam_supp$dist), gam_supp$strong.dev.3)
pairwise.wilcox.test(as.numeric(gam_supp$area_diff), gam_supp$strong.dev.2)
pairwise.wilcox.test(as.numeric(gam_supp$dev.bt), gam_supp$depth_saba_simp) #*
pairwise.wilcox.test(as.numeric(gam_supp$dev.sed), gam_supp$depth_saba_simp) #*
pairwise.wilcox.test(as.numeric(gam_supp$dev.depth), gam_supp$depth_saba_simp)
pairwise.wilcox.test(as.numeric(gam_supp$dev.AMO), gam_supp$depth_saba_simp)# * 
pairwise.wilcox.test(as.numeric(gam_supp$dev.NAO), gam_supp$depth_saba_simp)
pairwise.wilcox.test(as.numeric(gam_supp$dev.sal), gam_supp$depth_saba_simp)
pairwise.wilcox.test(as.numeric(gam_supp$dev.sdsal), gam_supp$depth_saba_simp)
pairwise.wilcox.test(as.numeric(gam_supp$dev.sdbt), gam_supp$depth_saba_simp)
pairwise.wilcox.test(as.numeric(gam_supp$dev.sdsst), gam_supp$depth_saba_simp)



library(ggsci)
cbbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#D55E00", "#0072B2", "#CC79A7")
ggplot(data=gam_supp, aes(x= strong.dev.2,  group=depth_saba_simp)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", x = "strongest variable", fill="strog_2") +
    facet_wrap(~depth_saba_simp) +
    scale_y_continuous(labels = scales::percent) + theme(legend.position = "none") + 
  scale_fill_manual(values=cbbPalette) + 
    ggtheme_Plot()  
  ggsave("barplot_gam_more.jpg", plot=last_plot(), width = 20, height=8, units=c("in"), dpi=500)

cbbPalette <- c("#999999", "#E69F00","#E69F00", "#56B4E9", "#009E73", "#D55E00", "#0072B2", "#CC79A7")

library(reshape2)
library(ggpubr)

gam_supp_2 <- gam_supp
colnames(gam_supp_2) <- c("names", "depth", "bottemp", "salinity", "AMO", "NAO", "substrate", "variability")
dat.m <- melt(gam_supp_2,id.vars='names', measure.vars=c('bottemp','AMO', 'NAO','depth', 'salinity', 'substrate', 'variability'))

dat.m$value2 <- dat.m$value*100
data.m <- left_join(specinfo, dat.m, by=c("names"))
data.m <- as.data.frame(data.m)
ggbarplot(data.m, x="variable", y="value2", add="mean", facet.by = "depth_saba_simp", fill = "variable", palette=cbbPalette, label = "value2", lab.nb.digits=2, color="variable")+
    labs(y = "Deviance Explained (%)", x = "variable")+ 
    ggtheme_Plot()  
ggsave("barplot_gam_dev.jpg", plot=last_plot(), width = 20, height=8, units=c("in"), dpi=500)

ggplot(data=gam_supp, aes(x=strong.dev.3, y=as.numeric(dist), fill=strong.dev.3)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "distance shifted", x = "strongest variable")+ 
  theme_classic()
ggsave("dist_strong.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)

ggplot(data=gam_supp, aes(x=strong.dev.2, y=as.numeric(area_diff), fill=strong.dev.2)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "change in range size", x = "strongest variable")+ 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=as.numeric(area_diff), fill=depth_saba_simp)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "change in range size", x = "species type")+ 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=as.numeric(min_diff), fill=depth_saba_simp)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "change in trailing edge", x = "species type")+ 
  theme_classic()

ggplot(data=gam_supp, aes(x=strong.dev.2, y=as.numeric(min_diff), fill=strong.dev.2)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "change in trailing edge", x = "strongest variable")+ 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=as.numeric(max_diff), fill=depth_saba_simp)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "change in leading edge", x = "species type")+ 
  theme_classic()

ggplot(data=gam_supp, aes(x=strong.dev.2, y=as.numeric(max_diff), fill=strong.dev.2)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "change in leading edge", x = "strongest variable")+ 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba, y=dev.bt, fill=depth_saba)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "bottom temperature (deviance explained)", x = "species type") + 
  theme_classic()
ggsave("dist_bt.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)

ggplot(data=gam_supp, aes(x=depth_saba, y=dev.sed, fill=depth_saba)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "substrate (deviance explained)", x = "species type") + 
  theme_classic()
ggsave("sub_bt.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)

ggplot(data=gam_supp, aes(x=depth_saba, y=dist, fill=depth_saba)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "dist shifted", x = "species type") + 
  theme_classic()
ggsave("spec_dist.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.depth, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "depth (deviance explained)", x = "species type") + 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.geb, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "substrate (deviance explained)", x = "species type") + 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.sal, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "sal (deviance explained)", x = "species type") + 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.AMO, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "AMO (deviance explained)", x = "species type") + 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.NAO, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "NAO (deviance explained)", x = "species type") + 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.sdsal, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "sal variability (deviance explained)", x = "species type") + 
  theme_classic()

ggplot(data.m, aes(x=dist, y=value)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) + facet_grid(~variable) + labs(y = "deviance explained", x = "distance shifted")
#this doesnt show what I am looking for in terms of bt ...

ggplot(data.m, aes(x=area_diff, y=value)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) + facet_grid(~variable) + labs(y = "deviance explained", x = "change in range size")

  
ggplot(gam_supp, aes(x=dist, y=dev.sed)) + 
  geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(gam_supp, aes(x=dist, y=dev.bt)) + 
  geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

summary(glm(dist~dev.bt, data=gam_supp))
summary(glm(dist~dev.depth, data=gam_supp))
summary(glm(dist~dev.sal, data=gam_supp))
summary(glm(dist~dev.sed, data=gam_supp))
summary(glm(dist~dev.AMO, data=gam_supp))
summary(glm(dist~dev.NAO, data=gam_supp))
summary(glm(dist~dev.sdsal, data=gam_supp))
summary(glm(dist~dev.sdbt, data=gam_supp))
summary(glm(dist~dev.sdsst, data=gam_supp))

summary(glm(area_diff~dev.bt, data=gam_supp))
summary(glm(area_diff~dev.depth, data=gam_supp))
summary(glm(area_diff~dev.sal, data=gam_supp))
summary(glm(area_diff~dev.sed, data=gam_supp))
summary(glm(area_diff~dev.AMO, data=gam_supp))
summary(glm(area_diff~dev.NAO, data=gam_supp))
summary(glm(area_diff~dev.sdsal, data=gam_supp))
summary(glm(area_diff~dev.sdbt, data=gam_supp))
summary(glm(area_diff~dev.sdsst, data=gam_supp))
```

#same as above with fewer specs 


```{r}
specnames <- as.vector(supp$names)

#running the same process but with GAM 
# create data frame to store results
tot_gam_results <- data.frame()
tot_gam_stand <- data.frame()
tot_gam_dev_less <- data.frame(matrix(ncol=11, nrow=1))
colnames(tot_gam_dev_less) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.geb")

for (i in 1:length(specnames)) { #for each species in spec_list
  fit <- gam(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)
#standardized <- lm.beta(fit)
    tryCatch({
        fit_depth <- gam(as.formula(paste(specnames[i],"~ 1 +avgdepth")), data=total, family=nb(link="log"))
          fit_bt <- gam(as.formula(paste(specnames[i],"~ bottemp")), data=total, family=nb(link="log"))
           fit_sal <- gam(as.formula(paste(specnames[i],"~ botsalin")), data=total, family=nb(link="log"))
           fit_AMO <- gam(as.formula(paste(specnames[i],"~ AMO_unsm_year")), data=total, family=nb(link="log"))
           fit_NAO <- gam(as.formula(paste(specnames[i],"~ NAO_year")), data=total, family=nb(link="log"))   
         fit_sed <- gam(as.formula(paste(specnames[i],"~ SEDIMENT")), data=total, family=nb(link="log"))
         fit_sdsal <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsal")), data=total, family=nb(link="log"))
         fit_sdbt <- gam(as.formula(paste(specnames[i],"~ SD3x3shortbt")), data=total, family=nb(link="log")) 
          fit_sdsst <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsst")), data=total, family=nb(link="log"))
        fit_geb <- gam(as.formula(paste(specnames[i],"~ gebco_SD_2")), data=total, family=nb(link="log"))
        dev.depth <- summary(fit_depth)$dev.expl
        dev.bt <- summary(fit_bt)$dev.expl
        dev.sal <- summary(fit_sal)$dev.expl
        dev.AMO <- summary(fit_AMO)$dev.expl
        dev.NAO <- summary(fit_NAO)$dev.expl
        dev.sed <- summary(fit_sed)$dev.expl
        dev.sdsal <- summary(fit_sdsal)$dev.expl
        dev.sdbt <- summary(fit_sdbt)$dev.expl
        dev.sdsst <- summary(fit_sdsst)$dev.expl
        dev.geb <- summary(fit_geb)$dev.expl
        
        dev_table <- list("null", dev.depth, dev.bt, dev.sal, dev.AMO, dev.NAO, dev.sed, dev.sdsal, dev.sdbt, dev.sdsst, dev.geb)
        dev_table <- as.data.frame(dev_table)
        colnames(dev_table) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.geb")
        dev_table$names <- specnames[i]
        
        tot_gam_dev_less <- rbind(tot_gam_dev_less, dev_table)
    }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
        # get coefficents of fit
        #summary_model <- summary(fit)
        #p <- summary_model$p.table
        
        
        #cfit <- fit$coefficients
        #cfit <- as.data.frame(cfit)
        #cfit$names <- paste(specnames[i], rownames(cfit), sep="+")
        #cfit$AIC <- AIC(fit)
        #cfit$Deviance <- dev_table
        #cfit$p_value <- p[,4]
  
       
       # tot_gam_results <- rbind(tot_gam_results, cfit)
        #tot_gam_stand <- rbind(tot_gam_stand, sfit)
} 

tot_gam_dev_less <- tot_gam_dev_less[1:75,]
tot_gam_dev_less <- as.data.frame(tot_gam_dev_less)
tot_gam_dev_less$strong <- colnames(tot_gam_dev_less[2:10])[apply(tot_gam_dev_less[2:10],1,which.max)]
tot_gam_dev_less$strong <- colnames(tot_gam_dev_less[2:7])[apply(tot_gam_dev_less[2:7],1,which.max)]

#loading the specnames info 
specinfo <- supp_3 %>% dplyr::select(names, dist, depth_saba_simp, depth_profile_simp)

gam_supp <- left_join(tot_gam_dev_less, specinfo, by=c("names"))


gam_supp$strong.dev.2 <- ifelse(gam_supp$strong == "dev.sed", "substrate", ifelse(gam_supp$strong == "dev.bt", "bottemp", ifelse(gam_supp$strong == "dev.depth", "depth", ifelse(gam_supp$strong == "dev.AMO" | gam_supp$strong == "dev.NAO", "climate", ifelse(gam_supp$strong == "dev.sal", "salinity", ifelse(gam_supp$strong == "dev.sdsal" | gam_supp$strong == "dev.sdbt" | gam_supp$strong == "dev.sdsst", "variability", NA))))))

pairwise.wilcox.test(as.numeric(gam_supp$dist), gam_supp$depth_saba_simp)
pairwise.wilcox.test(as.numeric(gam_supp$dist), gam_supp$strong.dev.2)
pairwise.wilcox.test(as.numeric(gam_supp$dev.bt), gam_supp$depth_saba_simp)
pairwise.wilcox.test(as.numeric(gam_supp$dev.sed), gam_supp$depth_saba_simp)

library(ggsci)
cbbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#D55E00", "#0072B2", "#CC79A7")
ggplot(data=gam_supp, aes(x= strong.dev.2,  group=depth_saba_simp)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", x = "strongest variable", fill="strog_2") +
    facet_grid(~depth_saba_simp) +
    scale_y_continuous(labels = scales::percent) + theme(legend.position = "none") + 
  scale_fill_manual(values=cbbPalette) + 
    ggtheme_Plot()  
  ggsave("barplot_gam_less.jpg", plot=last_plot(), width = 12, height=6, units=c("in"), dpi=500)

cbbPalette <- c("#999999", "#E69F00","#E69F00", "#56B4E9", "#009E73", "#D55E00", "#0072B2", "#CC79A7")

library(reshape2)
library(ggpubr)

gam_supp_2 <- gam_supp
colnames(gam_supp_2) <- c("names", "depth", "bottemp", "salinity", "AMO", "NAO", "substrate", "variability")
dat.m <- melt(gam_supp_2,id.vars='names', measure.vars=c('bottemp','AMO', 'NAO','depth', 'salinity', 'substrate', 'variability'))

dat.m$value2 <- dat.m$value*100
data.m <- left_join(specinfo, dat.m, by=c("names"))
data.m <- as.data.frame(data.m)
ggbarplot(data.m, x="variable", y="value2", add="mean", facet.by = "depth_saba_simp", fill = "variable", palette=cbbPalette, label = "value2", lab.nb.digits=2, color="variable")+
    labs(y = "Deviance Explained (%)", x = "variable")+ 
    ggtheme_Plot()  
ggsave("barplot_gam_dev.jpg", plot=last_plot(), width = 12, height=6, units=c("in"), dpi=500)

ggplot(data=gam_supp, aes(x=strong.dev.2, y=as.numeric(dist), fill=strong.dev.2)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "distance shifted", x = "strongest variable")+ 
  theme_classic()
ggsave("dist_strong.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)


ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.bt, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "bottom temperature (deviance explained)", x = "species type") + 
  theme_classic()
ggsave("dist_bt.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.sed, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "substrate (eviance explained)", x = "species type") + 
  theme_classic()
ggsave("sub_bt.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dist, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "dist shifted", x = "species type") + 
  theme_classic()
ggsave("spec_dist.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)


ggplot(data.m, aes(x=dist, y=value)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) + facet_grid(~variable)
#this doesnt show what I am looking for...
  
ggplot(gam_supp, aes(x=dist, y=dev.sed)) + 
  geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(gam_supp, aes(x=dist, y=dev.bt)) + 
  geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)
```




#selecting based on model performance 
```{r}

specnames <- as.vector(tot_by_m$scientific_name)
tot_gam_r_2 <- data.frame(matrix(ncol=3, nrow=1))
colnames(tot_gam_r_2) <- c("names", "rsq", "dev")

for (i in 1:length(specnames)) {     
  tryCatch({#for each species in spec_list
  fit <- gam(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + SED_TYPE + gebco_SD_2 + surfsalin + surftemp")), data=total, family=nb(link="log"))
  r <- summary(fit)$r.sq
  dev <- summary(fit)$dev.expl
        dev_table <- list("null", r, dev)
        dev_table <- as.data.frame(dev_table)
        colnames(dev_table) <- c("names", "rsq", "dev")
        dev_table$names <- specnames[i]
        
        tot_gam_r_2 <- rbind(tot_gam_r_2, dev_table)
    }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
        # get coefficents of fit
        #summary_model <- summary(fit)
        #p <- summary_model$p.table
        
        
        #cfit <- fit$coefficients
        #cfit <- as.data.frame(cfit)
        #cfit$names <- paste(specnames[i], rownames(cfit), sep="+")
        #cfit$AIC <- AIC(fit)
        #cfit$Deviance <- dev_table
        #cfit$p_value <- p[,4]
  
       
       # tot_gam_results <- rbind(tot_gam_results, cfit)
        #tot_gam_stand <- rbind(tot_gam_stand, sfit)
} 

#deviance explained might be better than r - squared for non gaussian families
  #https://m-clark.github.io/generalized-additive-models/technical.html#a-detailed-example

#select species whose deviance explained is greater than 50% 


gam_50 <- subset(tot_gam_r, tot_gam_r$dev>=.50)
specnames_r <- as.vector(gam_50$names)

gam_30 <- subset(tot_gam_r_2, tot_gam_r_2$dev>=.30)
specnames_more <- as.vector(gam_30$names)

tot_gam_dev_50 <- data.frame(matrix(ncol=12, nrow=1))
tot_gam_dev_30 <- data.frame(matrix(ncol=25, nrow=1))
colnames(tot_gam_dev_30) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.geb", "dev.sst", "dev.ssal", "dev.null", "coef.depth", "coef.bt", "coef.sal", "coef.AMO", "coef.NAO", "coef.sdsal", "coef.sdbt", "coef.sdsst", "coef.geb", "coef.sst", "coef.ssal")
specnames <- specnames
for (i in 1:length(specnames)) { #for each species in spec_list
  #fit <- gam(as.formula(paste(specnames[i],"~ avgdepth + bottemp + botsalin + AMO_unsm_year + NAO_year + SED_TYPE + SD3x3shortsal + SD3x3shortbt + SD3x3shortsst + gebco_SD_2")), data=total)
#standardized <- lm.beta(fit)
    tryCatch({
        fit_depth <- gam(as.formula(paste(specnames[i],"~ avgdepth")), data=total, family=nb(link="log"))
          fit_bt <- gam(as.formula(paste(specnames[i],"~ bottemp")), data=total, family=nb(link="log"))
           fit_sal <- gam(as.formula(paste(specnames[i],"~ botsalin")), data=total, family=nb(link="log"))
           fit_AMO <- gam(as.formula(paste(specnames[i],"~ AMO_unsm_year")), data=total, family=nb(link="log"))
           fit_NAO <- gam(as.formula(paste(specnames[i],"~ NAO_year")), data=total, family=nb(link="log"))   
         fit_sed <- gam(as.formula(paste(specnames[i],"~ SEDIMENT")), data=total, family=nb(link="log"))
         fit_sdsal <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsal")), data=total, family=nb(link="log"))
         fit_sdbt <- gam(as.formula(paste(specnames[i],"~ SD3x3shortbt")), data=total, family=nb(link="log")) 
          fit_sdsst <- gam(as.formula(paste(specnames[i],"~ SD3x3shortsst")), data=total, family=nb(link="log"))
        fit_geb <- gam(as.formula(paste(specnames[i],"~ gebco_SD_2")), data=total, family=nb(link="log"))
        fit_sst <- gam(as.formula(paste(specnames[i],"~ surftemp")), data=total, family=nb(link="log"))
        fit_ssal <- gam(as.formula(paste(specnames[i],"~ surfsalin")), data=total, family=nb(link="log"))

        fit_null <- gam(as.formula(paste(specnames[i],"~ 1")), data=total, family=nb(link="log"))
        dev.depth <- summary(fit_depth)$dev.expl
        dev.bt <- summary(fit_bt)$dev.expl
        dev.sal <- summary(fit_sal)$dev.expl
        dev.AMO <- summary(fit_AMO)$dev.expl
        dev.NAO <- summary(fit_NAO)$dev.expl
        dev.sed <- summary(fit_sed)$dev.expl
        dev.sdsal <- summary(fit_sdsal)$dev.expl
        dev.sdbt <- summary(fit_sdbt)$dev.expl
        dev.sdsst <- summary(fit_sdsst)$dev.expl
        dev.geb <- summary(fit_geb)$dev.expl
        dev.null <- summary(fit_null)$dev.expl
        dev.sst <- summary(fit_sst)$dev.expl
       dev.ssal <- summary(fit_ssal)$dev.expl

        coef.depth <- summary(fit_depth)$p.coeff[2]
        coef.bt<- summary(fit_bt)$p.coeff[2]
        coef.sal <- summary(fit_sal)$p.coeff[2]
        coef.AMO <- summary(fit_AMO)$p.coeff[2]
        coef.NAO <- summary(fit_NAO)$p.coeff[2]
        coef.sdsal <- summary(fit_sdsal)$p.coeff[2]
        coef.sdbt <- summary(fit_sdbt)$p.coeff[2]
        coef.sdsst <- summary(fit_sdsst)$p.coeff[2]
        coef.geb <- summary(fit_geb)$p.coeff[2]
        coef.sst <- summary(fit_sst)$p.coeff[2]
        coef.ssal <- summary(fit_ssal)$p.coeff[2]
        
        dev_table <- list("null", dev.depth, dev.bt, dev.sal, dev.AMO, dev.NAO, dev.sed, dev.sdsal, dev.sdbt, dev.sdsst, dev.geb, dev.sst, dev.ssal, dev.null, coef.depth, coef.bt, coef.sal, coef.AMO, coef.NAO, coef.sdsal, coef.sdbt, coef.sdsst, coef.geb, coef.sst, coef.ssal)
        dev_table <- as.data.frame(dev_table)
        colnames(dev_table) <- c("names", "dev.depth", "dev.bt", "dev.sal", "dev.AMO", "dev.NAO", "dev.sed", "dev.sdsal", "dev.sdbt", "dev.sdsst", "dev.geb", "dev.sst", "dev.ssal", "dev.null", "coef.depth", "coef.bt", "coef.sal", "coef.AMO", "coef.NAO", "coef.sdsal", "coef.sdbt", "coef.sdsst", "coef.geb", "coef.sst", "coef.ssal")
        dev_table$names <- specnames[i]
        
        tot_gam_dev_30 <- rbind(tot_gam_dev_30, dev_table)
    }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
        # get coefficents of fit
        #summary_model <- summary(fit)
        #p <- summary_model$p.table
        
        
        #cfit <- fit$coefficients
        #cfit <- as.data.frame(cfit)
        #cfit$names <- paste(specnames[i], rownames(cfit), sep="+")
        #cfit$AIC <- AIC(fit)
        #cfit$Deviance <- dev_table
        #cfit$p_value <- p[,4]
  
       
       # tot_gam_results <- rbind(tot_gam_results, cfit)
        #tot_gam_stand <- rbind(tot_gam_stand, sfit)
} 

#started working in part 2 
tot_gam_dev_30_2 <- tot_gam_dev_30[2:377,]

tot_gam_dev_50_2 <- gam_supp[,3:13]
#tot_gam_dev_50_2 <- tot_gam_dev_50_2[1:318,]
tot_gam_dev_50_2 <- as.data.frame(tot_gam_dev_50_2)
tot_gam_dev_30_22 <- rbind(tot_gam_dev_30_2, tot_gam_dev_50_2)
tot_gam_dev_30_22$strong <- colnames(tot_gam_dev_30_22[2:10])[apply(tot_gam_dev_30_22[2:10],1,which.max)]

specnames_50  <- read.csv("specnames_318.csv")
specnames_50 <- specnames_50[,1:8]
specnames_50 <- specnames_50[1:376,]
specnames <- as.vector(specnames_50$names)
#specnames_smaller <- read.csv("specnames_159.csv")

#specnames_smaller <- as.vector(specnames_smaller$names)
#specnames_50 <- specnames_50[specnames_50$names %in% specnames_smaller,] 
dist_total <- read.csv("dist_total_full_400.csv")
dist_info <- dist_total[,2:3] 


#convex info 
convex_1 <- read.csv("spechull/homerange_1.csv")
convex_2 <- read.csv("spechull/homerange_2.csv")
convex_1 <- convex_1 %>% dplyr::select(names, area, EXT_MIN_Y, EXT_MAX_Y)
convex_2 <- convex_2 %>% dplyr::select(names, area, EXT_MIN_Y, EXT_MAX_Y)
colnames(convex_1) <- c("names", "area_1", "min_y_1", "max_y_1")
colnames(convex_2) <- c("names", "area_2", "min_y_2", "max_y_2")

write.csv(gam_supp, "gam_supp.csv")
write.csv(tot_gam_dev_30_2, "gam_30.csv")
write.csv(tot_gam_dev_50_2, "gam_50.csv")

gam_supp <- read.csv("gam_supp.csv")

convex <- merge(convex_2, convex_1, by="names")
convex$area_diff <- convex$area_2 - convex$area_1
convex$min_diff <- convex$min_y_2 - convex$min_y_1
convex$max_diff <- convex$max_y_2 - convex$max_y_1

#gam_supp <- gam_supp[,2:32]


specinfo <- left_join(specnames_50, dist_info, by=c("names"="specnames_dist"))
specinfo <- left_join(specinfo, convex, by=c("names"))
specinfo$dist <- specinfo$`distGeo(spec_coords_1[2:3], spec_coords_2[2:3])`
gam_supp <- left_join(tot_gam_dev_30_22, specinfo, by=c("names"))

gam_supp$dist <- gam_supp$`distGeo(spec_coords_1[2:3], spec_coords_2[2:3])`

#adjusting specnames to exclude families 
gam_supp<- subset(gam_supp, gam_supp$question != "family")
#| gam_supp$question != "yes")

#try combining benthic and demersal 
gam_supp$depth_saba_2 <- ifelse(gam_supp$depth_saba == "benthic", "demersal", as.character(gam_supp$depth_saba))
#gam_supp<- subset(gam_supp, gam_supp$depth_saba != "reef")



gam_supp$strong.dev.2 <- ifelse(gam_supp$strong == "dev.sed", "substrate", ifelse(gam_supp$strong == "dev.bt", "bottemp", ifelse(gam_supp$strong == "dev.depth", "depth", ifelse(gam_supp$strong == "dev.AMO" | gam_supp$strong == "dev.NAO", "climate", ifelse(gam_supp$strong == "dev.sal", "salinity", ifelse(gam_supp$strong == "dev.sdsal" | gam_supp$strong == "dev.sdbt" | gam_supp$strong == "dev.sdsst", "variability", NA))))))

pairwise.wilcox.test(as.numeric(gam_supp$dist), gam_supp$depth_saba_2)
pairwise.wilcox.test(as.numeric(gam_supp$area_diff), gam_supp$depth_saba_2)
pairwise.wilcox.test(as.numeric(gam_supp$min_diff), gam_supp$depth_saba_2)
pairwise.wilcox.test(as.numeric(gam_supp$max_diff), gam_supp$depth_saba_2)


pairwise.wilcox.test(as.numeric(gam_supp$dist), gam_supp$strong.dev.2)
pairwise.wilcox.test(as.numeric(gam_supp$dev.bt), gam_supp$depth_saba_2)
pairwise.wilcox.test(as.numeric(gam_supp$dev.sed), gam_supp$depth_saba_2)
pairwise.wilcox.test(as.numeric(gam_supp$dev.depth), gam_supp$depth_saba_2)
pairwise.wilcox.test(as.numeric(gam_supp$dev.sal), gam_supp$depth_saba_2)
pairwise.wilcox.test(as.numeric(gam_supp$dev.NAO), gam_supp$depth_saba_2)
pairwise.wilcox.test(as.numeric(gam_supp$dev.AMO), gam_supp$depth_saba_2)

library(ggsci)
cbbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#D55E00", "#0072B2", "#CC79A7")
ggplot(data=gam_supp, aes(x= strong.dev.2,  group=depth_saba_2)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", x = "strongest variable", fill="strog_2") +
    facet_wrap(~depth_saba_2) +
    scale_y_continuous(labels = scales::percent) + theme(legend.position = "none") + 
  scale_fill_manual(values=cbbPalette) + 
    ggtheme_Plot()  
  ggsave("barplot_gam_more.jpg", plot=last_plot(), width = 20, height=8, units=c("in"), dpi=500)

cbbPalette <- c("#999999", "#E69F00","#E69F00", "#56B4E9", "#009E73", "#D55E00", "#0072B2", "#CC79A7")

library(reshape2)
library(ggpubr)

gam_supp_2 <- gam_supp
colnames(gam_supp_2) <- c("names", "depth", "bottemp", "salinity", "AMO", "NAO", "substrate", "variability")
dat.m <- melt(gam_supp_2,id.vars='names', measure.vars=c('bottemp','AMO', 'NAO','depth', 'salinity', 'substrate', 'variability'))

dat.m$value2 <- dat.m$value*100
data.m <- left_join(gam_supp, dat.m, by=c("names"))
data.m <- as.data.frame(data.m)
ggbarplot(data.m, x="variable", y="value2", add="mean", facet.by = "depth_saba_2", fill = "variable", palette=cbbPalette, label = "value2", lab.nb.digits=2, color="variable")+
    labs(y = "Average Deviance Explained (%)", x = "variable")+ 
    ggtheme_Plot()  
ggsave("barplot_gam_dev.jpg", plot=last_plot(), width = 20, height=8, units=c("in"), dpi=500)


#all deviance explained 
ggplot(data=data.m, aes(x=depth_saba_2, y=value, fill=depth_saba_2)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "Deviance Explained", x = "species type") + 
  facet_wrap(~variable) + 
  theme_classic()

#all distance 
ggplot(data=gam_supp, aes(x=depth_saba_2, y=dist, fill=depth_saba_2)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "Distance shifted", x = "species type") + 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_2, y=area_diff, fill=depth_saba_2)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "range shifted", x = "species type") + 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_2, y=min_diff, fill=depth_saba_2)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "southern range extent shifted", x = "species type") + 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_2, y=max_diff, fill=depth_saba_2)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "norther range extent shifted", x = "species type") + 
  theme_classic()

#dist vs deviance 
ggplot(data.m, aes(x=dist, y=value)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) + facet_grid(~variable)

ggplot(data.m, aes(x=area_diff, y=value)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) + facet_grid(~variable)

ggplot(data.m, aes(x=min_diff, y=value)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) + facet_grid(~variable)

ggplot(data.m, aes(x=max_diff, y=value)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) + facet_grid(~variable)

ggplot(data=gam_supp, aes(x=strong.dev.2, y=as.numeric(dist), fill=strong.dev.2)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "distance shifted", x = "strongest variable")+ 
  theme_classic()
ggsave("dist_strong.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)

ggplot(data=gam_supp, aes(x=strong.dev.2, y=as.numeric(area_diff), fill=strong.dev.2)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "change in range size", x = "strongest variable")+ 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=as.numeric(area_diff), fill=depth_saba_simp)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "change in range size", x = "species type")+ 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=as.numeric(min_diff), fill=depth_saba_simp)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "change in trailing edge", x = "species type")+ 
  theme_classic()

ggplot(data=gam_supp, aes(x=strong.dev.2, y=as.numeric(min_diff), fill=strong.dev.2)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "change in trailing edge", x = "strongest variable")+ 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=as.numeric(max_diff), fill=depth_saba_simp)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "change in leading edge", x = "species type")+ 
  theme_classic()

ggplot(data=gam_supp, aes(x=strong.dev.2, y=as.numeric(max_diff), fill=strong.dev.2)) + geom_boxplot() + stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE)  +
    labs(y = "change in leading edge", x = "strongest variable")+ 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_2, y=dev.bt, fill=depth_saba_2)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "bottom temperature (deviance explained)", x = "species type") + 
  theme_classic()
ggsave("dist_bt.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)

ggplot(data=gam_supp, aes(x=depth_saba_2, y=dev.sed, fill=depth_saba_2)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "substrate (deviance explained)", x = "species type") + 
  theme_classic()
ggsave("sub_bt.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)




ggplot(data=gam_supp, aes(x=depth_saba, y=dist, fill=depth_saba)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "dist shifted", x = "species type") + 
  theme_classic()
#ggsave("spec_dist.jpg", plot=last_plot(), width = 6, height=4, units=c("in"), dpi=500)




ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.depth, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "depth (deviance explained)", x = "species type") + 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.geb, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "substrate (deviance explained)", x = "species type") + 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.sal, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "sal (deviance explained)", x = "species type") + 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.AMO, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "AMO (deviance explained)", x = "species type") + 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.NAO, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "NAO (deviance explained)", x = "species type") + 
  theme_classic()

ggplot(data=gam_supp, aes(x=depth_saba_simp, y=dev.sdsal, fill=depth_saba_simp)) + geom_boxplot() +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=3,show_guide = FALSE) +
    labs(y = "sal variability (deviance explained)", x = "species type") + 
  theme_classic()

ggplot(data.m, aes(x=dist, y=value)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) + facet_grid(~variable) + labs(y = "deviance explained", x = "distance shifted")
#this doesnt show what I am looking for in terms of bt ...

ggplot(data.m, aes(x=area_diff, y=value)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) + facet_grid(~variable) + labs(y = "deviance explained", x = "change in range size")

  
ggplot(gam_supp, aes(x=dist, y=dev.sed)) + 
  geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

ggplot(gam_supp, aes(x=dist, y=dev.bt)) + 
  geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)

summary(glm(dist~dev.bt, data=gam_supp))
summary(glm(dist~dev.depth, data=gam_supp))
summary(glm(dist~dev.sal, data=gam_supp))
summary(glm(dist~dev.sed, data=gam_supp))
summary(glm(dist~dev.AMO, data=gam_supp))
summary(glm(dist~dev.NAO, data=gam_supp))
summary(glm(dist~dev.sdsal, data=gam_supp))
summary(glm(dist~dev.sdbt, data=gam_supp))
summary(glm(dist~dev.sdsst, data=gam_supp))

summary(glm(area_diff~dev.bt, data=gam_supp))
summary(glm(area_diff~dev.depth, data=gam_supp))
summary(glm(area_diff~dev.sal, data=gam_supp))
summary(glm(area_diff~dev.sed, data=gam_supp))
summary(glm(area_diff~dev.AMO, data=gam_supp))
summary(glm(area_diff~dev.NAO, data=gam_supp))
summary(glm(area_diff~dev.sdsal, data=gam_supp))
summary(glm(area_diff~dev.sdbt, data=gam_supp))
summary(glm(area_diff~dev.sdsst, data=gam_supp))

ggplot(data.m, aes(x=dist, y=value)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm) + facet_grid(~variable)
#this doesnt show what I am looking for...
```

